<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–î–ó: –ì–µ–æ–º–µ—Ç—Ä—ñ—è (7 –∫–ª–∞—Å)</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    ></script>

    <style>
      :root {
        --primary: #7c3aed;
        --primary-light: #f5f3ff;
        --success: #16a34a;
        --error: #dc2626;
        --bg: #f8fafc;
        --card: #ffffff;
        --text: #1e293b;
        --border: #e2e8f0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: var(--bg);
        color: var(--text);
        margin: 0;
        padding: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      header {
        background: var(--card);
        padding: 15px 20px;
        border-bottom: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
      }

      @media (min-width: 600px) {
        header {
          flex-direction: row;
          justify-content: space-between;
        }
      }

      .header-title {
        font-weight: 700;
        font-size: 1.2rem;
        color: var(--primary);
      }

      .student-name-input {
        padding: 10px 15px;
        border: 2px solid var(--border);
        border-radius: 8px;
        font-size: 0.95rem;
        width: 100%;
        max-width: 300px;
      }
      .student-name-input:focus {
        outline: none;
        border-color: var(--primary);
      }

      .content-container {
        padding: 20px;
        padding-bottom: 80px;
        max-width: 800px;
        margin: 0 auto;
        width: 100%;
        box-sizing: border-box;
        flex: 1;
      }

      .exercise-block {
        background: var(--card);
        border-radius: 12px;
        border: 1px solid var(--border);
        margin-bottom: 30px;
        overflow: hidden;
      }

      .exercise-header {
        background: var(--primary-light);
        padding: 15px 20px;
        border-bottom: 1px solid var(--border);
      }

      .exercise-title {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--primary);
      }

      .exercise-desc {
        margin: 8px 0 0 0;
        font-size: 0.95rem;
        color: #475569;
        line-height: 1.5;
      }

      .exercise-image {
        display: block;
        max-width: 100%;
        max-height: 250px;
        height: auto;
        margin: 15px auto 0;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
      }

      .task-row {
        padding: 20px;
        border-bottom: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        gap: 15px;
      }
      .task-row:last-child {
        border-bottom: none;
      }

      .task-content {
        display: flex;
        align-items: flex-start;
        gap: 12px;
      }
      .task-number {
        font-weight: 700;
        color: #94a3b8;
        min-width: 25px;
        margin-top: 2px;
      }
      .task-question {
        font-size: 1.05rem;
        font-weight: 500;
        line-height: 1.5;
      }

      .input-group {
        display: flex;
        align-items: center;
        width: 100%;
      }
      .input-answer {
        padding: 12px 15px;
        border: 2px solid #cbd5e1;
        border-radius: 8px;
        width: 100%;
        max-width: 250px;
        font-size: 1rem;
        background: #fff;
      }
      .input-answer:focus {
        outline: none;
        border-color: var(--primary);
      }

      .options-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }
      .option-btn {
        flex: 1;
        min-width: 120px;
        background: white;
        border: 2px solid #cbd5e1;
        border-radius: 8px;
        padding: 12px 15px;
        font-size: 1rem;
        cursor: pointer;
        text-align: left;
        color: var(--text);
      }
      .option-btn.selected {
        background: var(--text);
        color: white;
        border-color: var(--text);
      }
      .option-btn.selected .katex {
        color: white !important;
      }

      .finish-section {
        margin-top: 40px;
        text-align: center;
        padding-bottom: 60px;
      }
      .btn-finish {
        padding: 18px 60px;
        font-size: 1.3rem;
        font-weight: 800;
        color: white;
        background: var(--primary);
        border: none;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(124, 58, 237, 0.4);
        transition: transform 0.2s;
      }
      .btn-finish:hover {
        transform: translateY(-2px);
      }

      /* –ú–û–î–ê–õ–¨–ù–ï –í–Ü–ö–ù–û */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.98);
        z-index: 2000;
        justify-content: center;
        align-items: center;
        overflow-y: auto;
        padding: 20px;
        box-sizing: border-box;
      }
      .modal-card {
        background: white;
        padding: 40px;
        border-radius: 20px;
        max-width: 800px;
        width: 100%;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        position: relative;
        text-align: center;
        border: 1px solid var(--border);
      }
      .modal-icon {
        font-size: 4rem;
        margin-bottom: 20px;
      }
      .modal-title {
        font-size: 2rem;
        font-weight: 800;
        color: var(--text);
        margin-bottom: 10px;
      }
      .modal-subtitle {
        color: #64748b;
        font-size: 1.1rem;
        margin-bottom: 30px;
        line-height: 1.6;
      }

      .btn-copy-link {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        padding: 15px;
        background: #2563eb;
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        margin-top: 10px;
        gap: 10px;
      }
      .btn-copy-link:hover {
        background: #1d4ed8;
      }

      .link-box {
        background: #f1f5f9;
        padding: 15px;
        border-radius: 8px;
        word-break: break-all;
        font-family: monospace;
        font-size: 0.9rem;
        margin-bottom: 15px;
        border: 1px solid #cbd5e1;
        color: #475569;
      }

      /* –°–µ–∫—Ü—ñ—è –≤—á–∏—Ç–µ–ª—è (–∑–≤—ñ—Ç) */
      #teacher-login-area {
        margin-top: 20px;
      }
      .password-input {
        padding: 12px;
        border: 2px solid #cbd5e1;
        border-radius: 8px;
        font-size: 1rem;
        width: 150px;
      }
      .btn-login {
        padding: 12px 20px;
        background: #334155;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
      }

      .report-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        font-size: 0.95rem;
      }
      .report-table th {
        text-align: left;
        background: #f8fafc;
        padding: 15px;
        border-bottom: 2px solid #cbd5e1;
        color: #64748b;
      }
      .report-table td {
        padding: 15px;
        border-bottom: 1px solid #e2e8f0;
      }

      .row-correct {
        background-color: #f0fdf4;
      }
      .row-wrong {
        background-color: #fef2f2;
      }
      .row-wrong td:nth-child(2) {
        text-decoration: line-through;
        color: var(--error);
      }
      .score-badge {
        font-size: 2rem;
        font-weight: 900;
        color: var(--primary);
        margin: 20px 0;
        padding: 15px;
        background: #f3e8ff;
        border-radius: 12px;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-title">üìù –î–ó: –ì–µ–æ–º–µ—Ç—Ä—ñ—è (7 –∫–ª–∞—Å)</div>
      <input
        type="text"
        id="studentName"
        class="student-name-input"
        placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ —Ç–∞ –Ü–º'—è"
      />
    </header>

    <div class="content-container" id="quiz-root"></div>

    <div id="result-modal" class="modal-overlay">
      <div class="modal-card">
        <div id="view-student-finish" style="display: none">
          <div class="modal-icon">üéâ</div>
          <div class="modal-title">–ì–æ—Ç–æ–≤–æ!</div>
          <div class="modal-subtitle">
            –†–æ–±–æ—Ç—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ. –°–∫–æ–ø—ñ—é–π —Ü–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —Ç–∞ –Ω–∞–¥—ñ—à–ª–∏ –≤—á–∏—Ç–µ–ª—é –¥–ª—è
            –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏:
          </div>

          <div id="generated-link-box" class="link-box">...</div>

          <button class="btn-copy-link" onclick="copyLinkToClipboard()">
            üîó –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
          </button>
          <div style="margin-top: 10px; font-size: 0.9rem; color: #64748b">
            (–ù–∞–¥—ñ—à–ª–∏ —Ü–µ –≤ Viber/Telegram)
          </div>
        </div>

        <div id="view-teacher-login" style="display: none">
          <div class="modal-title">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏</div>
          <div class="modal-subtitle">
            –í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å –≤—á–∏—Ç–µ–ª—è, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏.
          </div>
          <div>
            <input
              type="password"
              id="teacher-pass"
              class="password-input"
              placeholder="–ü–∞—Ä–æ–ª—å"
            />
            <button class="btn-login" onclick="checkPassword()">–£–≤—ñ–π—Ç–∏</button>
          </div>
          <div id="login-error" style="color: red; margin-top: 10px"></div>
        </div>

        <div id="view-teacher-report" style="display: none">
          <div class="modal-title">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
          <div class="modal-subtitle" id="report-student-name"></div>
          <div id="report-score" class="score-badge"></div>

          <table class="report-table">
            <thead>
              <tr>
                <th width="40%">–ó–∞–≤–¥–∞–Ω–Ω—è</th>
                <th width="30%">–í—ñ–¥–ø–æ–≤—ñ–¥—å —É—á–Ω—è</th>
                <th width="30%">–ü—Ä–∞–≤–∏–ª—å–Ω–æ</th>
              </tr>
            </thead>
            <tbody id="report-body"></tbody>
          </table>

          <button
            class="btn-copy-link"
            onclick="window.location.href = window.location.pathname"
            style="background: #334155; margin-top: 30px"
          >
            üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É (–ù–æ–≤–∞ —Ä–æ–±–æ—Ç–∞)
          </button>
        </div>
      </div>
    </div>

    <script>
      // --- –í–ü–†–ê–í–ò (17 —à—Ç, –Ω–æ–≤—ñ —á–∏—Å–ª–∞) ---
      const exercises = [
        {
          id: "5",
          title: "5. –ü–∞—Ä–∞–ª–µ–ª—å–Ω—ñ –ø—Ä—è–º—ñ",
          desc: "$m \\parallel n$, $a$ ‚Äî —Å—ñ—á–Ω–∞ (–¥–∏–≤. –º–∞–ª. 2). –í—ñ–¥–æ–º–æ, —â–æ $\\angle 1 = 130^\\circ$.",
          img: "mal2.png",
          tasks: [
            { id: "1)", q: "–ó–Ω–∞–π–¥—ñ—Ç—å $\\angle 2$.", a: "50", type: "input" },
            { id: "2)", q: "–ó–Ω–∞–π–¥—ñ—Ç—å $\\angle 3$.", a: "130", type: "input" },
          ],
        },
        {
          id: "7",
          title: "7. –í—ñ–¥—Ä—ñ–∑–∫–∏",
          desc: "–¢–æ—á–∫–∞ $M$ –Ω–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥—Ä—ñ–∑–∫—É $AB$.",
          tasks: [
            {
              id: "1)",
              q: "–ó–Ω–∞–π–¥—ñ—Ç—å $AM$, —è–∫—â–æ $AB = 15$ —Å–º, $MB = 20$ –º–º (—É —Å–º).",
              a: "13",
              type: "input",
            }, // 15 - 2 = 13
            {
              id: "2)",
              q: "–ó–Ω–∞–π–¥—ñ—Ç—å $AB$, —è–∫—â–æ $AM = 3$ –¥–º, $MB = 2$ –¥–º 4 —Å–º (—É —Å–º).",
              a: "54",
              type: "input",
            }, // 30 + 24
          ],
        },
        {
          id: "9",
          title: "9. –ü—Ä–æ–º—ñ–Ω—å —ñ –∫—É—Ç–∏",
          desc: "–ü—Ä–æ–º—ñ–Ω—å $OK$ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –º—ñ–∂ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ –∫—É—Ç–∞ $AOD$.",
          tasks: [
            {
              id: "1)",
              q: "–ó–Ω–∞–π–¥—ñ—Ç—å $\\angle AOD$, —è–∫—â–æ $\\angle AOK = 40^\\circ$, $\\angle KOD = 35^\\circ$.",
              a: "75",
              type: "input",
            },
          ],
        },
        {
          id: "13",
          title: "13. –ö—É—Ç–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∏–Ω—ñ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö",
          desc: "–û–¥–∏–Ω –∑ –∫—É—Ç—ñ–≤ –¥–æ—Ä—ñ–≤–Ω—é—î $125^\\circ$.",
          tasks: [
            {
              id: "1)",
              q: "–ó–Ω–∞–π–¥—ñ—Ç—å –≤–µ–ª–∏—á–∏–Ω—É –≥–æ—Å—Ç—Ä–æ–≥–æ –∫—É—Ç–∞.",
              a: "55",
              type: "input",
            },
            {
              id: "2)",
              q: "–ó–Ω–∞–π–¥—ñ—Ç—å –≤–µ–ª–∏—á–∏–Ω—É —Ç—É–ø–æ–≥–æ –∫—É—Ç–∞.",
              a: "125",
              type: "input",
            },
          ],
        },
        {
          id: "15",
          title: "15. –°—É–º—ñ–∂–Ω—ñ –∫—É—Ç–∏",
          desc: "–ó–Ω–∞–π–¥—ñ—Ç—å —Å—É–º—ñ–∂–Ω—ñ –∫—É—Ç–∏, —è–∫—â–æ:",
          tasks: [
            {
              id: "1)",
              q: "–û–¥–∏–Ω –∑ –Ω–∏—Ö —É 5 —Ä–∞–∑—ñ–≤ –±—ñ–ª—å—à–∏–π –∑–∞ —ñ–Ω—à–∏–π. (–ú–µ–Ω—à–∏–π –∫—É—Ç)",
              a: "30",
              type: "input",
            },
            {
              id: "2)",
              q: "–û–¥–∏–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—å $\\frac{1}{3}$ –≤—ñ–¥ —ñ–Ω—à–æ–≥–æ. (–ë—ñ–ª—å—à–∏–π –∫—É—Ç)",
              a: "135",
              type: "input",
            },
          ],
        },
        {
          id: "18",
          title: "18. –ü–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ñ—Å—Ç—å",
          desc: "–ü—Ä—è–º—ñ –ø–µ—Ä–µ—Ç–∏–Ω–∞—é—Ç—å—Å—è –≤ —Ç–æ—á—Ü—ñ $O$, $MN \\perp KL$ (–¥–∏–≤. –º–∞–ª. 4). $\\angle NOA = 150^\\circ$.",
          img: "mal4.png",
          tasks: [
            { id: "1)", q: "–ó–Ω–∞–π–¥—ñ—Ç—å $\\angle KOB$.", a: "30", type: "input" }, // Vertically opp to AOM. AOM = 180-150=30.
          ],
        },
        {
          id: "20",
          title: "20. –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ",
          desc: "–°—É–º–∞ $180^\\circ$. –ó–Ω–∞–π–¥—ñ—Ç—å –∫—É—Ç–∏, —è–∫—â–æ:",
          tasks: [
            {
              id: "1)",
              q: "–á—Ö —Ä—ñ–∑–Ω–∏—Ü—è –¥–æ—Ä—ñ–≤–Ω—é—î $50^\\circ$. (–ë—ñ–ª—å—à–∏–π –∫—É—Ç)",
              a: "115",
              type: "input",
            },
            {
              id: "2)",
              q: "–í–æ–Ω–∏ –≤—ñ–¥–Ω–æ—Å—è—Ç—å—Å—è —è–∫ $3 : 7$. (–ú–µ–Ω—à–∏–π –∫—É—Ç)",
              a: "54",
              type: "input",
            },
          ],
        },
        {
          id: "25",
          title: "25. –ü–µ—Ä–∏–º–µ—Ç—Ä —Ä—ñ–≤–Ω–æ–±–µ–¥—Ä–µ–Ω–æ–≥–æ",
          desc: "–ë—ñ—á–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–∞ = 20 —Å–º, –æ—Å–Ω–æ–≤–∞ –Ω–∞ 8 —Å–º –º–µ–Ω—à–∞ –≤—ñ–¥ –±—ñ—á–Ω–æ—ó.",
          tasks: [
            { id: "1)", q: "–ó–Ω–∞–π–¥—ñ—Ç—å –ø–µ—Ä–∏–º–µ—Ç—Ä.", a: "52", type: "input" }, // 20+20+12
          ],
        },
        {
          id: "27",
          title: "27. –ë—ñ—Å–µ–∫—Ç—Ä–∏—Å–∞",
          desc: "$CM$ ‚Äî –±—ñ—Å–µ–∫—Ç—Ä–∏—Å–∞ $\\triangle ABC$, $\\angle ACB = 120^\\circ$.",
          tasks: [
            { id: "1)", q: "–ó–Ω–∞–π–¥—ñ—Ç—å $\\angle ACM$.", a: "60", type: "input" },
          ],
        },
        {
          id: "29",
          title: "29. –û–∑–Ω–∞–∫–∏ —Ä—ñ–≤–Ω–æ—Å—Ç—ñ",
          desc: "–î–æ–≤–µ–¥—ñ—Ç—å —Ä—ñ–≤–Ω—ñ—Å—Ç—å $\\triangle ACK = \\triangle BCK$ (–¥–∏–≤. –º–∞–ª. 6), —è–∫—â–æ $CK \\perp AB$ —ñ $CK$ —Å–ø—ñ–ª—å–Ω–∞, –∫—É—Ç–∏ —Ä—ñ–≤–Ω—ñ.",
          img: "mal6.png",
          tasks: [
            {
              id: "1)",
              q: "–ó–∞ —è–∫–æ—é –æ–∑–Ω–∞–∫–æ—é —Ä—ñ–≤–Ω—ñ?",
              a: "–ó–∞ —Å—Ç–æ—Ä–æ–Ω–æ—é —ñ –¥–≤–æ–º–∞ –∫—É—Ç–∞–º–∏",
              opts: [
                "–ó–∞ —Å—Ç–æ—Ä–æ–Ω–æ—é —ñ –¥–≤–æ–º–∞ –∫—É—Ç–∞–º–∏",
                "–ó–∞ —Ç—Ä—å–æ–º–∞ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏",
                "–ó–∞ –¥–≤–æ–º–∞ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ —ñ –∫—É—Ç–æ–º",
              ],
            },
          ],
        },
        {
          id: "31",
          title: "31. –ö—É—Ç–∏ —Ä—ñ–≤–Ω–æ–±–µ–¥—Ä–µ–Ω–æ–≥–æ",
          desc: "–ö—É—Ç –ø—Ä–∏ –≤–µ—Ä—à–∏–Ω—ñ –¥–æ—Ä—ñ–≤–Ω—é—î $140^\\circ$.",
          tasks: [
            { id: "1)", q: "–ó–Ω–∞–π–¥—ñ—Ç—å –∫—É—Ç –ø—Ä–∏ –æ—Å–Ω–æ–≤—ñ.", a: "20", type: "input" },
          ],
        },
        {
          id: "33",
          title: "33. –ó–æ–≤–Ω—ñ—à–Ω—ñ–π –∫—É—Ç",
          desc: "–ó–æ–≤–Ω—ñ—à–Ω—ñ–π –∫—É—Ç $130^\\circ$. –û–¥–∏–Ω –∑ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ—Ö –Ω–µ—Å—É–º—ñ–∂–Ω–∏—Ö = $90^\\circ$.",
          tasks: [
            {
              id: "1)",
              q: "–ó–Ω–∞–π–¥—ñ—Ç—å —ñ–Ω—à–∏–π –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –Ω–µ—Å—É–º—ñ–∂–Ω–∏–π –∫—É—Ç.",
              a: "40",
              type: "input",
            },
          ],
        },
        {
          id: "35",
          title: "35. –ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–π —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫ (30 –≥—Ä–∞–¥—É—Å—ñ–≤)",
          desc: "$\\angle A = 30^\\circ$.",
          tasks: [
            {
              id: "1)",
              q: "–ó–Ω–∞–π–¥—ñ—Ç—å –≥—ñ–ø–æ—Ç–µ–Ω—É–∑—É, —è–∫—â–æ –∫–∞—Ç–µ—Ç –ø—Ä–æ—Ç–∏ –∫—É—Ç–∞ $30^\\circ$ –¥–æ—Ä—ñ–≤–Ω—é—î 10 —Å–º.",
              a: "20",
              type: "input",
            },
            {
              id: "2)",
              q: "–ó–Ω–∞–π–¥—ñ—Ç—å –∫–∞—Ç–µ—Ç –ø—Ä–æ—Ç–∏ –∫—É—Ç–∞ $30^\\circ$, —è–∫—â–æ –≥—ñ–ø–æ—Ç–µ–Ω—É–∑–∞ –¥–æ—Ä—ñ–≤–Ω—é—î 36 —Å–º.",
              a: "18",
              type: "input",
            },
          ],
        },
        {
          id: "37",
          title: "37. –ù–µ—Ä—ñ–≤–Ω—ñ—Å—Ç—å —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞",
          desc: "–°—Ç–æ—Ä–æ–Ω–∏ 6,1 —Å–º —ñ 2,5 —Å–º.",
          tasks: [
            {
              id: "1)",
              q: "–Ø–∫–æ–º—É –ù–ê–ô–ë–Ü–õ–¨–®–û–ú–£ —Ü—ñ–ª–æ–º—É —á–∏—Å–ª—É –º–æ–∂–µ –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ —Ç—Ä–µ—Ç—è —Å—Ç–æ—Ä–æ–Ω–∞?",
              a: "8",
              type: "input",
            },
          ],
        },
        {
          id: "42",
          title: "42. –°–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –∫—É—Ç—ñ–≤",
          desc: "–ö—É—Ç–∏: $x$, $x+30$, $2x$. –°—É–º–∞ $180^\\circ$.",
          tasks: [
            {
              id: "1)",
              q: "–ó–Ω–∞–π–¥—ñ—Ç—å –Ω–∞–π–º–µ–Ω—à–∏–π –∫—É—Ç ($x$).",
              a: "37.5",
              type: "input",
            },
          ],
        },
        {
          id: "44",
          title: "44. –ì–æ—Å—Ç—Ä—ñ –∫—É—Ç–∏ –ø—Ä—è–º–æ–∫—É—Ç–Ω–æ–≥–æ",
          desc: "–°—É–º–∞ –≥–æ—Å—Ç—Ä–∏—Ö = $90^\\circ$.",
          tasks: [
            {
              id: "1)",
              q: "–û–¥–∏–Ω —É 8 —Ä–∞–∑—ñ–≤ –±—ñ–ª—å—à–∏–π –∑–∞ —ñ–Ω—à–∏–π. (–ú–µ–Ω—à–∏–π –∫—É—Ç)",
              a: "10",
              type: "input",
            },
            {
              id: "2)",
              q: "–í—ñ–¥–Ω–æ—Å—è—Ç—å—Å—è —è–∫ $1 : 5$. (–ë—ñ–ª—å—à–∏–π –∫—É—Ç)",
              a: "75",
              type: "input",
            },
          ],
        },
        {
          id: "46",
          title: "46. –ü–µ—Ä–∏–º–µ—Ç—Ä–∏",
          desc: "$P_{ABC} = 60$ —Å–º, –º–µ–¥—ñ–∞–Ω–∞ $AM = 15$ —Å–º. –¢—Ä–∏–∫—É—Ç–Ω–∏–∫ —Ä—ñ–≤–Ω–æ–±–µ–¥—Ä–µ–Ω–∏–π.",
          tasks: [
            {
              id: "1)",
              q: "–ó–Ω–∞–π–¥—ñ—Ç—å –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ $ABM$.",
              a: "45",
              type: "input",
            }, // 30+15=45
          ],
        },
      ];

      // Fix decimal precision display issues if any
      exercises[14].tasks[0].a = "37.5";

      let userAnswers = {};
      let decodedData = null; // –î–ª—è —Ä–µ–∂–∏–º—É –≤—á–∏—Ç–µ–ª—è

      document.addEventListener("DOMContentLoaded", () => {
        // 1. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —Ü–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑ –¥–∞–Ω–∏–º–∏ (—Ä–µ–∂–∏–º –≤—á–∏—Ç–µ–ª—è)
        const params = new URLSearchParams(window.location.search);
        if (params.has("d")) {
          try {
            // –î–µ–∫–æ–¥—É—î–º–æ –¥–∞–Ω—ñ –∑ URL
            const jsonStr = decodeURIComponent(atob(params.get("d")));
            decodedData = JSON.parse(jsonStr);

            // –•–æ–≤–∞—î–º–æ –∑–∞–≤–¥–∞–Ω–Ω—è, –ø–æ–∫–∞–∑—É—î–º–æ –≤—Ö—ñ–¥
            document.getElementById("quiz-root").style.display = "none";
            document.querySelector("header").style.display = "none";
            document.getElementById("result-modal").style.display = "flex";
            document.getElementById("view-teacher-login").style.display =
              "block";
            return; // –ó—É–ø–∏–Ω—è—î–º–æ —Ä–µ–Ω–¥–µ—Ä –∑–∞–≤–¥–∞–Ω—å
          } catch (e) {
            console.error("Link error", e);
            alert("–ü–æ–º–∏–ª–∫–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è. –ü–æ–ø—Ä–æ—Å—ñ—Ç—å —É—á–Ω—è –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–æ–≤–µ.");
          }
        }

        // 2. –†–µ–Ω–¥–µ—Ä–∏–º–æ –∑–∞–≤–¥–∞–Ω–Ω—è (—Ä–µ–∂–∏–º —É—á–Ω—è)
        renderExercises();
      });

      function renderExercises() {
        const root = document.getElementById("quiz-root");

        exercises.forEach((ex) => {
          const exBlock = document.createElement("div");
          exBlock.className = "exercise-block";

          let imgHTML = "";
          if (ex.img) {
            imgHTML = `<img src="${ex.img}" alt="–ú–∞–ª—é–Ω–æ–∫" class="exercise-image" onerror="this.style.display='none'">`;
          }

          exBlock.innerHTML = `
                <div class="exercise-header">
                    <h3 class="exercise-title">${ex.title}</h3>
                    <p class="exercise-desc">${ex.desc}</p>
                    ${imgHTML}
                </div>
                `;

          const taskList = document.createElement("div");
          taskList.className = "task-list";

          ex.tasks.forEach((task) => {
            const row = document.createElement("div");
            row.className = "task-row";
            const uniqueId = `${ex.id}-${task.id}`;

            let contentHTML = `
                        <div class="task-content">
                            <div class="task-number">${task.id}</div>
                            <div class="task-question">${task.q}</div>
                        </div>
                    `;

            let actionHTML = "";
            if (task.type === "input") {
              actionHTML = `
                <div class="input-group">
                    <input type="text" class="input-answer" placeholder="–í—ñ–¥–ø–æ–≤—ñ–¥—å..." onchange="saveAnswer('${uniqueId}', this.value)">
                </div>
              `;
            } else {
              actionHTML = `<div class="options-container" id="opts-${uniqueId}">`;
              task.opts.forEach((opt) => {
                const safeOpt = opt.replace(/"/g, "&quot;");
                actionHTML += `<button class="option-btn" onclick="selectOpt('${uniqueId}', '${safeOpt}', this)">${safeOpt}</button>`;
              });
              actionHTML += `</div>`;
            }

            row.innerHTML =
              contentHTML + `<div style="margin-top:5px;">${actionHTML}</div>`;
            taskList.appendChild(row);
          });

          exBlock.appendChild(taskList);
          root.appendChild(exBlock);
        });

        // –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
        const finishSection = document.createElement("div");
        finishSection.className = "finish-section";
        finishSection.innerHTML = `<button class="btn-finish" onclick="finishHomework()">–ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–æ–±–æ—Ç—É</button>`;
        root.appendChild(finishSection);

        if (window.renderMathInElement) {
          renderMathInElement(document.body, {
            delimiters: [{ left: "$", right: "$", display: false }],
            throwOnError: false,
          });
        }
      }

      function saveAnswer(uid, val) {
        userAnswers[uid] = val.trim().replace(",", ".");
      }

      function selectOpt(uid, val, btn) {
        userAnswers[uid] = val;
        const container = document.getElementById(`opts-${uid}`);
        container
          .querySelectorAll(".option-btn")
          .forEach((b) => b.classList.remove("selected"));
        btn.classList.add("selected");
      }

      function finishHomework() {
        const studentName = document.getElementById("studentName").value.trim();
        if (!studentName) {
          alert("–í–≤–µ–¥—ñ—Ç—å —Å–≤–æ—î —ñ–º'—è –∑–≤–µ—Ä—Ö—É!");
          window.scrollTo(0, 0);
          return;
        }
        if (!confirm("–ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–æ–±–æ—Ç—É —ñ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è?")) return;

        // –§–æ—Ä–º—É—î–º–æ –æ–±'—î–∫—Ç –¥–∞–Ω–∏—Ö
        const payload = {
          n: studentName,
          a: userAnswers,
          t: Date.now(),
        };

        // –ö–æ–¥—É—î–º–æ –≤ Base64 –¥–ª—è URL
        const jsonStr = JSON.stringify(payload);
        const encoded = btoa(encodeURIComponent(jsonStr)); // encodeURIComponent handles Cyrillic

        // –ì–µ–Ω–µ—Ä—É—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
        const currentUrl = window.location.href.split("?")[0];
        const resultLink = `${currentUrl}?d=${encoded}`;

        // –ü–æ–∫–∞–∑—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—á–Ω—é
        document.getElementById("generated-link-box").innerText = resultLink;
        document.getElementById("result-modal").style.display = "flex";
        document.getElementById("view-student-finish").style.display = "block";
      }

      function copyLinkToClipboard() {
        const link = document.getElementById("generated-link-box").innerText;
        navigator.clipboard.writeText(link).then(() => {
          alert("–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!");
        });
      }

      // --- –õ–û–ì–Ü–ö–ê –í–ß–ò–¢–ï–õ–Ø ---

      function checkPassword() {
        const pass = document.getElementById("teacher-pass").value;
        if (pass.toLowerCase() === "—è–Ω—á—É–∫") {
          showReport();
        } else {
          document.getElementById("login-error").innerText = "–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å";
        }
      }

      function showReport() {
        const data = decodedData;
        const answers = data.a;

        let correctCount = 0;
        let totalCount = 0;
        const tbody = document.getElementById("report-body");
        tbody.innerHTML = "";

        exercises.forEach((ex) => {
          ex.tasks.forEach((task) => {
            totalCount++;
            const uid = `${ex.id}-${task.id}`;
            const userAns = answers[uid] || "‚Äî";

            let isCorrect = false;
            // Simple equality check (works for generated inputs)
            // For input types allow small diff if numeric?
            // Let's stick to strict string match or simple numeric match
            if (task.type === "input") {
              if (userAns == task.a) isCorrect = true;
            } else {
              if (userAns === task.a) isCorrect = true;
            }

            if (isCorrect) correctCount++;

            const tr = document.createElement("tr");
            tr.className = isCorrect ? "row-correct" : "row-wrong";
            tr.innerHTML = `
                    <td><b>${ex.id} ${task.id}</b><br><small>${task.q}</small></td>
                    <td>${userAns}</td>
                    <td>${task.a}</td>
                `;
            tbody.appendChild(tr);
          });
        });

        const percent = Math.round((correctCount / totalCount) * 100);

        document.getElementById(
          "report-student-name"
        ).innerText = `–£—á–µ–Ω—å: ${data.n}`;
        document.getElementById(
          "report-score"
        ).innerText = `–û—Ü—ñ–Ω–∫–∞: ${percent}% (${correctCount}/${totalCount})`;

        document.getElementById("view-teacher-login").style.display = "none";
        document.getElementById("view-teacher-report").style.display = "block";

        if (window.renderMathInElement) {
          renderMathInElement(document.getElementById("report-body"), {
            delimiters: [{ left: "$", right: "$", display: false }],
          });
        }
      }
    </script>
  </body>
</html>
