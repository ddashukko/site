<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Контрольна робота: Рівняння</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f4f6f9;
        margin: 0;
        padding: 20px;
        color: #333;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
      }
      .card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 25px;
        overflow: hidden;
        border: 1px solid #e1e4e8;
      }
      .card-header {
        background-color: #ebf3ff;
        padding: 15px 20px;
        border-bottom: 1px solid #d1d9e6;
      }
      .card-header h3 {
        margin: 0;
        color: #2c64f6;
        font-size: 18px;
      }
      .section-desc {
        font-size: 13px;
        color: #666;
      }
      .question-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0;
      }
      @media (max-width: 700px) {
        .question-grid {
          grid-template-columns: 1fr;
        }
      }
      .question-row {
        padding: 20px;
        border-bottom: 1px solid #f0f0f0;
        border-right: 1px solid #f0f0f0;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .equation {
        font-size: 19px;
        font-weight: 500;
        font-family: "Times New Roman", Times, serif;
      }
      input[type="text"],
      input[type="number"],
      input[type="password"] {
        padding: 8px;
        border: 1px solid #dcdcdc;
        border-radius: 6px;
        font-size: 16px;
        width: 140px;
      }
      input:focus {
        outline: none;
        border-color: #2c64f6;
      }

      /* Стилі для кнопки здачі */
      .submit-section {
        text-align: center;
        margin-top: 40px;
        margin-bottom: 60px;
      }
      .btn-submit {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 15px 40px;
        border-radius: 8px;
        font-size: 18px;
        cursor: pointer;
        font-weight: bold;
        transition: 0.3s;
      }
      .btn-submit:hover {
        background-color: #218838;
        transform: scale(1.02);
      }

      /* Стилі для звіту вчителя */
      #teacher-report {
        display: none;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
      }
      .score-block {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
      }
      .score-number {
        font-size: 48px;
        color: #2c64f6;
        font-weight: bold;
        display: block;
      }
      .report-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      .report-table th,
      .report-table td {
        padding: 12px;
        border: 1px solid #dee2e6;
        text-align: left;
      }
      .report-table th {
        background-color: #ebf3ff;
      }
      .status-ok {
        color: #28a745;
        font-weight: bold;
      }
      .status-err {
        color: #dc3545;
        font-weight: bold;
      }
      .recommendations {
        background-color: #fff3cd;
        padding: 20px;
        border-radius: 8px;
        margin-top: 30px;
        border-left: 5px solid #ffc107;
      }
      .recommendations h4 {
        margin-top: 0;
        color: #856404;
      }

      /* Стилі для екрану входу */
      #login-screen {
        display: none;
        max-width: 400px;
        margin: 100px auto;
        background: white;
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        text-align: center;
      }
      #login-screen h2 {
        color: #2c64f6;
        margin-top: 0;
      }
      #password-input {
        width: 80%;
        padding: 10px;
        margin: 20px 0;
        border: 1px solid #ccc;
        font-size: 18px;
        text-align: center;
      }
      .btn-login {
        background-color: #2c64f6;
        color: white;
        border: none;
        padding: 10px 30px;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
      }

      /* Блок посилання */
      #result-link-block {
        display: none;
        margin-top: 20px;
        padding: 20px;
        background: #e2e6ea;
        border-radius: 8px;
        text-align: center;
      }
      #result-url {
        width: 80%;
        padding: 10px;
        margin-top: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
  </head>
  <body>
    <div id="login-screen">
      <h2>Вхід для вчителя</h2>
      <p>Ця сторінка містить результати учня.</p>
      <p>Введіть пароль:</p>
      <input type="password" id="password-input" placeholder="Пароль" />
      <br />
      <button class="btn-login" onclick="checkPassword()">Перевірити</button>
      <p id="login-error" style="color: red; display: none; margin-top: 10px">
        Невірний пароль!
      </p>
    </div>

    <div class="container" id="student-view">
      <h1 style="text-align: center; color: #333">
        Підсумкова контрольна робота
      </h1>
      <p style="text-align: center; color: #666">
        Заповніть відповіді та натисніть "Здати роботу" внизу сторінки.
      </p>

      <div class="card">
        <div class="card-header"><h3>I. Значення виразу</h3></div>
        <div class="question-grid">
          <div class="question-row">
            <div class="equation">1) \( 45 + x \), якщо \( x = 25 \)</div>
            <input type="number" id="q1" placeholder="Відповідь" />
          </div>
          <div class="question-row">
            <div class="equation">2) \( 15y \), якщо \( y = 4 \)</div>
            <input type="number" id="q2" placeholder="Відповідь" />
          </div>
          <div class="question-row">
            <div class="equation">3) \( 100 - a \), якщо \( a = 45 \)</div>
            <input type="number" id="q3" placeholder="Відповідь" />
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header"><h3>II. Чи є число коренем? (так/ні)</h3></div>
        <div class="question-grid">
          <div class="question-row">
            <div class="equation">
              4) Чи є \( 5 \) коренем \( x + 12 = 17 \)?
            </div>
            <input type="text" id="q4" placeholder="так/ні" />
          </div>
          <div class="question-row">
            <div class="equation">
              5) Чи є \( 2 \) коренем \( 3x - 4 = 23 \)?
            </div>
            <input type="text" id="q5" placeholder="так/ні" />
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header"><h3>III. Знаходження невідомого</h3></div>
        <div class="question-grid">
          <div class="question-row">
            <div class="equation">6) \( 142 + y = 350 \)</div>
            <input type="number" id="q6" placeholder="..." />
          </div>
          <div class="question-row">
            <div class="equation">7) \( 754 - a = 321 \)</div>
            <input type="number" id="q7" placeholder="..." />
          </div>
          <div class="question-row">
            <div class="equation">8) \( m - 1500 = 850 \)</div>
            <input type="number" id="q8" placeholder="..." />
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header"><h3>IV. Рівняння з дужками</h3></div>
        <div class="question-grid">
          <div class="question-row">
            <div class="equation">9) \( (120 + x) - 400 = 150 \)</div>
            <input type="number" id="q9" placeholder="..." />
          </div>
          <div class="question-row">
            <div class="equation">10) \( (x - 300) + 150 = 250 \)</div>
            <input type="number" id="q10" placeholder="..." />
          </div>
          <div class="question-row">
            <div class="equation">11) \( 500 - (x - 200) = 300 \)</div>
            <input type="number" id="q11" placeholder="..." />
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header"><h3>V. Змінна в обох частинах</h3></div>
        <div class="question-grid">
          <div class="question-row">
            <div class="equation">12) \( 5x = -24 + 2x \)</div>
            <input type="number" id="q12" placeholder="..." />
          </div>
          <div class="question-row">
            <div class="equation">13) \( 8x + 5 = 9x \)</div>
            <input type="number" id="q13" placeholder="..." />
          </div>
          <div class="question-row">
            <div class="equation">14) \( 15 - 3x = 25 + 2x \)</div>
            <input type="number" id="q14" placeholder="..." />
          </div>
          <div class="question-row">
            <div class="equation">15) \( -12x + 15 = 3x - 30 \)</div>
            <input type="number" id="q15" placeholder="..." />
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header"><h3>VI. Десяткові коефіцієнти</h3></div>
        <div class="question-grid">
          <div class="question-row">
            <div class="equation">16) \( 0,3x + 2,5 = 0,5x - 1,5 \)</div>
            <input type="number" id="q16" placeholder="..." />
          </div>
          <div class="question-row">
            <div class="equation">17) \( 0,4x + 50 = 0,6x + 2 \)</div>
            <input type="number" id="q17" placeholder="..." />
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header"><h3>VII. Розкриття дужок</h3></div>
        <div class="question-grid">
          <div class="question-row">
            <div class="equation">18) \( -4(x + 3) = 2x - 18 \)</div>
            <input type="number" id="q18" placeholder="..." />
          </div>
          <div class="question-row">
            <div class="equation">19) \( 5x + 2(4 - x) = 11 + x \)</div>
            <input type="number" id="q19" placeholder="..." />
          </div>
          <div class="question-row">
            <div class="equation">20) \( (10x - 5) - (3 - 2x) = -20 \)</div>
            <input type="number" id="q20" placeholder="..." />
          </div>
          <div class="question-row">
            <div class="equation">21) \( 2(x+1) = 3(x-1) \)</div>
            <input type="number" id="q21" placeholder="..." />
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header"><h3>VIII. Параметр</h3></div>
        <div class="question-grid">
          <div class="question-row">
            <div class="equation">22) \( (x + a) - 5 = 30 \), \( x=15 \)</div>
            <input type="number" id="q22" placeholder="a = ..." />
          </div>
          <div class="question-row">
            <div class="equation">23) \( (a - x) + 3 = 12 \), \( x=4 \)</div>
            <input type="number" id="q23" placeholder="a = ..." />
          </div>
          <div class="question-row">
            <div class="equation">24) \( 2x + a = 10 \), \( x=3 \)</div>
            <input type="number" id="q24" placeholder="a = ..." />
          </div>
        </div>
      </div>

      <div class="submit-section">
        <button class="btn-submit" onclick="finishTest()">
          Завершити та здати роботу
        </button>

        <div id="result-link-block">
          <h3>Роботу завершено!</h3>
          <p>
            Скопіюйте це посилання та надішліть вчителю (Viber, Telegram,
            пошта):
          </p>
          <input type="text" id="result-url" readonly onclick="this.select()" />
          <br /><br />
          <button
            onclick="copyLink()"
            style="
              background: #2c64f6;
              color: white;
              border: none;
              padding: 10px 20px;
              border-radius: 5px;
              cursor: pointer;
            "
          >
            Копіювати посилання
          </button>
        </div>
      </div>
    </div>

    <div class="container" id="teacher-report">
      <h2 style="border-bottom: 2px solid #2c64f6; padding-bottom: 10px">
        Звіт про результати учня
      </h2>

      <div class="score-block">
        Оцінка учня:
        <span class="score-number" id="final-score">0/12</span>
        <span id="score-details"></span>
      </div>

      <div
        class="recommendations"
        id="recommendations-block"
        style="display: none"
      >
        <h4>⚠️ Над чим потрібно попрацювати:</h4>
        <ul id="topic-list"></ul>
      </div>

      <table class="report-table">
        <thead>
          <tr>
            <th>№</th>
            <th>Тема</th>
            <th>Відповідь учня</th>
            <th>Правильно</th>
            <th>Результат</th>
          </tr>
        </thead>
        <tbody id="report-body"></tbody>
      </table>
    </div>

    <script>
      // --- НАЛАШТУВАННЯ ---
      const TEACHER_PASSWORD = "янчук";

      // БАЗА ВІДПОВІДЕЙ
      const ANSWER_KEY = {
        q1: { ans: 70, type: "num", topic: "Значення виразу" },
        q2: { ans: 60, type: "num", topic: "Значення виразу" },
        q3: { ans: 55, type: "num", topic: "Значення виразу" },
        q4: {
          ans: ["так", "yes", "1", "+"],
          type: "text",
          topic: "Перевірка кореня",
        },
        q5: {
          ans: ["ні", "no", "0", "-"],
          type: "text",
          topic: "Перевірка кореня",
        },
        q6: { ans: 208, type: "num", topic: "Прості рівняння" },
        q7: { ans: 433, type: "num", topic: "Прості рівняння" },
        q8: { ans: 2350, type: "num", topic: "Прості рівняння" },
        q9: { ans: 430, type: "num", topic: "Рівняння з дужками" },
        q10: { ans: 400, type: "num", topic: "Рівняння з дужками" },
        q11: { ans: 400, type: "num", topic: "Рівняння з дужками" },
        q12: { ans: -8, type: "num", topic: "Змінна в обох частинах" },
        q13: { ans: 5, type: "num", topic: "Змінна в обох частинах" },
        q14: { ans: -2, type: "num", topic: "Змінна в обох частинах" },
        q15: { ans: 3, type: "num", topic: "Змінна в обох частинах" },
        q16: { ans: 20, type: "num", topic: "Десяткові дроби" },
        q17: { ans: 240, type: "num", topic: "Десяткові дроби" },
        q18: { ans: 1, type: "num", topic: "Розкриття дужок (множення)" },
        q19: { ans: 1.5, type: "num", topic: "Розкриття дужок (множення)" },
        q20: { ans: -1, type: "num", topic: "Розкриття дужок (множення)" },
        q21: { ans: 5, type: "num", topic: "Розкриття дужок (множення)" },
        q22: { ans: 20, type: "num", topic: "Параметр" },
        q23: { ans: 13, type: "num", topic: "Параметр" },
        q24: { ans: 4, type: "num", topic: "Параметр" },
      };

      let globalStudentData = null;

      // 1. ФУНКЦІЯ ЗАВЕРШЕННЯ ТЕСТУ (УЧЕНЬ)
      function finishTest() {
        let studentAnswers = {};
        for (let i = 1; i <= 24; i++) {
          let val = document.getElementById("q" + i).value;
          studentAnswers["q" + i] = val;
        }
        let jsonStr = JSON.stringify(studentAnswers);
        let encoded = btoa(encodeURIComponent(jsonStr));
        let url = window.location.href.split("?")[0] + "?data=" + encoded;

        document.getElementById("result-link-block").style.display = "block";
        document.getElementById("result-url").value = url;
        let inputs = document.getElementsByTagName("input");
        for (let inp of inputs) {
          if (inp.id !== "result-url") inp.disabled = true;
        }
        alert("Роботу завершено! Скопіюйте посилання та надішліть вчителю.");
      }

      function copyLink() {
        let copyText = document.getElementById("result-url");
        copyText.select();
        document.execCommand("copy");
        alert("Посилання скопійовано!");
      }

      // 2. ЗАВАНТАЖЕННЯ СТОРІНКИ
      window.onload = function () {
        const urlParams = new URLSearchParams(window.location.search);
        const dataParam = urlParams.get("data");

        if (dataParam) {
          // Є дані -> це ВЧИТЕЛЬ. Ховаємо тест, показуємо логін.
          document.getElementById("student-view").style.display = "none";
          document.getElementById("login-screen").style.display = "block";

          try {
            let jsonStr = decodeURIComponent(atob(dataParam));
            globalStudentData = JSON.parse(jsonStr);
          } catch (e) {
            alert("Помилка читання даних. Посилання пошкоджене.");
          }
        }

        // Обробка Enter для поля пароля
        document
          .getElementById("password-input")
          .addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
              checkPassword();
            }
          });
      };

      // 3. ПЕРЕВІРКА ПАРОЛЯ
      function checkPassword() {
        const input = document.getElementById("password-input").value;
        const errorMsg = document.getElementById("login-error");

        if (input.trim() === TEACHER_PASSWORD) {
          // Пароль вірний
          document.getElementById("login-screen").style.display = "none";
          document.getElementById("teacher-report").style.display = "block";
          generateReport(globalStudentData);
        } else {
          // Помилка
          errorMsg.style.display = "block";
        }
      }

      // 4. ГЕНЕРАЦІЯ ЗВІТУ
      function generateReport(studentData) {
        if (!studentData) return;

        let correctCount = 0;
        let totalCount = 24;
        let wrongTopics = new Set();
        let tbody = document.getElementById("report-body");

        for (let i = 1; i <= totalCount; i++) {
          let key = "q" + i;
          let userVal = studentData[key];
          let correctVal = ANSWER_KEY[key].ans;
          let topic = ANSWER_KEY[key].topic;
          let type = ANSWER_KEY[key].type;

          let isCorrect = false;

          if (type === "num") {
            let numUser = parseFloat(String(userVal).replace(",", "."));
            if (Math.abs(numUser - correctVal) < 0.01) isCorrect = true;
          } else {
            if (correctVal.includes(String(userVal).trim().toLowerCase()))
              isCorrect = true;
          }

          if (isCorrect) {
            correctCount++;
          } else {
            wrongTopics.add(topic);
          }

          let row = `<tr>
                <td>${i}</td>
                <td>${topic}</td>
                <td>${
                  userVal ? userVal : '<em style="color:#999">пусто</em>'
                }</td>
                <td>${
                  Array.isArray(correctVal) ? correctVal[0] : correctVal
                }</td>
                <td class="${isCorrect ? "status-ok" : "status-err"}">${
            isCorrect ? "✔" : "✖"
          }</td>
            </tr>`;
          tbody.innerHTML += row;
        }

        let score = Math.round((correctCount / totalCount) * 12);
        document.getElementById("final-score").innerText = `${score} / 12`;
        document.getElementById(
          "score-details"
        ).innerText = `(${correctCount} правильних з ${totalCount})`;

        if (wrongTopics.size > 0) {
          let recBlock = document.getElementById("recommendations-block");
          let list = document.getElementById("topic-list");
          recBlock.style.display = "block";
          wrongTopics.forEach((topic) => {
            let li = document.createElement("li");
            li.innerText = topic;
            list.appendChild(li);
          });
        }
      }
    </script>
  </body>
</html>
