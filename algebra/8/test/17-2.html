<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Тест 2: Властивості кореня (17.11-17.21)</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    ></script>
    <style>
      /* Стилі ідентичні тесту №1 */
      :root {
        --primary: #7c3aed;
        --primary-light: #f5f3ff;
        --selected: #dbeafe;
        --selected-border: #3b82f6;
        --success: #16a34a;
        --error: #dc2626;
        --bg: #f8fafc;
        --card: #ffffff;
        --text: #1e293b;
        --border: #e2e8f0;
      }
      body {
        font-family: -apple-system, sans-serif;
        background: var(--bg);
        color: var(--text);
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .test-container {
        max-width: 800px;
        width: 100%;
        background: var(--card);
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }
      header {
        background: var(--primary-light);
        padding: 20px;
        border-bottom: 2px solid var(--primary);
        text-align: center;
      }
      .header-title {
        font-weight: 800;
        font-size: 1.5rem;
        color: var(--primary);
      }
      .question-block {
        padding: 20px;
        border-bottom: 1px solid var(--border);
      }
      .question-text {
        font-size: 1.1rem;
        font-weight: 500;
        margin-bottom: 15px;
      }
      .options {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .option-btn {
        flex: 1;
        min-width: 120px;
        padding: 12px;
        border: 2px solid #e2e8f0;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
        font-size: 1rem;
      }
      .option-btn:hover:not(:disabled) {
        background: var(--primary-light);
        border-color: var(--primary);
      }
      .option-btn.active {
        background: var(--selected);
        border-color: var(--selected-border);
        color: #1e3a8a;
        font-weight: 600;
      }
      .option-btn.correct-answer {
        background: var(--success) !important;
        border-color: var(--success) !important;
        color: white !important;
      }
      .option-btn.wrong-choice {
        background: var(--error) !important;
        border-color: var(--error) !important;
        color: white !important;
      }
      .input-answer {
        padding: 10px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        width: 150px;
        font-size: 1.1rem;
      }
      .input-answer.correct-answer {
        border-color: var(--success);
        background: #f0fdf4;
        color: var(--success);
      }
      .input-answer.wrong-choice {
        border-color: var(--error);
        background: #fef2f2;
        color: var(--error);
      }
      .finish-section {
        padding: 30px;
        text-align: center;
        background: #f8fafc;
      }
      .btn-finish {
        padding: 15px 50px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 50px;
        font-size: 1.2rem;
        cursor: pointer;
      }
      .btn-finish:hover {
        transform: scale(1.05);
      }
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }
      .modal-card {
        background: white;
        padding: 40px;
        border-radius: 20px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <header>
        <div class="header-title">Тест №2: Вправи 17.11 — 17.21</div>
        <div style="color: #64748b; margin-top: 5px">
          Заповніть всі поля та натисніть "Завершити"
        </div>
      </header>

      <div id="questions-container"></div>

      <div class="finish-section">
        <button class="btn-finish" onclick="finishTest()">
          Завершити тест
        </button>
      </div>
    </div>

    <div id="result-modal" class="modal-overlay">
      <div class="modal-card">
        <h2>Результат</h2>
        <h1
          style="color: var(--primary); font-size: 3rem; margin: 10px 0"
          id="score-val"
        >
          0/12
        </h1>
        <p id="feedback-text">...</p>
        <button
          onclick="document.getElementById('result-modal').style.display='none'"
          style="
            margin-top: 20px;
            padding: 10px 20px;
            background: #334155;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
          "
        >
          Переглянути помилки
        </button>
      </div>
    </div>

    <script>
      const questions = [
        {
          id: 1,
          q: "Подайте як частку: $\\sqrt{\\frac{2}{5}}$",
          a: "$\\frac{\\sqrt{2}}{\\sqrt{5}}$",
          opts: [
            "$\\frac{\\sqrt{2}}{\\sqrt{5}}$",
            "$\\frac{2}{5}$",
            "$\\frac{\\sqrt{2}}{5}$",
          ],
        },
        {
          id: 2,
          q: "Подайте як частку: $\\sqrt{3\\frac{2}{7}}$",
          a: "$\\frac{\\sqrt{23}}{\\sqrt{7}}$",
          opts: [
            "$\\frac{\\sqrt{23}}{\\sqrt{7}}$",
            "$\\frac{\\sqrt{3}}{\\sqrt{7}}$",
            "$\\frac{23}{7}$",
          ],
        },
        {
          id: 3,
          q: "Обчисліть: $\\sqrt{2} \\cdot \\sqrt{32}$",
          a: "8",
          type: "input",
        },
        {
          id: 4,
          q: "Обчисліть: $\\sqrt{0,9} \\cdot \\sqrt{2,5}$",
          a: "1.5",
          type: "input",
        },
        {
          id: 5,
          q: "Обчисліть: $\\frac{\\sqrt{45}}{\\sqrt{5}}$",
          a: "3",
          opts: ["3", "9", "5", "$\\sqrt{9}$"],
        },
        {
          id: 6,
          q: "Обчисліть: $\\frac{\\sqrt{24}}{\\sqrt{1,5}}$",
          a: "4",
          opts: ["4", "16", "2", "8"],
        },
        {
          id: 7,
          q: "Обчисліть: $\\sqrt{9^4}$",
          a: "81",
          opts: ["81", "9", "27", "18"],
        },
        {
          id: 8,
          q: "Обчисліть: $\\sqrt{(-2)^{10}}$",
          a: "32",
          opts: ["32", "-32", "1024", "64"],
        },
        {
          id: 9,
          q: "Спростіть: $\\sqrt{m^2}$",
          a: "$|m|$",
          opts: ["$m$", "$|m|$", "$m^2$"],
        },
        {
          id: 10,
          q: "Спростіть: $-0,1\\sqrt{a^2}$",
          a: "$-0,1|a|$",
          opts: ["$-0,1a$", "$-0,1|a|$", "$0,1a$"],
        },
        {
          id: 11,
          q: "Обчисліть: $\\sqrt{4\\frac{33}{64}}$",
          a: "2.125",
          opts: ["2.125", "2.5", "17/8", "19/8"],
        },
        {
          id: 12,
          q: "Обчисліть: $\\sqrt{20^2 - 16^2}$",
          a: "12",
          type: "input",
        },
      ];

      const container = document.getElementById("questions-container");

      questions.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = "question-block";
        div.dataset.ans = item.a;
        div.dataset.type = item.type || "opts";

        let html = `<div class="question-text">${index + 1}. ${item.q}</div>`;

        if (item.type === "input") {
          html += `<input type="text" class="input-answer" placeholder="...">`;
        } else {
          html += `<div class="options">`;
          item.opts.forEach((opt) => {
            const safeOpt = opt.replace(/"/g, "&quot;");
            html += `<button class="option-btn" onclick="selectOpt(this, '${safeOpt}')">${opt}</button>`;
          });
          html += `</div>`;
        }
        div.innerHTML = html;
        container.appendChild(div);
      });

      function selectOpt(btn, val) {
        const parent = btn.closest(".options");
        parent
          .querySelectorAll(".option-btn")
          .forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        btn.closest(".question-block").dataset.userChoice = val;
      }

      function finishTest() {
        const blocks = document.querySelectorAll(".question-block");
        let score = 0;

        blocks.forEach((block) => {
          const correct = block.dataset.ans;
          const type = block.dataset.type;
          let isCorrect = false;

          if (type === "input") {
            const input = block.querySelector("input");
            const val = input.value.trim().replace(",", ".");
            if (val == correct) {
              // Нестроге порівняння для чисел (12 == "12")
              isCorrect = true;
              input.classList.add("correct-answer");
            } else {
              input.classList.add("wrong-choice");
              // Можна додати підказку input.value += ` (Правильно: ${correct})`;
            }
          } else {
            const choice = block.dataset.userChoice;
            const normChoice = choice ? choice.replace(/\s/g, "") : "";
            const normCorrect = correct.replace(/\s/g, "");

            if (normChoice === normCorrect) isCorrect = true;

            const btns = block.querySelectorAll(".option-btn");
            btns.forEach((btn) => {
              const btnVal = btn
                .getAttribute("onclick")
                .match(/'([^']+)'/)[1]
                .replace(/\s/g, "");

              if (btnVal === normCorrect) btn.classList.add("correct-answer");
              if (btn.classList.contains("active") && !isCorrect)
                btn.classList.add("wrong-choice");

              btn.disabled = true;
            });
          }

          if (isCorrect) score++;
        });

        document.getElementById(
          "score-val"
        ).innerText = `${score}/${questions.length}`;

        let msg = "Добре!";
        if (score === questions.length) msg = "Бездоганно!";
        else if (score < questions.length / 2) msg = "Спробуй ще раз";

        document.getElementById("feedback-text").innerText = msg;
        document.getElementById("result-modal").style.display = "flex";
      }

      document.addEventListener("DOMContentLoaded", () => {
        if (window.renderMathInElement) {
          renderMathInElement(document.body, {
            delimiters: [{ left: "$", right: "$", display: false }],
            throwOnError: false,
          });
        }
      });
    </script>
  </body>
</html>
