<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>8 –ö–ª–∞—Å: –ì–µ–æ–º–µ—Ç—Ä–∏—á–Ω–∏–π –Ü–Ω—Ç–µ–Ω—Å–∏–≤ + –ê–ª–≥–µ–±—Ä–∞</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    ></script>

    <style>
      :root {
        /* –ö–æ–ª—å–æ—Ä–∏: "–ì–µ–æ–º–µ—Ç—Ä–∏—á–Ω–∏–π —ñ–Ω–¥–∏–≥–æ" —Ç–∞ "–ú'—è—Ç–Ω–∏–π —Å–ø–æ–∫—ñ–π" */
        --primary: #4338ca; /* Indigo 700 */
        --primary-light: #e0e7ff; 
        --secondary: #0f766e; /* Teal 700 */
        --accent: #f59e0b; /* Amber hints */
        --success: #16a34a;
        --error: #e11d48;
        --bg: #f8fafc;
        --card: #ffffff;
        --text: #1e293b;
        --border: #cbd5e1;
      }

      body {
        font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background-color: var(--bg);
        color: var(--text);
        margin: 0;
        height: 100vh;
        display: flex;
        overflow: hidden;
      }

      /* --- –õ–Ü–í–ê –ü–ê–ù–ï–õ–¨ --- */
      #content-area {
        flex: 1.3;
        overflow-y: auto;
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        background: var(--bg);
      }

      header {
        background: var(--card);
        padding: 15px 25px;
        border-bottom: 3px solid var(--primary);
        position: sticky;
        top: 0;
        z-index: 50;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .title-group h1 { margin: 0; font-size: 1.3rem; color: var(--primary); }
      .title-group p { margin: 0; font-size: 0.85rem; color: #64748b; }
      
      .score-box {
        font-weight: 700;
        background: var(--primary-light);
        padding: 6px 16px;
        border-radius: 20px;
        color: var(--primary);
      }

      .modules-wrapper {
        padding: 30px;
        padding-bottom: 120px;
        max-width: 950px;
        margin: 0 auto;
        width: 100%;
        box-sizing: border-box;
      }

      .module-section {
        background: var(--card);
        border-radius: 16px;
        border: 1px solid var(--border);
        margin-bottom: 40px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
      }

      .module-head {
        background: linear-gradient(90deg, #eef2ff 0%, #ffffff 100%);
        padding: 20px 25px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 15px;
      }
      .module-head h3 { margin: 0; color: var(--primary); font-size: 1.2rem; }
      .icon { font-size: 1.6rem; }

      .theory-block {
        padding: 20px 25px;
        color: #334155;
        font-size: 1rem;
        line-height: 1.6;
        border-bottom: 1px dashed var(--border);
      }
      .rule-box {
        background: #fffbeb;
        border-left: 4px solid var(--accent);
        padding: 12px;
        margin: 15px 0;
        border-radius: 4px;
        font-weight: 500;
      }
      
      .hard-badge {
        background: #4338ca;
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.7rem;
        text-transform: uppercase;
        vertical-align: middle;
        margin-left: 5px;
      }

      .tasks-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 15px;
        padding: 25px;
        background: #f8fafc;
      }

      .task-item {
        background: white;
        padding: 15px;
        border-radius: 10px;
        border: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        transition: all 0.2s;
        position: relative;
      }
      .task-item:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
      .task-item.correct { border-color: var(--success); background: #f0fdf4; }
      .task-item.wrong { border-color: var(--error); background: #fef2f2; }

      .q-text { font-weight: 600; font-size: 1.05rem; margin-bottom: 12px; }
      
      .input-row { display: flex; gap: 8px; margin-top: auto; }
      .ans-field {
        flex: 1; padding: 8px;
        border: 1px solid var(--border); border-radius: 6px;
        font-size: 1rem; outline: none;
      }
      .btn-ok {
        background: var(--primary); color: white; border: none;
        padding: 0 16px; border-radius: 6px; cursor: pointer; font-weight: 600;
      }
      .btn-ok:hover { background: #3730a3; }

      .btn-opt {
        flex: 1; background: white; border: 1px solid var(--border);
        padding: 8px; border-radius: 6px; cursor: pointer; color: var(--text);
        font-size: 0.9rem; transition: 0.2s;
      }
      .btn-opt:hover { border-color: var(--primary); color: var(--primary); }

      .help-links { margin-top: 10px; display: flex; gap: 15px; font-size: 0.85rem; }
      .h-link { background: none; border: none; color: #64748b; cursor: pointer; padding: 0; text-decoration: underline; }
      
      .hint-content, .sol-content {
        display: none; margin-top: 10px; padding: 10px; border-radius: 6px; font-size: 0.9rem;
      }
      .hint-content { background: #fffbeb; color: #b45309; }
      .sol-content { background: #eff6ff; color: #1e40af; }

      /* --- –ü–†–ê–í–ê –ü–ê–ù–ï–õ–¨ --- */
      #board-area {
        flex: 0.7;
        position: relative;
        background: white;
        background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
        background-size: 20px 20px;
        border-left: 1px solid var(--border);
      }
      
      .toolbar {
        position: absolute; top: 15px; left: 15px;
        background: white; padding: 8px; border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: flex; gap: 8px; z-index: 10;
        flex-wrap: wrap; max-width: 250px;
      }
      .t-btn {
        width: 38px; height: 38px; border: 1px solid var(--border);
        border-radius: 8px; background: white; cursor: pointer; font-size: 1.2rem;
        display: flex; align-items: center; justify-content: center;
      }
      .t-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

      /* Modal */
      .modal-bg {
        display: none; position: fixed; top:0; left:0; width:100%; height:100%;
        background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 999;
        justify-content: center; align-items: center;
      }
      .modal-wrap {
        background: white; padding: 40px; border-radius: 20px;
        text-align: center; max-width: 500px; width: 90%;
        animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      @keyframes popUp { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }

      .finish-btn {
        display: block; margin: 0 auto; padding: 15px 40px;
        background: var(--text); color: white; border: none; border-radius: 50px;
        font-size: 1.1rem; cursor: pointer; font-weight: bold;
        box-shadow: 0 10px 20px rgba(0,0,0,0.15); transition: transform 0.2s;
      }
      .finish-btn:hover { transform: scale(1.05); }

      @media (max-width: 900px) {
        body { flex-direction: column; }
        #board-area { height: 35vh; order: 1; border-bottom: 2px solid var(--border); }
        #content-area { height: 65vh; order: 2; }
      }
    </style>
  </head>
  <body>

    <div id="content-area">
      <header>
        <div class="title-group">
          <h1>–ì–µ–æ–º–µ—Ç—Ä—ñ—è + –ê–ª–≥–µ–±—Ä–∞ (8 –∫–ª–∞—Å)</h1>
          <p>–ê–∫—Ü–µ–Ω—Ç: –§—ñ–≥—É—Ä–∏, –ü–ª–æ—â—ñ, –ö–æ—Ä–µ–Ω—ñ</p>
        </div>
        <div class="score-box">
          –ü—Ä–æ–≥—Ä–µ—Å: <span id="solved-count">0</span> / <span id="total-count">0</span>
        </div>
      </header>

      <div class="modules-wrapper" id="modules-root">
        </div>
      
      <div style="padding-bottom: 40px;">
        <button class="finish-btn" onclick="finishLesson()">–ó–∞–≤–µ—Ä—à–∏—Ç–∏ —É—Ä–æ–∫</button>
      </div>
    </div>

    <div id="board-area">
      <div class="toolbar">
        <button class="t-btn active" onclick="setTool('pen')" id="btn-pen" title="–†—É—á–∫–∞">‚úèÔ∏è</button>
        <button class="t-btn" onclick="setTool('eraser')" id="btn-eraser" title="–ì—É–º–∫–∞">üßπ</button>
        <div style="width:1px; background:#e2e8f0; height:25px; margin:auto 0;"></div>
        <button class="t-btn" onclick="drawShape('rect')" title="–ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫">‚¨ú</button>
        <button class="t-btn" onclick="drawShape('tri')" title="–ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–π —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫">üìê</button>
        <button class="t-btn" onclick="drawShape('trap')" title="–¢—Ä–∞–ø–µ—Ü—ñ—è">üèóÔ∏è</button>
        <button class="t-btn" onclick="clearBoard()" style="color:red; border-color:#fecaca" title="–û—á–∏—Å—Ç–∏—Ç–∏">üóëÔ∏è</button>
      </div>
      <canvas id="board"></canvas>
    </div>

    <div id="result-modal" class="modal-bg">
      <div class="modal-wrap">
        <h2 id="m-title" style="color:var(--primary); font-size:2rem; margin:0 0 10px 0;"></h2>
        <div id="m-msg" style="color:#64748b; font-size:1.1rem; margin-bottom:25px;"></div>
        <div style="font-size:3.5rem; font-weight:900; color:var(--text); margin-bottom:20px;" id="m-score"></div>
        <button onclick="closeModal()" style="padding:10px 30px; background:var(--primary); color:white; border:none; border-radius:8px; font-size:1rem; cursor:pointer;">–ó—Ä–æ–∑—É–º—ñ–ª–æ</button>
      </div>
    </div>

    <script>
      /* --- –î–ê–ù–Ü –£–†–û–ö–£ --- */
      const modules = [
        {
          title: "1. –ö–≤–∞–¥—Ä–∞—Ç–Ω—ñ –∫–æ—Ä–µ–Ω—ñ (–ë–∞–∑–∞ + –°–∫–ª–∞–¥–Ω—ñ)",
          icon: "üå±",
          theory: `
            <p>–ö–æ—Ä—ñ–Ω—å ‚Äî —Ü–µ —á–∏—Å–ª–æ, —è–∫–µ –ø—Ä–∏ –ø—ñ–¥–Ω–µ—Å–µ–Ω–Ω—ñ –¥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –¥–∞—î —Ç–µ, —â–æ "–ø—ñ–¥ –¥–∞—Ö–æ–º".</p>
            <div class="rule-box">
              1. $\\sqrt{a \\cdot b} = \\sqrt{a} \\cdot \\sqrt{b}$ (–º–æ–∂–Ω–∞ —Ä–æ–∑–±–∏–≤–∞—Ç–∏ —ñ –∑'—î–¥–Ω—É–≤–∞—Ç–∏)<br>
              2. $(\\sqrt{a})^2 = a$<br>
              3. $\\sqrt{a^2} = |a|$ (–ø–∞–º'—è—Ç–∞–π –ø—Ä–æ –º–æ–¥—É–ª—å, —è–∫—â–æ –ø—ñ–¥ –∫–æ—Ä–µ–Ω–µ–º –º—ñ–Ω—É—Å!)
            </div>
            <p>–ö–æ—Ä—ñ–Ω—å –∑ —Å—É–º–∏ $\\sqrt{a+b}$ <b>–ù–ï</b> –¥–æ—Ä—ñ–≤–Ω—é—î —Å—É–º—ñ –∫–æ—Ä–µ–Ω—ñ–≤!</p>
          `,
          tasks: [
            { q: "–û–±—á–∏—Å–ª–∏ $\\sqrt{81}$", a: ["9"], hint: "–¢–∞–±–ª–∏—Ü—è –º–Ω–æ–∂–µ–Ω–Ω—è: $9 \\cdot 9$", sol: "9" },
            { q: "–û–±—á–∏—Å–ª–∏ $\\sqrt{121}$", a: ["11"], hint: "$10 \\cdot 10 = 100$, –∞ —Ü–µ —Ç—Ä–æ—Ö–∏ –±—ñ–ª—å—à–µ.", sol: "11" },
            { q: "–û–±—á–∏—Å–ª–∏ $\\sqrt{0.49}$", a: ["0.7"], hint: "–ú–∞—î –±—É—Ç–∏ –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞ –ø—ñ—Å–ª—è –∫–æ–º–∏.", sol: "$0.7 \\cdot 0.7 = 0.49$" },
            { q: "–û–±—á–∏—Å–ª–∏ $2\\sqrt{9}$", a: ["6"], hint: "–°–ø–æ—á–∞—Ç–∫—É –∫–æ—Ä—ñ–Ω—å, –ø–æ—Ç—ñ–º –º–Ω–æ–∂–µ–Ω–Ω—è.", sol: "$2 \\cdot 3 = 6$" },
            { q: "–û–±—á–∏—Å–ª–∏ $\\sqrt{2} \\cdot \\sqrt{8}$", a: ["4"], hint: "–ó–∞–Ω–µ—Å–∏ –ø—ñ–¥ –æ–¥–∏–Ω –∫–æ—Ä—ñ–Ω—å: $\\sqrt{2 \\cdot 8}$", sol: "$\\sqrt{16} = 4$" },
            { q: "–û–±—á–∏—Å–ª–∏ $\\sqrt{3^2}$", a: ["3"], hint: "–ö–≤–∞–¥—Ä–∞—Ç —ñ –∫–æ—Ä—ñ–Ω—å –∑'—ó–¥–∞—é—Ç—å –æ–¥–∏–Ω –æ–¥–Ω–æ–≥–æ.", sol: "3" },
            { q: "–û–±—á–∏—Å–ª–∏ $(\\sqrt{15})^2$", a: ["15"], hint: "–ö–æ—Ä—ñ–Ω—å —É –∫–≤–∞–¥—Ä–∞—Ç—ñ ‚Äî —Ü–µ –ø—ñ–¥–∫–æ—Ä–µ–Ω–µ–≤–µ —á–∏—Å–ª–æ.", sol: "15" },
            { q: "–û–±—á–∏—Å–ª–∏ $\\sqrt{(-7)^2}$", a: ["7"], hint: "–£–≤–∞–≥–∞! –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥'—î–º–Ω–∏–º. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π –º–æ–¥—É–ª—å.", sol: "$|-7| = 7$" },
            { q: "–û–±—á–∏—Å–ª–∏ $\\sqrt{13^2 - 12^2}$", a: ["5"], hint: "–°–ø–æ—á–∞—Ç–∫—É –ø—ñ–¥–Ω–µ—Å–∏ –¥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ —ñ –≤—ñ–¥–Ω—ñ–º–∏.", sol: "$169 - 144 = 25$. $\\sqrt{25}=5$." },
            { q: "–û–±—á–∏—Å–ª–∏ $\\sqrt{16 + 9}$", a: ["5"], hint: "–î–æ–¥–∞–π, –ø–æ—Ç—ñ–º –¥–æ–±—É–¥—å –∫–æ—Ä—ñ–Ω—å. –¶–µ –Ω–µ 4+3!", sol: "$\\sqrt{25}=5$" },
            { q: "–ó–Ω–∞–π–¥–∏ $x$, —è–∫—â–æ $\\sqrt{x} - 1 = 5$", a: ["36"], hint: "$\\sqrt{x} = 6$. –©–æ –¥–∞—î 6?", sol: "$6^2 = 36$" },
            { q: "–°–ø—Ä–æ—Å—Ç–∏: $\\sqrt{50}$", opts: ["5‚àö2", "2‚àö5", "25‚àö2"], a: "5‚àö2", hint: "$50 = 25 \\cdot 2$. –í–∏–Ω–µ—Å–∏ –∫–æ—Ä—ñ–Ω—å –∑ 25.", sol: "$\\sqrt{25 \\cdot 2} = 5\\sqrt{2}$" }
          ]
        },
        {
          title: "2. –°—Ç–µ–ø–µ–Ω—ñ (3 –≤–∞–∂–∫—ñ –ø—Ä–∏–∫–ª–∞–¥–∏)",
          icon: "‚ö°",
          theory: `
            <p>–ó–≥–∞–¥—É—î–º–æ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –¥–ª—è —Å–∫–ª–∞–¥–Ω—ñ—à–∏—Ö –≤–∏–ø–∞–¥–∫—ñ–≤:</p>
            <div class="rule-box">
              $(a^n)^m = a^{n \\cdot m}$ (—Å—Ç–µ–ø–µ–Ω—ñ –ø–µ—Ä–µ–º–Ω–æ–∂—É—é—Ç—å—Å—è)<br>
              $\\frac{a^n}{a^m} = a^{n-m}$ (–ø—Ä–∏ –¥—ñ–ª–µ–Ω–Ω—ñ –≤—ñ–¥–Ω—ñ–º–∞—é—Ç—å—Å—è)<br>
              $(-1)^{–ø–∞—Ä–Ω–∏–π} = 1$, $(-1)^{–Ω–µ–ø–∞—Ä–Ω–∏–π} = -1$
            </div>
          `,
          tasks: [
            { q: "–û–±—á–∏—Å–ª–∏: $\\frac{(2^3)^4}{2^{10}}$", a: ["4"], hint: "–ó–≤–µ—Ä—Ö—É –±—É–¥–µ $2^{12}$. –ü–æ—Ç—ñ–º –≤—ñ–¥–Ω—ñ–º–∏ —Å—Ç–µ–ø–µ–Ω—ñ.", sol: "$2^{12} : 2^{10} = 2^2 = 4$" },
            { q: "–û–±—á–∏—Å–ª–∏: $5^7 \\cdot 5^4 : (5^3)^3$", a: ["25"], hint: "–ü–æ—Ä—è–¥–æ–∫ –¥—ñ–π: –¥—É–∂–∫–∏, –º–Ω–æ–∂–µ–Ω–Ω—è (–¥–æ–¥–∞–≤–∞–Ω–Ω—è), –¥—ñ–ª–µ–Ω–Ω—è (–≤—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è).", sol: "$5^{11} : 5^9 = 5^2 = 25$" },
            { q: "–ó–Ω–∞–π–¥–∏ –∑–Ω–∞—á–µ–Ω–Ω—è: $(-1)^{100} + (-1)^{101}$", a: ["0"], hint: "–ü–∞—Ä–Ω–∏–π —Å—Ç–µ–ø—ñ–Ω—å –∑'—ó–¥–∞—î –º—ñ–Ω—É—Å, –Ω–µ–ø–∞—Ä–Ω–∏–π ‚Äî –ª–∏—à–∞—î.", sol: "$1 + (-1) = 0$" }
          ]
        },
        {
          title: "3. –ì–µ–æ–º–µ—Ç—Ä—ñ—è: –ß–æ—Ç–∏—Ä–∏–∫—É—Ç–Ω–∏–∫–∏ (–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ)",
          icon: "üî∑",
          theory: `
            <p><b>–†–æ–¥–∏–Ω–∞ –ü–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º—ñ–≤:</b> –ü—Ä–æ—Ç–∏–ª–µ–∂–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ —ñ —Ä—ñ–≤–Ω—ñ.</p>
            <ul>
              <li><b>–†–æ–º–±:</b> –í—Å—ñ —Å—Ç–æ—Ä–æ–Ω–∏ —Ä—ñ–≤–Ω—ñ, –¥—ñ–∞–≥–æ–Ω–∞–ª—ñ –ø–µ—Ä–µ—Ç–∏–Ω–∞—é—Ç—å—Å—è –ø—ñ–¥ –∫—É—Ç–æ–º $90^\\circ$.</li>
              <li><b>–ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫:</b> –í—Å—ñ –∫—É—Ç–∏ $90^\\circ$, –¥—ñ–∞–≥–æ–Ω–∞–ª—ñ —Ä—ñ–≤–Ω—ñ.</li>
              <li><b>–¢—Ä–∞–ø–µ—Ü—ñ—è:</b> –¢—ñ–ª—å–∫–∏ –¥–≤—ñ —Å—Ç–æ—Ä–æ–Ω–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ (–æ—Å–Ω–æ–≤–∏). –°–µ—Ä–µ–¥–Ω—è –ª—ñ–Ω—ñ—è = –ø—ñ–≤—Å—É–º—ñ –æ—Å–Ω–æ–≤.</li>
            </ul>
            <p>–°—É–º–∞ –∫—É—Ç—ñ–≤, –ø—Ä–∏–ª–µ–≥–ª–∏—Ö –¥–æ –æ–¥–Ω—ñ—î—ó —Å—Ç–æ—Ä–æ–Ω–∏ –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞/—Ä–æ–º–±–∞ = $180^\\circ$.</p>
          `,
          tasks: [
            { q: "–°—É–º–∞ –∫—É—Ç—ñ–≤ –±—É–¥—å-—è–∫–æ–≥–æ —á–æ—Ç–∏—Ä–∏–∫—É—Ç–Ω–∏–∫–∞?", a: ["360"], hint: "2 —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∏.", sol: "360 –≥—Ä–∞–¥—É—Å—ñ–≤." },
            { q: "–ì–æ—Å—Ç—Ä–∏–π –∫—É—Ç —Ä–æ–º–±–∞ $60^\\circ$. –ß–æ–º—É –¥–æ—Ä—ñ–≤–Ω—é—î —Ç—É–ø–∏–π –∫—É—Ç?", a: ["120"], hint: "$180 - 60$.", sol: "120 –≥—Ä–∞–¥—É—Å—ñ–≤." },
            { q: "–°—Ç–æ—Ä–æ–Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç–∞ 8. –ß–æ–º—É –¥–æ—Ä—ñ–≤–Ω—é—î –ø–µ—Ä–∏–º–µ—Ç—Ä?", a: ["32"], hint: "4 —Å—Ç–æ—Ä–æ–Ω–∏.", sol: "$8 \\cdot 4 = 32$" },
            { q: "–£ –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞ —Å—Ç–æ—Ä–æ–Ω–∏ 3 —ñ 7. –ó–Ω–∞–π–¥–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä.", a: ["20"], hint: "$(3+7) \\cdot 2$", sol: "20" },
            { q: "–û—Å–Ω–æ–≤–∏ —Ç—Ä–∞–ø–µ—Ü—ñ—ó 4 —ñ 10. –ó–Ω–∞–π–¥–∏ —Å–µ—Ä–µ–¥–Ω—é –ª—ñ–Ω—ñ—é.", a: ["7"], hint: "$(4+10) : 2$", sol: "7" },
            { q: "–î—ñ–∞–≥–æ–Ω–∞–ª—ñ —Ä–æ–º–±–∞ –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ñ?", opts: ["–¢–∞–∫", "–ù—ñ"], a: "–¢–∞–∫", hint: "–¶–µ –π–æ–≥–æ —Ñ—ñ—à–∫–∞.", sol: "–¢–∞–∫, –ø–µ—Ä–µ—Ç–∏–Ω–∞—é—Ç—å—Å—è –ø—ñ–¥ –ø—Ä—è–º–∏–º –∫—É—Ç–æ–º." },
            { q: "–î—ñ–∞–≥–æ–Ω–∞–ª—ñ –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞ —Ä—ñ–≤–Ω—ñ?", opts: ["–¢–∞–∫", "–ù—ñ"], a: "–¢–∞–∫", hint: "–ó–∞–≤–∂–¥–∏.", sol: "–¢–∞–∫." },
            { q: "–ö—É—Ç –º—ñ–∂ —Å—Ç–æ—Ä–æ–Ω–æ—é —ñ –¥—ñ–∞–≥–æ–Ω–∞–ª–ª—é –∫–≤–∞–¥—Ä–∞—Ç–∞?", a: ["45"], hint: "–î—ñ–∞–≥–æ–Ω–∞–ª—å –¥—ñ–ª–∏—Ç—å –∫—É—Ç $90^\\circ$ –Ω–∞–≤–ø—ñ–ª.", sol: "45 –≥—Ä–∞–¥—É—Å—ñ–≤." },
            { q: "–ü–µ—Ä–∏–º–µ—Ç—Ä —Ä–æ–º–±–∞ 40. –ó–Ω–∞–π–¥–∏ —Å—Ç–æ—Ä–æ–Ω—É.", a: ["10"], hint: "–£ —Ä–æ–º–±–∞ –≤—Å—ñ —Å—Ç–æ—Ä–æ–Ω–∏ —Ä—ñ–≤–Ω—ñ.", sol: "40 : 4 = 10" },
            { q: "–°—É–º–∞ –∫—É—Ç—ñ–≤ —Ç—Ä–∞–ø–µ—Ü—ñ—ó, –ø—Ä–∏–ª–µ–≥–ª–∏—Ö –¥–æ –±—ñ—á–Ω–æ—ó —Å—Ç–æ—Ä–æ–Ω–∏?", a: ["180"], hint: "–í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ.", sol: "180 –≥—Ä–∞–¥—É—Å—ñ–≤." }
          ]
        },
        {
          title: "4. –ì–µ–æ–º–µ—Ç—Ä—ñ—è: –¢–µ–æ—Ä–µ–º–∞ –ü—ñ—Ñ–∞–≥–æ—Ä–∞, –ü–ª–æ—â—ñ, –¢—Ä–∏–∫—É—Ç–Ω–∏–∫–∏",
          icon: "üìê",
          theory: `
            <p><b>–¢–µ–æ—Ä–µ–º–∞ –ü—ñ—Ñ–∞–≥–æ—Ä–∞ (—Ç—ñ–ª—å–∫–∏ –¥–ª—è $90^\\circ$ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞):</b><br> 
            $$c^2 = a^2 + b^2$$ (–ì—ñ–ø–æ—Ç–µ–Ω—É–∑–∞ –Ω–∞–π–¥–æ–≤—à–∞).</p>
            
            <p><b>–ü–ª–æ—â—ñ ($S$):</b></p>
            <ul>
              <li>–ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫: $S = a \\cdot b$</li>
              <li>–ö–≤–∞–¥—Ä–∞—Ç: $S = a^2$</li>
              <li>–ü–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º: $S = a \\cdot h$ (–æ—Å–Ω–æ–≤–∞ –Ω–∞ –≤–∏—Å–æ—Ç—É)</li>
              <li>–¢—Ä–∏–∫—É—Ç–Ω–∏–∫: $S = \\frac{1}{2} a \\cdot h$</li>
              <li>–ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–π —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫: $S = \\frac{1}{2} a \\cdot b$ (–ø–æ–ª–æ–≤–∏–Ω–∞ –¥–æ–±—É—Ç–∫—É –∫–∞—Ç–µ—Ç—ñ–≤)</li>
            </ul>
          `,
          tasks: [
            { q: "–ö–∞—Ç–µ—Ç–∏ 3 —ñ 4. –ó–Ω–∞–π–¥–∏ –≥—ñ–ø–æ—Ç–µ–Ω—É–∑—É.", a: ["5"], hint: "$\\sqrt{3^2+4^2}$", sol: "5 (–Ñ–≥–∏–ø–µ—Ç—Å—å–∫–∏–π —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫)" },
            { q: "–ö–∞—Ç–µ—Ç–∏ 6 —ñ 8. –ó–Ω–∞–π–¥–∏ –≥—ñ–ø–æ—Ç–µ–Ω—É–∑—É.", a: ["10"], hint: "$\\sqrt{36+64}$", sol: "$\\sqrt{100}=10$" },
            { q: "–ì—ñ–ø–æ—Ç–µ–Ω—É–∑–∞ 13, –∫–∞—Ç–µ—Ç 5. –ó–Ω–∞–π–¥–∏ —ñ–Ω—à–∏–π –∫–∞—Ç–µ—Ç.", a: ["12"], hint: "$\\sqrt{169-25}$", sol: "12" },
            { q: "–°—Ç–æ—Ä–æ–Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç–∞ 6. –ó–Ω–∞–π–¥–∏ –ø–ª–æ—â—É.", a: ["36"], hint: "$6^2$", sol: "36" },
            { q: "–°—Ç–æ—Ä–æ–Ω–∏ –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞ 5 —ñ 8. –ó–Ω–∞–π–¥–∏ –ø–ª–æ—â—É.", a: ["40"], hint: "$5 \\cdot 8$", sol: "40" },
            { q: "–ö–∞—Ç–µ—Ç–∏ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ 4 —ñ 5. –ó–Ω–∞–π–¥–∏ –π–æ–≥–æ –ø–ª–æ—â—É.", a: ["10"], hint: "$(4 \\cdot 5) : 2$", sol: "10" },
            { q: "–û—Å–Ω–æ–≤–∞ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ 10, –≤–∏—Å–æ—Ç–∞ 4. –ó–Ω–∞–π–¥–∏ –ø–ª–æ—â—É.", a: ["20"], hint: "–ü–æ–ª–æ–≤–∏–Ω–∞ –¥–æ–±—É—Ç–∫—É.", sol: "$\\frac{1}{2} \\cdot 10 \\cdot 4 = 20$" },
            { q: "–ü–ª–æ—â–∞ –∫–≤–∞–¥—Ä–∞—Ç–∞ 49. –ó–Ω–∞–π–¥–∏ —Å—Ç–æ—Ä–æ–Ω—É.", a: ["7"], hint: "–ö–æ—Ä—ñ–Ω—å –∑ 49.", sol: "7" },
            { q: "–î—ñ–∞–≥–æ–Ω–∞–ª—å –∫–≤–∞–¥—Ä–∞—Ç–∞ –∑—ñ —Å—Ç–æ—Ä–æ–Ω–æ—é 1 –¥–æ—Ä—ñ–≤–Ω—é—î...", opts: ["1", "‚àö2", "2"], a: "‚àö2", hint: "–ó–∞ –ü—ñ—Ñ–∞–≥–æ—Ä–æ–º $1^2+1^2=2$.", sol: "$\\sqrt{2}$" },
            { q: "–ß–∏ —î —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫ –∑—ñ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ 5, 6, 8 –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–º?", opts: ["–¢–∞–∫", "–ù—ñ"], a: "–ù—ñ", hint: "$25+36 = 61$, –∞ $8^2=64$.", sol: "–ù—ñ, –±–æ $61 \\neq 64$." },
            { q: "–ü–µ—Ä–∏–º–µ—Ç—Ä —Ä—ñ–≤–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—å–æ–≥–æ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ 30. –ó–Ω–∞–π–¥–∏ —Å—Ç–æ—Ä–æ–Ω—É.", a: ["10"], hint: "3 —Ä—ñ–≤–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏.", sol: "10" },
            { q: "–£ –ø—Ä—è–º–æ–∫—É—Ç–Ω–æ–º—É —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫—É –∫–∞—Ç–µ—Ç –ª–µ–∂–∞—á–∏–π –ø—Ä–æ—Ç–∏ –∫—É—Ç–∞ $30^\\circ$ –¥–æ—Ä—ñ–≤–Ω—é—î...", opts: ["–ü–æ–ª–æ–≤–∏–Ω—ñ –≥—ñ–ø–æ—Ç–µ–Ω—É–∑–∏", "–ì—ñ–ø–æ—Ç–µ–Ω—É–∑—ñ"], a: "–ü–æ–ª–æ–≤–∏–Ω—ñ –≥—ñ–ø–æ—Ç–µ–Ω—É–∑–∏", hint: "–í–∞–∂–ª–∏–≤–∞ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å.", sol: "–ü–æ–ª–æ–≤–∏–Ω—ñ –≥—ñ–ø–æ—Ç–µ–Ω—É–∑–∏." },
            { q: "–ü–ª–æ—â–∞ –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞: —Å—Ç–æ—Ä–æ–Ω–∞ 10, –≤–∏—Å–æ—Ç–∞ 5. $S = ...$", a: ["50"], hint: "$a \\cdot h$ –±–µ–∑ 1/2!", sol: "50" },
            { q: "–ó–Ω–∞–π–¥–∏ –¥—ñ–∞–≥–æ–Ω–∞–ª—å –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞ –∑—ñ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ 8 —ñ 15.", a: ["17"], hint: "$\\sqrt{64+225} = \\sqrt{289}$", sol: "17" },
            { q: "–ü–ª–æ—â–∞ —Ä–æ–º–±–∞ –∑ –¥—ñ–∞–≥–æ–Ω–∞–ª—è–º–∏ 10 —ñ 20.", a: ["100"], hint: "$\\frac{d_1 \\cdot d_2}{2}$", sol: "$\\frac{200}{2} = 100$" }
          ]
        }
      ];

      /* --- JS LOGIC --- */
      let totalTasks = 0;
      let solvedTasks = 0;

      document.addEventListener("DOMContentLoaded", () => {
        const root = document.getElementById('modules-root');
        
        modules.forEach((mod, mIdx) => {
          totalTasks += mod.tasks.length;
          
          const section = document.createElement('div');
          section.className = 'module-section';
          
          // Header + Theory
          section.innerHTML = `
            <div class="module-head">
              <span class="icon">${mod.icon}</span>
              <h3>${mod.title}</h3>
            </div>
            <div class="theory-block">${mod.theory}</div>
          `;

          // Tasks Grid
          const grid = document.createElement('div');
          grid.className = 'tasks-container';

          mod.tasks.forEach((task, tIdx) => {
            const uid = `t-${mIdx}-${tIdx}`;
            
            // Generate Input or Buttons
            let controlHTML = '';
            if (task.opts) {
              controlHTML = `<div class="input-row">
                ${task.opts.map(opt => `<button class="btn-opt" onclick="checkOpt(this, '${opt}', '${task.a}', '${uid}')">${opt}</button>`).join('')}
              </div>`;
            } else {
              controlHTML = `<div class="input-row">
                <input type="text" class="ans-field" id="in-${uid}" placeholder="..." onkeypress="if(event.key==='Enter') checkInp('${uid}', '${task.a}')">
                <button class="btn-ok" onclick="checkInp('${uid}', '${task.a}')">OK</button>
              </div>`;
            }

            const item = document.createElement('div');
            item.className = 'task-item';
            item.id = `card-${uid}`;
            item.innerHTML = `
              <div class="q-text">${task.q}</div>
              ${controlHTML}
              <div class="help-links">
                <button class="h-link" onclick="toggle('h-${uid}')">–ü—ñ–¥–∫–∞–∑–∫–∞</button>
                <button class="h-link" onclick="toggle('s-${uid}')">–†–æ–∑–≤'—è–∑–∞–Ω–Ω—è</button>
              </div>
              <div id="h-${uid}" class="hint-content">üí° ${task.hint}</div>
              <div id="s-${uid}" class="sol-content">‚úÖ ${task.sol}</div>
            `;
            grid.appendChild(item);
          });

          section.appendChild(grid);
          root.appendChild(section);
        });

        document.getElementById('total-count').innerText = totalTasks;
        renderMathInElement(document.body, {delimiters: [{left: "$", right: "$", display: false}, {left: "$$", right: "$$", display: true}]});
        
        resizeBoard();
      });

      function toggle(id) {
        const el = document.getElementById(id);
        el.style.display = (el.style.display === 'block') ? 'none' : 'block';
        if(el.style.display === 'block') renderMathInElement(el);
      }

      function checkInp(id, correct) {
        const inp = document.getElementById(`in-${id}`);
        const card = document.getElementById(`card-${id}`);
        if(inp.disabled) return;

        let val = inp.value.trim().replace(',', '.').toLowerCase();
        // Remove spaces for flexibility
        val = val.replace(/\s/g, ''); 
        if(!val) return;

        inp.disabled = true;
        
        // Simple heuristic check for root inputs like "5sqrt2"
        let cleanCorrect = Array.isArray(correct) ? correct[0] : correct;
        cleanCorrect = cleanCorrect.toString().toLowerCase().replace(/\s/g, '');

        if(val === cleanCorrect) {
          card.classList.add('correct');
          solvedTasks++;
        } else {
          card.classList.add('wrong');
          document.getElementById(`s-${id}`).style.display = 'block';
        }
        updateStats();
      }

      function checkOpt(btn, val, correct, id) {
        const card = document.getElementById(`card-${id}`);
        if(card.getAttribute('data-done')) return;
        card.setAttribute('data-done', 'true');
        
        const btns = card.querySelectorAll('.btn-opt');
        btns.forEach(b => b.disabled = true);

        if(val === correct) {
          btn.style.background = 'var(--success)';
          btn.style.color = 'white';
          btn.style.borderColor = 'var(--success)';
          card.classList.add('correct');
          solvedTasks++;
        } else {
          btn.style.background = 'var(--error)';
          btn.style.color = 'white';
          btn.style.borderColor = 'var(--error)';
          card.classList.add('wrong');
          document.getElementById(`s-${id}`).style.display = 'block';
        }
        updateStats();
      }

      function updateStats() {
        document.getElementById('solved-count').innerText = solvedTasks;
      }

      function finishLesson() {
        const modal = document.getElementById('result-modal');
        const title = document.getElementById('m-title');
        const msg = document.getElementById('m-msg');
        const scoreDiv = document.getElementById('m-score');

        // 12-point scale
        const score = Math.round((solvedTasks / totalTasks) * 12);
        scoreDiv.innerText = `${score} / 12`;

        if(score >= 10) {
          title.innerText = "–¢–∏ ‚Äî –º–æ–ª–æ–¥–µ—Ü—å! üèÜ";
          msg.innerText = "–ß—É–¥–æ–≤–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞. –ì–µ–æ–º–µ—Ç—Ä—ñ—è —Ç–æ–±—ñ –ø—ñ–¥–∫–æ—Ä–∏–ª–∞—Å—å, –∞ –∞–ª–≥–µ–±—Ä—É —Ç–∏ –∫–ª–∞—Ü–∞—î—à —è–∫ –≥–æ—Ä—ñ—à–∫–∏.";
        } else if(score >= 7) {
          title.innerText = "–ì–∞—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞! üëç";
          msg.innerText = "–ë–∞–∑—É –∑–∞—Å–≤–æ—î–Ω–æ. –¢–∏ —Ç–æ—á–Ω–æ –Ω–µ —Ä–æ–∑–≥—É–±–∏—à—Å—è –Ω–∞ —É—Ä–æ–∫–∞—Ö.";
        } else if(score >= 4) {
          title.innerText = "–•–æ—Ä–æ—à–∏–π —Å—Ç–∞—Ä—Ç! üå±";
          msg.innerText = "–¢–∏ –±–∞–≥–∞—Ç–æ –∑—Ä–æ–±–∏–ª–∞, –∞–ª–µ –≤–∞—Ä—Ç–æ —â–µ —Ä–∞–∑ –ø—Ä–æ–π—Ç–∏—Å—å –ø–æ —á–µ—Ä–≤–æ–Ω–∏—Ö –∫–∞—Ä—Ç–∫–∞—Ö.";
        } else {
          title.innerText = "–ù–µ –∑–¥–∞–≤–∞–π—Å—è! üí™";
          msg.innerText = "–ì–æ–ª–æ–≤–Ω–µ ‚Äî —Ü–µ –ø—Ä–∞–∫—Ç–∏–∫–∞. –ü–µ—Ä–µ–≥–ª—è–Ω—å –ø—ñ–¥–∫–∞–∑–∫–∏ —ñ —Å–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑.";
        }

        modal.style.display = 'flex';
      }

      function closeModal() {
        document.getElementById('result-modal').style.display = 'none';
      }

      /* --- WHITEBOARD --- */
      const canvas = document.getElementById('board');
      const ctx = canvas.getContext('2d');
      const boardArea = document.getElementById('board-area');
      let painting = false;
      let tool = 'pen';

      function resizeBoard() {
        const temp = canvas.toDataURL();
        canvas.width = boardArea.offsetWidth;
        canvas.height = boardArea.offsetHeight;
        const img = new Image();
        img.src = temp;
        img.onload = () => ctx.drawImage(img,0,0);
        ctx.lineCap = 'round'; ctx.lineJoin = 'round';
      }
      window.addEventListener('resize', resizeBoard);

      function getPos(e) {
        const r = canvas.getBoundingClientRect();
        return {
          x: (e.touches ? e.touches[0].clientX : e.clientX) - r.left,
          y: (e.touches ? e.touches[0].clientY : e.clientY) - r.top
        };
      }

      function start(e) { painting = true; draw(e); }
      function end() { painting = false; ctx.beginPath(); }
      function draw(e) {
        if(!painting) return;
        const {x,y} = getPos(e);
        if(tool === 'pen') {
          ctx.lineWidth = 2; ctx.strokeStyle = '#334155'; ctx.globalCompositeOperation = 'source-over';
        } else {
          ctx.lineWidth = 25; ctx.strokeStyle = '#fff'; ctx.globalCompositeOperation = 'destination-out';
        }
        ctx.lineTo(x,y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x,y);
      }

      canvas.addEventListener('mousedown', start);
      canvas.addEventListener('touchstart', start);
      canvas.addEventListener('mouseup', end);
      canvas.addEventListener('touchend', end);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('touchmove', draw);

      function setTool(t) {
        tool = t;
        document.querySelectorAll('.t-btn').forEach(b => b.classList.remove('active'));
        if(t==='pen') document.getElementById('btn-pen').classList.add('active');
        if(t==='eraser') document.getElementById('btn-eraser').classList.add('active');
      }

      function clearBoard() { ctx.clearRect(0,0,canvas.width,canvas.height); }

      function drawShape(type) {
        ctx.globalCompositeOperation = 'source-over';
        ctx.strokeStyle = '#4338ca'; ctx.lineWidth = 3;
        const cx = canvas.width/2, cy = canvas.height/2;
        ctx.beginPath();
        if(type === 'rect') {
          ctx.rect(cx-60, cy-40, 120, 80);
        } else if(type === 'tri') {
          ctx.moveTo(cx-50, cy+50); ctx.lineTo(cx+50, cy+50); ctx.lineTo(cx-50, cy-50); ctx.closePath();
        } else if(type === 'trap') {
          ctx.moveTo(cx-60, cy+40); ctx.lineTo(cx+60, cy+40); ctx.lineTo(cx+30, cy-40); ctx.lineTo(cx-30, cy-40); ctx.closePath();
        }
        ctx.stroke();
        setTool('pen');
      }
    </script>
  </body>
</html>
