<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥—ñ–±–Ω—ñ—Å—Ç—å —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫—ñ–≤: –í—ñ–¥ 0 –¥–æ PRO</title>

    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']], // –î–æ–∑–≤–æ–ª—è—î –ø–∏—Å–∞—Ç–∏ $—Ñ–æ—Ä–º—É–ª–∞$
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --secondary: #ec4899;
            --bg-left: #f9fafb;
            --bg-right: #ffffff;
            --text-main: #1f2937;
            --text-light: #6b7280;
            --success: #10b981;
            --error: #ef4444;
            --border: #e5e7eb;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        /* DESKTOP FIRST */
        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            height: 100vh; 
            overflow: hidden; 
            display: flex; 
            color: var(--text-main); 
        }

        #container { display: flex; width: 100%; height: 100%; }
        
        #content-panel {
            width: 50%;
            background: var(--bg-left);
            overflow-y: auto;
            padding: 2rem;
            border-right: 2px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        #whiteboard-panel {
            width: 50%;
            background: var(--bg-right);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* MOBILE ADAPTATION */
        @media (max-width: 768px) {
            body { height: auto; overflow: auto; }
            #container { flex-direction: column; }
            #content-panel { width: 100%; height: auto; border-right: none; border-bottom: 2px solid var(--border); padding: 1rem; overflow-y: visible; }
            #whiteboard-panel { width: 100%; height: 500px; border-top: 4px solid var(--primary); }
            h1 { font-size: 1.5rem; }
            h2 { font-size: 1.25rem; }
        }

        /* TOOLBAR */
        #toolbar {
            padding: 10px;
            background: #fff;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: flex-start;
            overflow-x: auto;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            z-index: 10;
        }

        #canvas-container {
            flex-grow: 1;
            position: relative;
            cursor: crosshair;
            background-color: #ffffff;
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* UI ELEMENTS */
        h1 { font-size: 2rem; color: var(--primary); margin-bottom: 0.5rem; }
        h2 { font-size: 1.5rem; color: var(--text-main); margin-top: 1.5rem; margin-bottom: 1rem; border-left: 4px solid var(--secondary); padding-left: 10px; }
        h3 { font-size: 1.2rem; margin-bottom: 0.5rem; color: #374151; }
        p { line-height: 1.6; margin-bottom: 1rem; color: #4b5563; }
        
        .tag { display: inline-block; padding: 4px 8px; background: #e0e7ff; color: var(--primary); border-radius: 4px; font-size: 0.8rem; font-weight: bold; margin-bottom: 1rem; }

        .theory-block { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); border: 1px solid var(--border); }
        .task-card { background: white; padding: 1.5rem; border-radius: 12px; border-left: 5px solid var(--primary); margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        
        .input-group { display: flex; gap: 10px; margin-top: 10px; align-items: center; flex-wrap: wrap; }
        input[type="number"], input[type="text"] {
            padding: 8px 12px; border: 2px solid var(--border); border-radius: 6px; flex-grow: 1; transition: border-color 0.3s;
        }
        input:focus { outline: none; border-color: var(--primary); }
        input.correct { border-color: var(--success); background-color: #ecfdf5; }
        input.incorrect { border-color: var(--error); background-color: #fef2f2; }

        button {
            padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.2s; white-space: nowrap;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-1px); }
        .btn-tool { background: #f3f4f6; color: var(--text-main); font-size: 0.9rem; flex-shrink: 0; }
        .btn-tool.active { background: var(--primary); color: white; }

        details { margin-top: 10px; }
        summary { cursor: pointer; color: var(--primary); font-weight: 500; user-select: none; }
        .solution-content { background: #f3f4f6; padding: 10px; border-radius: 6px; margin-top: 5px; font-size: 0.9rem; border-left: 3px solid var(--secondary); }

        .lab-container { 
            background: #111827; border-radius: 12px; padding: 20px; text-align: center; color: white; margin-bottom: 20px;
        }
        .svg-visualization { width: 100%; height: 200px; margin: 10px 0; }
        input[type="range"] { width: 100%; cursor: pointer; }

        #final-test { display: none; }
        .result-box { text-align: center; padding: 2rem; background: #ecfdf5; border-radius: 12px; border: 2px solid var(--success); display: none; margin-bottom: 2rem;}
    </style>
</head>
<body>

<div id="container">
    <div id="content-panel">
        <span class="tag">–ì–µ–æ–º–µ—Ç—Ä—ñ—è 8 –ö–ª–∞—Å ‚Ä¢ –†—ñ–≤–µ–Ω—å: 0 -> PRO</span>
        <h1>–ü–æ–¥—ñ–±–Ω—ñ—Å—Ç—å —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫—ñ–≤: –ü–æ–≤–Ω–∏–π –∫—É—Ä—Å</h1>
        <p>–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ! –°—å–æ–≥–æ–¥–Ω—ñ –º–∏ —Ä–æ–∑–±–µ—Ä–µ–º–æ –≤—Å—ñ –æ–∑–Ω–∞–∫–∏ –ø–æ–¥—ñ–±–Ω–æ—Å—Ç—ñ, –Ω–∞–≤—á–∏–º–æ—Å—è —ó—Ö –±–∞—á–∏—Ç–∏ —Ç–∞ —Ä–æ–∑–≤'—è–∑—É–≤–∞—Ç–∏ –∑–∞–¥–∞—á—ñ.</p>
        
        <div class="lab-container">
            <h3>üß™ –í—ñ—Ä—Ç—É–∞–ª—å–Ω–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—è</h3>
            <p>–ó–º—ñ–Ω—é–π –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç $k$, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –ø–æ–¥—ñ–±–Ω—ñ—Å—Ç—å –≤ –¥—ñ—ó.</p>
            <svg id="sim-viz" class="svg-visualization" viewBox="0 0 400 200">
                </svg>
            <label>–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç $k$: <span id="k-value">1.0</span></label>
            <input type="range" id="k-slider" min="0.5" max="2.5" step="0.1" value="1">
        </div>

        <section>
            <h2>1. –©–æ —Ç–∞–∫–µ –ø–æ–¥—ñ–±–Ω—ñ—Å—Ç—å?</h2>
            <div class="theory-block">
                <p>–î–≤–∞ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∏ –Ω–∞–∑–∏–≤–∞—é—Ç—å—Å—è <strong>–ø–æ–¥—ñ–±–Ω–∏–º–∏</strong> ($\sim$), —è–∫—â–æ —ó—Ö–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –∫—É—Ç–∏ —Ä—ñ–≤–Ω—ñ, –∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏ –ø—Ä–æ–ø–æ—Ä—Ü—ñ–π–Ω—ñ.</p>
                $$ \triangle ABC \sim \triangle A_1B_1C_1 $$
                $$ \frac{AB}{A_1B_1} = \frac{BC}{B_1C_1} = \frac{AC}{A_1C_1} = k $$
                <p>–ß–∏—Å–ª–æ $k$ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è <strong>–∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–æ–º –ø–æ–¥—ñ–±–Ω–æ—Å—Ç—ñ</strong>.</p>
            </div>
        </section>

        <div id="tasks-basic"></div>

        <section>
            <h2>2. –û–∑–Ω–∞–∫–∏ –ø–æ–¥—ñ–±–Ω–æ—Å—Ç—ñ</h2>
            
            <details open>
                <summary>–û–∑–Ω–∞–∫–∞ 1: –ó–∞ –¥–≤–æ–º–∞ –∫—É—Ç–∞–º–∏ (AA)</summary>
                <div class="theory-block" style="margin-top: 10px;">
                    <p>–Ø–∫—â–æ –¥–≤–∞ –∫—É—Ç–∏ –æ–¥–Ω–æ–≥–æ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ—Ä—ñ–≤–Ω—é—é—Ç—å –¥–≤–æ–º –∫—É—Ç–∞–º —ñ–Ω—à–æ–≥–æ, —Ç–æ —Ç–∞–∫—ñ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∏ –ø–æ–¥—ñ–±–Ω—ñ.</p>
                    <svg width="100%" height="100" viewBox="0 0 300 100">
                        <polygon points="10,90 40,30 90,90" fill="none" stroke="#4f46e5" stroke-width="2"/>
                        <text x="20" y="85" font-size="10">Œ±</text> <text x="75" y="85" font-size="10">Œ≤</text>
                        <polygon points="150,90 210,10 270,90" fill="none" stroke="#ec4899" stroke-width="2"/>
                        <text x="165" y="85" font-size="10">Œ±</text> <text x="250" y="85" font-size="10">Œ≤</text>
                    </svg>
                </div>
            </details>

            <details>
                <summary>–û–∑–Ω–∞–∫–∞ 2: –ó–∞ –¥–≤–æ–º–∞ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ —ñ –∫—É—Ç–æ–º (SAS)</summary>
                <div class="theory-block" style="margin-top: 10px;">
                    <p>–Ø–∫—â–æ –¥–≤—ñ —Å—Ç–æ—Ä–æ–Ω–∏ –æ–¥–Ω–æ–≥–æ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ –ø—Ä–æ–ø–æ—Ä—Ü—ñ–π–Ω—ñ –¥–≤–æ–º —Å—Ç–æ—Ä–æ–Ω–∞–º —ñ–Ω—à–æ–≥–æ —ñ –∫—É—Ç–∏ –º—ñ–∂ –Ω–∏–º–∏ —Ä—ñ–≤–Ω—ñ.</p>
                    $$ \frac{AB}{A_1B_1} = \frac{AC}{A_1C_1} \text{ —Ç–∞ } \angle A = \angle A_1 $$
                </div>
            </details>

            <details>
                <summary>–û–∑–Ω–∞–∫–∞ 3: –ó–∞ —Ç—Ä—å–æ–º–∞ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ (SSS)</summary>
                <div class="theory-block" style="margin-top: 10px;">
                    <p>–Ø–∫—â–æ —Ç—Ä–∏ —Å—Ç–æ—Ä–æ–Ω–∏ –æ–¥–Ω–æ–≥–æ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ –ø—Ä–æ–ø–æ—Ä—Ü—ñ–π–Ω—ñ —Ç—Ä—å–æ–º —Å—Ç–æ—Ä–æ–Ω–∞–º —ñ–Ω—à–æ–≥–æ.</p>
                    $$ \frac{AB}{A_1B_1} = \frac{BC}{B_1C_1} = \frac{AC}{A_1C_1} $$
                </div>
            </details>
        </section>

        <div id="tasks-theorems"></div>

        <section>
            <h2>3. PRO –†—ñ–≤–µ–Ω—å: –ü–ª–æ—â—ñ —Ç–∞ –ü–µ—Ä–∏–º–µ—Ç—Ä–∏</h2>
            <div class="theory-block">
                <p>–Ø–∫—â–æ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –ø–æ–¥—ñ–±–Ω–æ—Å—Ç—ñ –¥–æ—Ä—ñ–≤–Ω—é—î $k$, —Ç–æ:</p>
                <ul>
                    <li>–í—ñ–¥–Ω–æ—à–µ–Ω–Ω—è <strong>–ø–µ—Ä–∏–º–µ—Ç—Ä—ñ–≤</strong> –¥–æ—Ä—ñ–≤–Ω—é—î $k$.</li>
                    <li>–í—ñ–¥–Ω–æ—à–µ–Ω–Ω—è <strong>–ø–ª–æ—â</strong> –¥–æ—Ä—ñ–≤–Ω—é—î $k^2$.</li>
                </ul>
                $$ \frac{P_{ABC}}{P_{A_1B_1C_1}} = k, \quad \frac{S_{ABC}}{S_{A_1B_1C_1}} = k^2 $$
            </div>
        </section>

        <div id="tasks-pro"></div>

        <button class="btn-primary" style="width: 100%; padding: 20px; font-size: 1.2rem; margin-top: 2rem;" onclick="startTest()">–ü–æ—á–∞—Ç–∏ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π —Ç–µ—Å—Ç</button>

        <div id="final-test">
            <h2>–§—ñ–Ω–∞–ª—å–Ω–∏–π —Ç–µ—Å—Ç</h2>
            <div id="test-container"></div>
            <button class="btn-primary" style="margin-top: 20px;" onclick="finishLesson()">–ó–∞–≤–µ—Ä—à–∏—Ç–∏ —É—Ä–æ–∫</button>
        </div>

        <div id="result-message" class="result-box"></div>
        <div style="height: 50px;"></div>
    </div>

    <div id="whiteboard-panel">
        <div id="toolbar">
            <button class="btn-tool active" onclick="setTool('pen')" title="–û–ª—ñ–≤–µ—Ü—å">‚úèÔ∏è</button>
            <button class="btn-tool" onclick="setTool('eraser')" title="–ì—É–º–∫–∞">üßº</button>
            <input type="color" id="colorPicker" value="#000000">
            <input type="range" id="lineWidth" min="1" max="10" value="2" title="–¢–æ–≤—â–∏–Ω–∞">
            <div style="width: 1px; height: 20px; background: #ddd; margin: 0 5px;"></div>
            <button class="btn-tool" onclick="drawGrid()" title="–°—ñ—Ç–∫–∞">‚ñ¶ –°—ñ—Ç–∫–∞</button>
            <button class="btn-tool" onclick="drawTriangle('acute')" title="–ì–æ—Å—Ç—Ä–æ–∫—É—Ç–Ω–∏–π">‚ñ≥</button>
            <button class="btn-tool" onclick="drawTriangle('right')" title="–ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–π">üìê</button>
            <button class="btn-tool" style="color: red;" onclick="clearCanvas()">üóë –û—á–∏—Å—Ç–∏—Ç–∏</button>
        </div>
        <div id="canvas-container">
            <canvas id="board"></canvas>
        </div>
    </div>
</div>

<script>
    // --- DATA ---
    const tasksBasic = [
        { id: 'b1', q: "–°—Ç–æ—Ä–æ–Ω–∏ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ 3 —Å–º, 4 —Å–º, 5 —Å–º. –ù–∞–π–º–µ–Ω—à–∞ —Å—Ç–æ—Ä–æ–Ω–∞ –ø–æ–¥—ñ–±–Ω–æ–≥–æ –π–æ–º—É —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ –¥–æ—Ä—ñ–≤–Ω—é—î 9 —Å–º. –ó–Ω–∞–π–¥–∏ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –ø–æ–¥—ñ–±–Ω–æ—Å—Ç—ñ $k$.", a: 3, hint: "$k = \\frac{\\text{—Å—Ç–æ—Ä–æ–Ω–∞ –Ω–æ–≤–æ–≥–æ}}{\\text{—Å—Ç–æ—Ä–æ–Ω–∞ —Å—Ç–∞—Ä–æ–≥–æ}}$", sol: "–ù–∞–π–º–µ–Ω—à–∞ —Å—Ç–æ—Ä–æ–Ω–∞ –ø–µ—Ä—à–æ–≥–æ: 3. –ù–∞–π–º–µ–Ω—à–∞ –¥—Ä—É–≥–æ–≥–æ: 9. $k = 9/3 = 3$." },
        { id: 'b2', q: "–¢—Ä–∏–∫—É—Ç–Ω–∏–∫–∏ –ø–æ–¥—ñ–±–Ω—ñ –∑ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–æ–º $k=2$. –°—Ç–æ—Ä–æ–Ω–∞ –ø–µ—Ä—à–æ–≥–æ 10. –Ø–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–∞ –¥—Ä—É–≥–æ–≥–æ, —è–∫—â–æ –¥—Ä—É–≥–∏–π –±—ñ–ª—å—à–∏–π?", a: 20, hint: "–Ø–∫—â–æ –¥—Ä—É–≥–∏–π –±—ñ–ª—å—à–∏–π, –º–Ω–æ–∂–∏–º–æ –Ω–∞ $k$.", sol: "$10 \\cdot 2 = 20$." },
        { id: 'b3', q: "–£ $\\triangle ABC$ $\\angle A = 40^\\circ, \\angle B = 60^\\circ$. –£ –ø–æ–¥—ñ–±–Ω–æ–º—É $\\triangle MNK$ –∑–Ω–∞–π–¥–∏ $\\angle K$ (–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –¥–æ $\\angle C$).", a: 80, hint: "–°—É–º–∞ –∫—É—Ç—ñ–≤ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ $180^\\circ$. –í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –∫—É—Ç–∏ —Ä—ñ–≤–Ω—ñ.", sol: "$\\angle C = 180 - (40+60) = 80^\\circ$. –û—Å–∫—ñ–ª—å–∫–∏ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∏ –ø–æ–¥—ñ–±–Ω—ñ, $\\angle K = \\angle C = 80^\\circ$." }
    ];

    const tasksTheorems = [
        { id: 't1', q: "–î–∞–Ω–æ $\\triangle ABC$ —ñ $\\triangle A_1B_1C_1$. $\\angle A = \\angle A_1$, $\\angle B = \\angle B_1$. $AB=5, A_1B_1=15, AC=4$. –ó–Ω–∞–π–¥–∏ $A_1C_1$.", a: 12, hint: "–ó–Ω–∞–π–¥–∏ $k$, –ø–æ—Ç—ñ–º –ø–æ–º–Ω–æ–∂ —Å—Ç–æ—Ä–æ–Ω—É.", sol: "$k = 15/5 = 3$. $A_1C_1 = AC \\cdot 3 = 4 \\cdot 3 = 12$." },
        { id: 't2', q: "–°—Ç–æ—Ä–æ–Ω–∏ –æ–¥–Ω–æ–≥–æ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞: 4, 6, 8. –°—Ç–æ—Ä–æ–Ω–∏ –¥—Ä—É–≥–æ–≥–æ: 2, 3, 4. –ß–∏ –ø–æ–¥—ñ–±–Ω—ñ –≤–æ–Ω–∏? (–í–≤–µ–¥–∏ 1 –¥–ª—è '–¢–∞–∫', 0 –¥–ª—è '–ù—ñ')", a: 1, hint: "–ü–µ—Ä–µ–≤—ñ—Ä –ø—Ä–æ–ø–æ—Ä—Ü—ñ–π–Ω—ñ—Å—Ç—å: $4/2 = 6/3 = 8/4$?", sol: "–¢–∞–∫, –≤—Å—ñ –≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –¥–æ—Ä—ñ–≤–Ω—é—é—Ç—å 2. –¶–µ –æ–∑–Ω–∞–∫–∞ SSS." },
        { id: 't3', q: "–¢—ñ–Ω—å –≤—ñ–¥ –¥–µ—Ä–µ–≤–∞ –¥–æ–≤–∂–∏–Ω–æ—é 12 –º, –∞ —Ç—ñ–Ω—å –≤—ñ–¥ –ª—é–¥–∏–Ω–∏ —Ä–æ—Å—Ç–æ–º 1.8 –º ‚Äî 2 –º. –ó–Ω–∞–π–¥–∏ –≤–∏—Å–æ—Ç—É –¥–µ—Ä–µ–≤–∞ (–≤ –º–µ—Ç—Ä–∞—Ö).", a: 10.8, hint: "–¢—Ä–∏–∫—É—Ç–Ω–∏–∫–∏, —É—Ç–≤–æ—Ä–µ–Ω—ñ –æ–±'—î–∫—Ç–∞–º–∏ —Ç–∞ —ó—Ö —Ç—ñ–Ω—è–º–∏, –ø–æ–¥—ñ–±–Ω—ñ.", sol: "–ü—Ä–æ–ø–æ—Ä—Ü—ñ—è: $\\frac{x}{1.8} = \\frac{12}{2}$. $x = 1.8 \\cdot 6 = 10.8$." },
        { id: 't4', q: "–£ –ø—Ä—è–º–æ–∫—É—Ç–Ω–æ–º—É —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫—É –∫–∞—Ç–µ—Ç–∏ 3 —ñ 4. –ì—ñ–ø–æ—Ç–µ–Ω—É–∑–∞ –ø–æ–¥—ñ–±–Ω–æ–≥–æ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ 25. –ó–Ω–∞–π–¥–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –ø–æ–¥—ñ–±–Ω–æ–≥–æ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞.", a: 60, hint: "–°–ø–æ—á–∞—Ç–∫—É –∑–Ω–∞–π–¥–∏ –≥—ñ–ø–æ—Ç–µ–Ω—É–∑—É –ø–µ—Ä—à–æ–≥–æ (–ü—ñ—Ñ–∞–≥–æ—Ä), –ø–æ—Ç—ñ–º $k$, –ø–æ—Ç—ñ–º –ø–µ—Ä–∏–º–µ—Ç—Ä.", sol: "–ì—ñ–ø–æ—Ç–µ–Ω—É–∑–∞ 1-–≥–æ: $\\sqrt{3^2+4^2}=5$. $k = 25/5 = 5$. –ü–µ—Ä–∏–º–µ—Ç—Ä 1-–≥–æ: $3+4+5=12$. –ü–µ—Ä–∏–º–µ—Ç—Ä 2-–≥–æ: $12 \\cdot 5 = 60$." }
    ];

    const tasksPro = [
        { id: 'p1', q: "–°—Ç–æ—Ä–æ–Ω–∏ –¥–≤–æ—Ö –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫—ñ–≤ –≤—ñ–¥–Ω–æ—Å—è—Ç—å—Å—è —è–∫ 1:4. –£ —Å–∫—ñ–ª—å–∫–∏ —Ä–∞–∑—ñ–≤ –ø–ª–æ—â–∞ –¥—Ä—É–≥–æ–≥–æ –±—ñ–ª—å—à–∞ –∑–∞ –ø–ª–æ—â—É –ø–µ—Ä—à–æ–≥–æ?", a: 16, hint: "–í—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –ø–ª–æ—â = $k^2$.", sol: "$k=4$. –í—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –ø–ª–æ—â $4^2 = 16$." },
        { id: 'p2', q: "–ü–ª–æ—â–∞ $\\triangle ABC = 20$ —Å–º$^2$. –°–µ—Ä–µ–¥–Ω—è –ª—ñ–Ω—ñ—è –≤—ñ–¥—Ç–∏–Ω–∞—î –≤—ñ–¥ –Ω—å–æ–≥–æ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫. –Ø–∫–∞ –π–æ–≥–æ –ø–ª–æ—â–∞?", a: 5, hint: "–¢—Ä–∏–∫—É—Ç–Ω–∏–∫, –≤—ñ–¥—Ç—è—Ç–∏–π —Å–µ—Ä–µ–¥–Ω—å–æ—é –ª—ñ–Ω—ñ—î—é, –ø–æ–¥—ñ–±–Ω–∏–π –∑ $k=1/2$.", sol: "$k=1/2$, –æ—Ç–∂–µ –ø–ª–æ—â—ñ –≤—ñ–¥–Ω–æ—Å—è—Ç—å—Å—è —è–∫ $(1/2)^2 = 1/4$. $20/4 = 5$." },
        { id: 'p3', q: "–ü–µ—Ä–∏–º–µ—Ç—Ä–∏ –ø–æ–¥—ñ–±–Ω–∏—Ö —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫—ñ–≤ 15 —Å–º —ñ 45 —Å–º. –ü–ª–æ—â–∞ –º–µ–Ω—à–æ–≥–æ 10 —Å–º$^2$. –ó–Ω–∞–π–¥–∏ –ø–ª–æ—â—É –±—ñ–ª—å—à–æ–≥–æ.", a: 90, hint: "–ó–Ω–∞–π–¥–∏ $k$ —á–µ—Ä–µ–∑ –ø–µ—Ä–∏–º–µ—Ç—Ä–∏. –ü–æ—Ç—ñ–º –ø–ª–æ—â—É —á–µ—Ä–µ–∑ $k^2$.", sol: "$k = 45/15 = 3$. –ü–ª–æ—â–∞ –±—ñ–ª—å—à–æ–≥–æ = $10 \\cdot 3^2 = 90$." }
    ];

    const finalTestQs = [
        { q: "–Ø–∫—â–æ –∑–±—ñ–ª—å—à–∏—Ç–∏ —Å—Ç–æ—Ä–æ–Ω–∏ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ –≤ 3 —Ä–∞–∑–∏, —è–∫ –∑–º—ñ–Ω–∏—Ç—å—Å—è –π–æ–≥–æ –ø–µ—Ä–∏–º–µ—Ç—Ä? (–≤–≤–µ–¥–∏ —á–∏—Å–ª–æ)", a: 3 },
        { q: "–î–≤–∞ –∫—É—Ç–∏ –æ–¥–Ω–æ–≥–æ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ $50^\\circ$ —ñ $70^\\circ$. –¢—Ä–µ—Ç—ñ–π –∫—É—Ç —ñ–Ω—à–æ–≥–æ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ $60^\\circ$. –ß–∏ –º–æ–∂—É—Ç—å –≤–æ–Ω–∏ –±—É—Ç–∏ –ø–æ–¥—ñ–±–Ω–∏–º–∏? (1-–¢–∞–∫, 0-–ù—ñ)", a: 1 },
        { q: "–í—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –ø–ª–æ—â –ø–æ–¥—ñ–±–Ω–∏—Ö —Ñ—ñ–≥—É—Ä –¥–æ—Ä—ñ–≤–Ω—é—î 25. –ß–æ–º—É –¥–æ—Ä—ñ–≤–Ω—é—î –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –ø–æ–¥—ñ–±–Ω–æ—Å—Ç—ñ?", a: 5 }
    ];

    let totalScore = 0;
    let maxScore = tasksBasic.length + tasksTheorems.length + tasksPro.length + finalTestQs.length;

    function renderTasks(containerId, tasks) {
        const container = document.getElementById(containerId);
        tasks.forEach((task, index) => {
            const card = document.createElement('div');
            card.className = 'task-card';
            card.innerHTML = `
                <h3>–ó–∞–≤–¥–∞–Ω–Ω—è #${index + 1}</h3>
                <p>${task.q}</p>
                <div class="input-group">
                    <input type="number" step="any" id="inp-${task.id}" placeholder="–¢–≤–æ—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å...">
                    <button class="btn-primary" onclick="checkAnswer('${task.id}', ${task.a})">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
                </div>
                <details>
                    <summary>üí° –ü—ñ–¥–∫–∞–∑–∫–∞</summary>
                    <p class="solution-content">${task.hint}</p>
                </details>
                <details id="sol-${task.id}" style="display:none">
                    <summary>üóù –ü–æ–∫–∞–∑–∞—Ç–∏ —Ä–æ–∑–≤'—è–∑–∞–Ω–Ω—è</summary>
                    <p class="solution-content">${task.sol}</p>
                </details>
            `;
            container.appendChild(card);
        });
    }

    function checkAnswer(id, correctVal) {
        const inp = document.getElementById(`inp-${id}`);
        const solDetails = document.getElementById(`sol-${id}`);
        const val = parseFloat(inp.value);

        if (Math.abs(val - correctVal) < 0.1) {
            inp.classList.remove('incorrect');
            inp.classList.add('correct');
            totalScore++;
        } else {
            inp.classList.remove('correct');
            inp.classList.add('incorrect');
        }
        solDetails.style.display = 'block';
        
        // Re-render math in the opened solution
        if (window.MathJax) {
            MathJax.typesetPromise([solDetails]).catch(err => console.log(err));
        }
    }

    // --- MAIN INITIALIZATION ---
    window.onload = function() {
        renderTasks('tasks-basic', tasksBasic);
        renderTasks('tasks-theorems', tasksTheorems);
        renderTasks('tasks-pro', tasksPro);
        
        // --- FORCE MATHJAX RENDER AFTER JS INJECTION ---
        if (window.MathJax) {
            MathJax.typesetPromise().catch(err => console.log('MathJax error:', err));
        }

        initLab();
        initWhiteboard();
    };

    function initLab() {
        const svg = document.getElementById('sim-viz');
        const slider = document.getElementById('k-slider');
        const kLabel = document.getElementById('k-value');

        function drawSim(k) {
            svg.innerHTML = '';
            const p1 = "50,150 100,50 150,150"; 
            const bx = 50 * k, by = -100 * k;
            const cx = 100 * k, cy = 0;
            const startX = 220, startY = 150;
            const p2 = `${startX},${startY} ${startX + bx},${startY + by} ${startX + cx},${startY}`;

            const t1 = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
            t1.setAttribute("points", p1);
            t1.setAttribute("fill", "rgba(79, 70, 229, 0.3)");
            t1.setAttribute("stroke", "#4f46e5");
            t1.setAttribute("stroke-width", "2");

            const t2 = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
            t2.setAttribute("points", p2);
            t2.setAttribute("fill", "rgba(236, 72, 153, 0.3)");
            t2.setAttribute("stroke", "#ec4899");
            t2.setAttribute("stroke-width", "2");

            const txt = document.createElementNS("http://www.w3.org/2000/svg", "text");
            txt.setAttribute("x", startX + (50*k));
            txt.setAttribute("y", startY + 20);
            txt.setAttribute("text-anchor", "middle");
            txt.textContent = `k = ${k}`;

            svg.appendChild(t1);
            svg.appendChild(t2);
            svg.appendChild(txt);
        }

        slider.addEventListener('input', (e) => {
            const val = e.target.value;
            kLabel.innerText = val;
            drawSim(val);
        });
        drawSim(1.0);
    }

    function startTest() {
        document.getElementById('final-test').style.display = 'block';
        const container = document.getElementById('test-container');
        container.innerHTML = '';
        
        finalTestQs.forEach((q, i) => {
            const div = document.createElement('div');
            div.className = 'task-card';
            div.style.borderLeftColor = '#ec4899';
            div.innerHTML = `<p><strong>${i+1}.</strong> ${q.q}</p><input type="number" id="test-q-${i}" placeholder="–í—ñ–¥–ø–æ–≤—ñ–¥—å">`;
            container.appendChild(div);
        });
        
        if (window.MathJax) MathJax.typesetPromise().catch(err => console.log(err));
        document.getElementById('final-test').scrollIntoView({behavior: 'smooth'});
    }

    function finishLesson() {
        let testScore = 0;
        finalTestQs.forEach((q, i) => {
            const val = parseFloat(document.getElementById(`test-q-${i}`).value);
            if (Math.abs(val - q.a) < 0.1) testScore++;
        });
        const finalScore = totalScore + testScore; 
        const percent = Math.min(100, Math.round((finalScore / maxScore) * 100));
        const resBox = document.getElementById('result-message');
        resBox.style.display = 'block';
        let msg = "";
        if (percent > 80) msg = "–¢–∏ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π –≥–µ–æ–º–µ—Ç—Ä–∏—á–Ω–∏–π –ì–ï–ù–Ü–ô! üöÄ";
        else if (percent > 50) msg = "–ß—É–¥–æ–≤–∞ —Ä–æ–±–æ—Ç–∞! –¢–∏ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —à–ª—è—Ö—É! üëç";
        else msg = "–ù–µ–ø–æ–≥–∞–Ω–æ! –ì–æ–ª–æ–≤–Ω–µ ‚Äî –Ω–µ –∑—É–ø–∏–Ω—è—Ç–∏—Å—è —ñ –ø—Ä–∞–∫—Ç–∏–∫—É–≤–∞—Ç–∏—Å—è! üí™";
        resBox.innerHTML = `<h3>–£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</h3><p style="font-size: 1.5rem; font-weight: bold; color: var(--success);">${percent}%</p><p>${msg}</p><p style="font-size: 0.9rem; margin-top:10px; color:#666">–ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π (—Ä–∞–∑–æ–º –∑ –∑–∞–¥–∞—á–∞–º–∏): ${finalScore} / ${maxScore}</p>`;
        resBox.scrollIntoView({behavior: 'smooth'});
    }

    let canvas, ctx, painting = false;
    let tool = 'pen', color = '#000000', lineWidth = 2;

    function initWhiteboard() {
        const container = document.getElementById('canvas-container');
        canvas = document.getElementById('board');
        ctx = canvas.getContext('2d');
        function resize() { canvas.width = container.offsetWidth; canvas.height = container.offsetHeight; }
        window.addEventListener('resize', resize);
        resize();
        canvas.addEventListener('mousedown', startPosition);
        canvas.addEventListener('mouseup', finishedPosition);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); canvas.dispatchEvent(new MouseEvent("mousedown", {clientX: e.touches[0].clientX, clientY: e.touches[0].clientY})); });
        canvas.addEventListener('touchend', (e) => { canvas.dispatchEvent(new MouseEvent("mouseup", {})); });
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); canvas.dispatchEvent(new MouseEvent("mousemove", {clientX: e.touches[0].clientX, clientY: e.touches[0].clientY})); });
        document.getElementById('colorPicker').addEventListener('change', (e) => color = e.target.value);
        document.getElementById('lineWidth').addEventListener('change', (e) => lineWidth = e.target.value);
    }
    function startPosition(e) { painting = true; draw(e); }
    function finishedPosition() { painting = false; ctx.beginPath(); }
    function draw(e) {
        if (!painting) return;
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left, y = e.clientY - rect.top;
        ctx.lineWidth = lineWidth; ctx.lineCap = 'round';
        if (tool === 'eraser') { ctx.globalCompositeOperation = 'destination-out'; ctx.lineWidth = 20; }
        else { ctx.globalCompositeOperation = 'source-over'; ctx.strokeStyle = color; }
        ctx.lineTo(x, y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x, y);
    }
    function setTool(t) { tool = t; document.querySelectorAll('.btn-tool').forEach(b => b.classList.remove('active')); if(t === 'pen' || t === 'eraser') event.target.classList.add('active'); }
    function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }
    function drawGrid() {
        const w = canvas.width, h = canvas.height, step = 40;
        ctx.globalCompositeOperation = 'source-over'; ctx.beginPath(); ctx.strokeStyle = '#e5e7eb'; ctx.lineWidth = 1;
        for (let x = 0; x <= w; x += step) { ctx.moveTo(x, 0); ctx.lineTo(x, h); }
        for (let y = 0; y <= h; y += step) { ctx.moveTo(0, y); ctx.lineTo(w, y); }
        ctx.stroke(); ctx.beginPath();
    }
    function drawTriangle(type) {
        ctx.globalCompositeOperation = 'source-over'; ctx.strokeStyle = color; ctx.lineWidth = lineWidth; ctx.beginPath();
        const cx = canvas.width / 2, cy = canvas.height / 2;
        if (type === 'acute') { ctx.moveTo(cx, cy - 100); ctx.lineTo(cx - 80, cy + 50); ctx.lineTo(cx + 80, cy + 50); ctx.closePath(); }
        else if (type === 'right') { ctx.moveTo(cx - 50, cy - 80); ctx.lineTo(cx - 50, cy + 80); ctx.lineTo(cx + 80, cy + 80); ctx.closePath(); }
        ctx.stroke(); ctx.beginPath();
    }
</script>
</body>
</html>