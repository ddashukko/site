<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ì–µ–æ–º–µ—Ç—Ä—ñ—è 9 –∫–ª–∞—Å: –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –î–æ—à–∫–∞ 2.0</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
      onload="renderMathInElement(document.body);"
    ></script>

    <style>
      :root {
        --brand: #6366f1; /* Indigo */
        --brand-light: #e0e7ff;
        --accent: #f43f5e; /* Rose */
        --success: #10b981;
        --text: #1e293b;
        --bg: #f8fafc;
        --card: #ffffff;
        --border: #cbd5e1;
      }

      body {
        margin: 0;
        font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
        display: flex;
        height: 100vh;
        overflow: hidden;
      }

      /* --- –õ–Ü–í–ê –ü–ê–ù–ï–õ–¨: –£–†–û–ö (–ë–µ–∑ –∑–º—ñ–Ω) --- */
      #lesson-panel {
        flex: 1.5;
        display: flex;
        flex-direction: column;
        border-right: 1px solid var(--border);
        background: white;
        overflow-y: auto;
      }

      header {
        position: sticky; top: 0; z-index: 50;
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(5px);
        padding: 15px 25px;
        border-bottom: 2px solid var(--brand);
        display: flex; justify-content: space-between; align-items: center;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      }
      .header-text h1 { margin: 0; font-size: 1.3rem; color: var(--brand); }
      .header-text p { margin: 0; font-size: 0.85rem; color: #64748b; }

      .btn-table {
        background: var(--text); color: white; border: none;
        padding: 8px 16px; border-radius: 6px; cursor: pointer;
        font-weight: bold; display: flex; align-items: center; gap: 8px;
        transition: 0.2s;
      }
      .btn-table:hover { background: #000; transform: scale(1.05); }

      .content-container {
        padding: 25px; padding-bottom: 100px;
        max-width: 850px; margin: 0 auto; width: 100%; box-sizing: border-box;
      }

      .module {
        background: var(--bg); border: 1px solid var(--border);
        border-radius: 12px; margin-bottom: 40px; overflow: hidden;
      }
      .module-header {
        background: white; padding: 15px 20px;
        border-bottom: 1px solid var(--border);
        display: flex; align-items: center; gap: 10px;
      }
      .module-title { margin: 0; font-size: 1.2rem; color: var(--text); font-weight: 700; }
      .theory-body { padding: 20px; line-height: 1.6; font-size: 1.05rem; }
      .concept-box {
        background: #fff; border-left: 5px solid var(--accent);
        padding: 15px; margin: 15px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      }
      .math-display {
        text-align: center; background: #eef2ff; padding: 10px;
        border-radius: 8px; margin: 10px 0; font-size: 1.2rem;
      }

      .tasks-list { display: grid; grid-template-columns: 1fr; gap: 15px; padding: 20px; background: #ffffff; }
      @media (min-width: 700px) { .tasks-list { grid-template-columns: 1fr 1fr; } }

      .task-card {
        background: #f8fafc; border: 1px solid var(--border);
        border-radius: 8px; padding: 15px; transition: 0.2s;
      }
      .task-card:hover { border-color: var(--brand); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
      .task-card.correct { background: #dcfce7; border-color: var(--success); }
      .task-card.wrong { background: #fee2e2; border-color: var(--accent); }

      .q-text { font-weight: 600; margin-bottom: 10px; }
      .input-row { display: flex; gap: 5px; margin-top: auto; }
      .ans-input { flex: 1; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 1rem; }
      .btn-check { background: var(--brand); color: white; border: none; padding: 0 15px; border-radius: 4px; cursor: pointer; font-weight: 600; }
      .help-row { margin-top: 8px; display: flex; gap: 10px; font-size: 0.85rem; }
      .help-btn { background: none; border: none; color: #64748b; cursor: pointer; text-decoration: underline; padding: 0; }
      .hint-div, .sol-div { display: none; margin-top: 8px; padding: 8px; border-radius: 4px; font-size: 0.9rem; }
      .hint-div { background: #fff7ed; color: #9a3412; }
      .sol-div { background: #eff6ff; color: #1e40af; }

      /* --- –ü–†–ê–í–ê –ü–ê–ù–ï–õ–¨: –î–û–®–ö–ê (–û–ù–û–í–õ–ï–ù–û) --- */
      #board-panel {
        flex: 1;
        position: relative;
        background: #fff;
        /* –ü–æ–∫—Ä–∞—â–µ–Ω–∞ CSS-—Å—ñ—Ç–∫–∞ */
        background-size: 20px 20px;
        background-image:
          linear-gradient(to right, #e2e8f0 1px, transparent 1px),
          linear-gradient(to bottom, #e2e8f0 1px, transparent 1px);
        border-left: 1px solid var(--border);
        /* –ö—É—Ä—Å–æ—Ä–∏ –¥–ª—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ */
        &[data-tool="pen"] { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%236366f1" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>') 0 24, auto; }
        &[data-tool="eraser"] { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%231e293b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>') 12 12, auto; }
        &[data-tool="triangle"] { cursor: crosshair; }
      }

      .toolbar {
        position: absolute; top: 15px; left: 15px;
        background: white; padding: 8px; border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: flex; gap: 8px; z-index: 10;
        align-items: center;
      }
      .tool-btn {
        width: 40px; height: 40px; border: 1px solid var(--border);
        border-radius: 8px; cursor: pointer; background: white; font-size: 1.3rem;
        display: flex; align-items: center; justify-content: center;
        transition: all 0.2s;
      }
      .tool-btn:hover { background: #f1f5f9; }
      .tool-btn.active { background: var(--brand); color: white; border-color: var(--brand); box-shadow: 0 2px 5px rgba(99, 102, 241, 0.3); }
      .separator { width: 1px; height: 25px; background: var(--border); margin: 0 5px; }

      /* –ú–û–î–ê–õ–ö–ò (–ë–µ–∑ –∑–º—ñ–Ω) */
      .modal-overlay {
        display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5); backdrop-filter: blur(3px); z-index: 200;
        justify-content: center; align-items: center;
      }
      .table-card {
        background: white; padding: 25px; border-radius: 12px;
        max-width: 700px; width: 95%; box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        max-height: 90vh; overflow-y: auto;
      }
      .trig-table {
        width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 1.1rem;
      }
      .trig-table th, .trig-table td {
        border: 1px solid #cbd5e1; padding: 12px; text-align: center;
      }
      .trig-table th { background: #f1f5f9; color: var(--brand); }
      .trig-table tr:nth-child(even) { background: #f8fafc; }
      .val-cell .katex { font-size: 1.1em; }

      @media (max-width: 900px) {
        body { flex-direction: column; }
        #board-panel { height: 40vh; order: 1; border-bottom: 2px solid var(--border); border-left: none; }
        #lesson-panel { height: 60vh; order: 2; }
      }
    </style>
  </head>
  <body>

    <div id="lesson-panel">
      <header>
        <div class="header-text">
          <h1>–ì–µ–æ–º–µ—Ç—Ä—ñ—è 9 –∫–ª–∞—Å</h1>
          <p>–û–Ω–æ–≤–ª–µ–Ω–æ: –ü–ª–∞–≤–Ω–µ –ø–∏—Å—å–º–æ, —Ç–æ—á–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏</p>
        </div>
        <button class="btn-table" onclick="toggleTable()">
          üî¢ –¢–∞–±–ª–∏—Ü—è –°–∏–Ω—É—Å—ñ–≤
        </button>
      </header>

      <div class="content-container" id="content-root"></div>
      
      <div style="text-align:center; padding-bottom:50px;">
        <button onclick="finishLesson()" style="padding:15px 40px; background:var(--brand); color:white; border:none; border-radius:30px; font-size:1.1rem; cursor:pointer; box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3);">
          üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —É—Ä–æ–∫
        </button>
      </div>
    </div>

    <div id="board-panel" data-tool="pen">
      <div class="toolbar">
        <button class="tool-btn active" onclick="setTool('pen')" id="t-pen" title="–†—É—á–∫–∞ (–ø–ª–∞–≤–Ω–µ –ø–∏—Å—å–º–æ)">üñäÔ∏è</button>
        <button class="tool-btn" onclick="setTool('eraser')" id="t-eraser" title="–ì—É–º–∫–∞">üßπ</button>
        <div class="separator"></div>
        <button class="tool-btn" onclick="drawAxes()" title="–ù–∞–º–∞–ª—é–≤–∞—Ç–∏ –æ—Å—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç">üìâ</button>
        <button class="tool-btn" onclick="setTool('triangle')" id="t-triangle" title="–¢—Ä–∏–∫—É—Ç–Ω–∏–∫ (–∫–ª—ñ–∫–Ω–∏ 3 —Ä–∞–∑–∏)">üìê</button>
        <div class="separator"></div>
        <button class="tool-btn" onclick="clearBoard()" style="color:#ef4444; border-color:#fecaca;" title="–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ">üóëÔ∏è</button>
      </div>
      <canvas id="board"></canvas>
    </div>

    <div id="table-modal" class="modal-overlay" onclick="if(event.target===this) toggleTable()">
      <div class="table-card">
        <h2 style="margin:0; color:var(--brand);">–®–ø–∞—Ä–≥–∞–ª–∫–∞: –ó–Ω–∞—á–µ–Ω–Ω—è</h2>
        <p>–¶—ñ —á–∏—Å–ª–∞ —Ç—Ä–µ–±–∞ –ø—ñ–¥—Å—Ç–∞–≤–ª—è—Ç–∏ —É —Ñ–æ—Ä–º—É–ª–∏ –∑–∞–º—ñ—Å—Ç—å $\sin$ —Ç–∞ $\cos$.</p>
        <table class="trig-table">
          <thead>
            <tr>
              <th>–ö—É—Ç $\alpha$</th>
              <th>$30^\circ$</th>
              <th>$45^\circ$</th>
              <th>$60^\circ$</th>
              <th>$90^\circ$</th>
              <th>$120^\circ$</th>
              <th>$180^\circ$</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><b>$\sin \alpha$</b></td>
              <td class="val-cell">$\frac{1}{2}$ <br><small>(0.5)</small></td>
              <td class="val-cell">$\frac{\sqrt{2}}{2}$ <br><small>(~0.7)</small></td>
              <td class="val-cell">$\frac{\sqrt{3}}{2}$ <br><small>(~0.86)</small></td>
              <td class="val-cell">$1$</td>
              <td class="val-cell">$\frac{\sqrt{3}}{2}$</td>
              <td class="val-cell">$0$</td>
            </tr>
            <tr>
              <td><b>$\cos \alpha$</b></td>
              <td class="val-cell">$\frac{\sqrt{3}}{2}$</td>
              <td class="val-cell">$\frac{\sqrt{2}}{2}$</td>
              <td class="val-cell">$\frac{1}{2}$ <br><small>(0.5)</small></td>
              <td class="val-cell">$0$</td>
              <td class="val-cell">$-\frac{1}{2}$ <br><small>(-0.5)</small></td>
              <td class="val-cell">$-1$</td>
            </tr>
          </tbody>
        </table>
        <div style="margin-top:20px; background:#fefce8; padding:10px; border-radius:6px; font-size:0.9rem;">
          üí° <b>–õ–∞–π—Ñ—Ö–∞–∫:</b> $\cos 120^\circ = -0.5$ (–ó –º—ñ–Ω—É—Å–æ–º!). –¶–µ –¥—É–∂–µ —á–∞—Å—Ç–æ —Ç—Ä–∞–ø–ª—è—î—Ç—å—Å—è –≤ –∑–∞–¥–∞—á–∞—Ö.
        </div>
        <button onclick="toggleTable()" style="margin-top:20px; width:100%; padding:10px; background:var(--text); color:white; border:none; border-radius:6px; cursor:pointer;">–ó–∞–∫—Ä–∏—Ç–∏</button>
      </div>
    </div>

    <div id="res-modal" class="modal-overlay">
      <div class="table-card" style="text-align:center;">
        <h2 id="res-title" style="font-size:2rem; margin:0;"></h2>
        <p id="res-msg"></p>
        <div id="res-score" style="font-size:3rem; font-weight:800; color:var(--brand); margin:20px 0;"></div>
        <button onclick="document.getElementById('res-modal').style.display='none'" style="padding:10px 30px; background:var(--brand); color:white; border:none; border-radius:6px; cursor:pointer;">–ó—Ä–æ–∑—É–º—ñ–ª–æ</button>
      </div>
    </div>

    <script>
      /* --- –î–ê–ù–Ü –ö–£–†–°–£ (–¢–µ —Å–∞–º–µ, —â–æ –π –±—É–ª–æ) --- */
      const modules = [
        {
          title: "1. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: –î–µ –º–∏ –∑–Ω–∞—Ö–æ–¥–∏–º–æ—Å—å?",
          theory: `
            <p>–£—è–≤–∏ –∞—Ä–∫—É—à –ø–∞–ø–µ—Ä—É –≤ –∫–ª—ñ—Ç–∏–Ω–∫—É. –ú–∏ –º–∞–ª—é—î–º–æ –¥–≤—ñ –ª—ñ–Ω—ñ—ó: <b>–≤—ñ—Å—å X</b> (–≤–ø—Ä–∞–≤–æ-–≤–ª—ñ–≤–æ) —ñ <b>–≤—ñ—Å—å Y</b> (–≤–≥–æ—Ä—É-–≤–Ω–∏–∑).</p>
            <div class="concept-box">
              –ë—É–¥—å-—è–∫–∞ —Ç–æ—á–∫–∞ –º–∞—î –∞–¥—Ä–µ—Å—É: $(x; y)$.<br>
              –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —Ç–æ—á–∫–∞ $A(3; 2)$ –æ–∑–Ω–∞—á–∞—î: "3 –∫—Ä–æ–∫–∏ –≤–ø—Ä–∞–≤–æ, 2 –∫—Ä–æ–∫–∏ –≤–≥–æ—Ä—É".
            </div>
            <p><b>–í—ñ–¥—Å—Ç–∞–Ω—å –º—ñ–∂ —Ç–æ—á–∫–∞–º–∏ (–î–æ–≤–∂–∏–Ω–∞ –≤—ñ–¥—Ä—ñ–∑–∫–∞):</b></p>
            <p>–¶–µ –ø—Ä–æ—Å—Ç–æ —Ç–µ–æ—Ä–µ–º–∞ –ü—ñ—Ñ–∞–≥–æ—Ä–∞. –í—ñ–¥–Ω—ñ–º–∏ —ñ–∫—Å–∏, –≤—ñ–¥–Ω—ñ–º–∏ —ñ–≥—Ä–µ–∫–∏, –ø—ñ–¥–Ω–µ—Å–∏ –¥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ —ñ –¥–æ–¥–∞–π.</p>
            <div class="math-display">$$ d = \\sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2} $$</div>
          `,
          tasks: [
            { q: "–¢–æ—á–∫–∞ A(1; 2), —Ç–æ—á–∫–∞ B(4; 2). –Ø–∫–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –º—ñ–∂ –Ω–∏–º–∏?", a: ["3"], hint: "–Ü–≥—Ä–µ–∫–∏ –æ–¥–Ω–∞–∫–æ–≤—ñ, –∑–º—ñ–Ω—é—î—Ç—å—Å—è –ª–∏—à–µ X: $4-1$.", sol: "3" },
            { q: "–ó–Ω–∞–π–¥–∏ –≤—ñ–¥—Å—Ç–∞–Ω—å –≤—ñ–¥ –ø–æ—á–∞—Ç–∫—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (0;0) –¥–æ —Ç–æ—á–∫–∏ (3; 4).", a: ["5"], hint: "–§–æ—Ä–º—É–ª–∞: $\\sqrt{3^2 + 4^2}$.", sol: "$\\sqrt{9+16} = \\sqrt{25} = 5$" },
            { q: "–î–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Ç–æ—á–∫–∞ (-2; 0)? (–ù–∞ –æ—Å—ñ X —á–∏ Y?)", a: ["X", "–ù–∞ –æ—Å—ñ X"], hint: "–Ø–∫—â–æ Y=0, –º–∏ –Ω–µ –ø—ñ–¥–Ω—ñ–º–∞—î–º–æ—Å—å –≤–≥–æ—Ä—É.", sol: "–ù–∞ –æ—Å—ñ X." },
            { q: "–û–±—á–∏—Å–ª–∏ –≤—ñ–¥—Å—Ç–∞–Ω—å –º—ñ–∂ (1;1) —ñ (4;5).", a: ["5"], hint: "$x: 4-1=3$, $y: 5-1=4$. –ü—ñ—Ñ–∞–≥–æ—Ä 3 —ñ 4.", sol: "$\\sqrt{3^2+4^2} = 5$" }
          ]
        },
        {
          title: "2. –©–æ —Ç–∞–∫–µ –°–∏–Ω—É—Å —ñ –ö–æ—Å–∏–Ω—É—Å?",
          theory: `
            <p>–ù–µ –ª—è–∫–∞–π—Å—è —Ü–∏—Ö —Å–ª—ñ–≤. –¶–µ –ø—Ä–æ—Å—Ç–æ <b>–ø—Ä–æ–ø–æ—Ä—Ü—ñ—ó</b> —É –ø—Ä—è–º–æ–∫—É—Ç–Ω–æ–º—É —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫—É.</p>
            <ul>
              <li><b>–°–∏–Ω—É—Å ($\sin$)</b> ‚Äî –ø–æ–∫–∞–∑—É—î "–≤–∏—Å–æ—Ç—É".</li>
              <li><b>–ö–æ—Å–∏–Ω—É—Å ($\cos$)</b> ‚Äî –ø–æ–∫–∞–∑—É—î "–¥–æ–≤–∂–∏–Ω—É".</li>
            </ul>
            <div class="concept-box">
              –¢–æ–±—ñ –Ω–µ —Ç—Ä–µ–±–∞ —Ä–∞—Ö—É–≤–∞—Ç–∏ —ó—Ö –≤ –≥–æ–ª–æ–≤—ñ! –î–ª—è —Ü—å–æ–≥–æ —î <b>–¢–ê–ë–õ–ò–¶–Ø</b> (–∫–Ω–æ–ø–∫–∞ –≤–≥–æ—Ä—ñ).<br>
              –ù–∞–ø—Ä–∏–∫–ª–∞–¥, $\sin 30^\circ = 0.5$. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∏—Å–æ—Ç–∞ —Ä—ñ–≤–Ω–æ –≤ 2 —Ä–∞–∑–∏ –º–µ–Ω—à–∞ –∑–∞ –Ω–∞–π–¥–æ–≤—à—É —Å—Ç–æ—Ä–æ–Ω—É.
            </div>
            <p>–ù–∞–π–≥–æ–ª–æ–≤–Ω—ñ—à–∞ —Ñ–æ—Ä–º—É–ª–∞ (–¢–æ—Ç–æ–∂–Ω—ñ—Å—Ç—å):</p>
            <div class="math-display">$$ \\sin^2 \\alpha + \\cos^2 \\alpha = 1 $$</div>
          `,
          tasks: [
            { q: "–ó–Ω–∞–π–¥–∏ —É —Ç–∞–±–ª–∏—Ü—ñ: —á–æ–º—É –¥–æ—Ä—ñ–≤–Ω—é—î $\\sin 30^\\circ$?", a: ["0.5", "1/2"], hint: "–ù–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É '–¢–∞–±–ª–∏—Ü—è' –≤–≥–æ—Ä—ñ.", sol: "0.5" },
            { q: "–ß–æ–º—É –¥–æ—Ä—ñ–≤–Ω—é—î $\\cos 60^\\circ$?", a: ["0.5", "1/2"], hint: "–î–∏–≤–∏—Å—å —Ç–∞–±–ª–∏—Ü—é.", sol: "0.5" },
            { q: "–ß–æ–º—É –¥–æ—Ä—ñ–≤–Ω—é—î $\\cos 120^\\circ$? (–£–≤–∞–≥–∞ –Ω–∞ –∑–Ω–∞–∫!)", a: ["-0.5", "-1/2"], hint: "–¢—É–ø–∏–π –∫—É—Ç –º–∞—î –≤—ñ–¥'—î–º–Ω–∏–π –∫–æ—Å–∏–Ω—É—Å.", sol: "-0.5" },
            { q: "–Ø–∫—â–æ $\\sin^2 \\alpha = 0.64$, —Ç–æ —á–æ–º—É –¥–æ—Ä—ñ–≤–Ω—é—î $\\cos^2 \\alpha$?", a: ["0.36"], hint: "$1 - 0.64 = ?$", sol: "0.36" }
          ]
        },
        {
          title: "3. –¢–µ–æ—Ä–µ–º–∞ –ö–æ—Å–∏–Ω—É—Å—ñ–≤ (–ì–æ–ª–æ–≤–Ω–∞ —Ç–µ–æ—Ä–µ–º–∞)",
          theory: `
            <p>–£ 8 –∫–ª–∞—Å—ñ –±—É–ª–∞ —Ç–µ–æ—Ä–µ–º–∞ –ü—ñ—Ñ–∞–≥–æ—Ä–∞ ($c^2 = a^2 + b^2$), –∞–ª–µ –≤–æ–Ω–∞ –ø—Ä–∞—Ü—é–≤–∞–ª–∞ —Ç—ñ–ª—å–∫–∏ –¥–ª—è –∫—É—Ç–∞ $90^\\circ$.</p>
            <p>–£ 9 –∫–ª–∞—Å—ñ –º–∏ –º–∞—î–º–æ —Ñ–æ—Ä–º—É–ª—É –¥–ª—è <b>–ë–£–î–¨-–Ø–ö–û–ì–û</b> —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞:</p>
            <div class="math-display">$$ c^2 = a^2 + b^2 - 2ab \\cos \\gamma $$</div>
            <p>–î–µ $\\gamma$ ‚Äî —Ü–µ –∫—É—Ç –º—ñ–∂ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ $a$ —ñ $b$.</p>
            <div class="concept-box">
              <b>–Ø–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—è:</b><br>
              1. –ë–µ—Ä–∏ –¥–≤—ñ —Å—Ç–æ—Ä–æ–Ω–∏.<br>
              2. –ë–µ—Ä–∏ –∫—É—Ç –º—ñ–∂ –Ω–∏–º–∏.<br>
              3. –ü—ñ–¥—Å—Ç–∞–≤–ª—è–π —É —Ñ–æ—Ä–º—É–ª—É. –ù–µ –∑–∞–±—É–¥—å –≥–ª—è–Ω—É—Ç–∏ $\\cos$ —É —Ç–∞–±–ª–∏—Ü—é!
            </div>
          `,
          tasks: [
            { q: "–°—Ç–æ—Ä–æ–Ω–∏ $a=3, b=4$, –∫—É—Ç –º—ñ–∂ –Ω–∏–º–∏ $90^\\circ$. $\\cos 90^\\circ = 0$. –ó–Ω–∞–π–¥–∏ $c$.", a: ["5"], hint: "–•–≤—ñ—Å—Ç —Ñ–æ—Ä–º—É–ª–∏ –∑–Ω–∏–∫–∞—î, –ª–∏—à–∞—î—Ç—å—Å—è –ü—ñ—Ñ–∞–≥–æ—Ä.", sol: "$\\sqrt{9+16}=5$" },
            { q: "–°—Ç–æ—Ä–æ–Ω–∏ 5 —ñ 5, –∫—É—Ç $60^\\circ$. –ó–Ω–∞–π–¥–∏ $c^2$.", a: ["25"], hint: "$25+25 - 2\\cdot5\\cdot5\\cdot0.5$.", sol: "$50 - 25 = 25$." },
            { q: "–°—Ç–æ—Ä–æ–Ω–∏ 1 —ñ 2, –∫—É—Ç $60^\\circ$. –ó–Ω–∞–π–¥–∏ $c^2$.", a: ["3"], hint: "$1^2 + 2^2 - 2\\cdot1\\cdot2\\cdot0.5$", sol: "$1+4 - 2 = 3$" },
            { q: "–°—Ç–æ—Ä–æ–Ω–∏ 10 —ñ 10, –∫—É—Ç $120^\\circ$. $\\cos 120^\\circ = -0.5$. –ó–Ω–∞–π–¥–∏ $c^2$.", a: ["300"], hint: "–ú—ñ–Ω—É—Å –Ω–∞ –º—ñ–Ω—É—Å –¥–∞—î –ø–ª—é—Å! $-2ab(-0.5)$ —Å—Ç–∞–Ω–µ $+ab$.", sol: "$100+100 - 200(-0.5) = 200 + 100 = 300$" }
          ]
        },
        {
          title: "4. –¢–µ–æ—Ä–µ–º–∞ –°–∏–Ω—É—Å—ñ–≤ (–î–ª—è –ø–∞—Ä)",
          theory: `
            <p>–¶—è —Ç–µ–æ—Ä–µ–º–∞ –ø–æ–≤'—è–∑—É—î —Å—Ç–æ—Ä–æ–Ω—É —ñ <b>–ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–∏–π</b> –∫—É—Ç. –í–æ–Ω–∞ –∫–∞–∂–µ, —â–æ –≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –∑–∞–≤–∂–¥–∏ –æ–¥–Ω–∞–∫–æ–≤–µ.</p>
            <div class="math-display">$$ \\frac{a}{\\sin \\alpha} = \\frac{b}{\\sin \\beta} = 2R $$</div>
            <p>–î–µ $R$ ‚Äî —Ä–∞–¥—ñ—É—Å –∫–æ–ª–∞, –æ–ø–∏—Å–∞–Ω–æ–≥–æ –Ω–∞–≤–∫–æ–ª–æ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞.</p>
            <p><i>–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏?</i> –ö–æ–ª–∏ –∑–Ω–∞—î—à '–ø–∞—Ä—É' (—Å—Ç–æ—Ä–æ–Ω—É —ñ –∫—É—Ç –Ω–∞–≤–ø—Ä–æ—Ç–∏).</p>
          `,
          tasks: [
            { q: "–°—Ç–æ—Ä–æ–Ω–∞ $a=10$, $\\sin \\alpha = 0.5$. –ß–æ–º—É –¥–æ—Ä—ñ–≤–Ω—é—î –¥—Ä—ñ–± $a / \\sin \\alpha$?", a: ["20"], hint: "$10$ –ø–æ–¥—ñ–ª–∏—Ç–∏ –Ω–∞ $0.5$ (—Ü–µ —Ç–µ —Å–∞–º–µ, —â–æ –ø–æ–º–Ω–æ–∂–∏—Ç–∏ –Ω–∞ 2).", sol: "20" },
            { q: "–†–∞–¥—ñ—É—Å –æ–ø–∏—Å–∞–Ω–æ–≥–æ –∫–æ–ª–∞ $R=5$. –ß–æ–º—É –¥–æ—Ä—ñ–≤–Ω—é—î —Å—Ç–æ—Ä–æ–Ω–∞ $a$, —è–∫—â–æ $\\sin \\alpha = 1$?", a: ["10"], hint: "$a / 1 = 2 \\cdot 5$.", sol: "10" },
            { q: "–£ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫—É $\\frac{a}{\\sin A} = 15$. –ß–æ–º—É –¥–æ—Ä—ñ–≤–Ω—é—î $\\frac{b}{\\sin B}$?", a: ["15"], hint: "–í–æ–Ω–∏ –≤—Å—ñ —Ä—ñ–≤–Ω—ñ –º—ñ–∂ —Å–æ–±–æ—é.", sol: "15" }
          ]
        }
      ];

      /* --- JS –õ–û–ì–Ü–ö–ê (–¢–µ —Å–∞–º–µ) --- */
      let totalTasks = 0; let solvedTasks = 0;

      document.addEventListener("DOMContentLoaded", () => {
        const root = document.getElementById('content-root');
        modules.forEach((mod, idx) => {
          totalTasks += mod.tasks.length;
          const moduleDiv = document.createElement('div');
          moduleDiv.className = 'module';
          moduleDiv.innerHTML = `
            <div class="module-header"><span style="font-size:1.5rem">üìò</span><h3 class="module-title">${mod.title}</h3></div>
            <div class="theory-body">${mod.theory}</div>
          `;
          const tasksGrid = document.createElement('div');
          tasksGrid.className = 'tasks-list';
          mod.tasks.forEach((task, tIdx) => {
            const uid = `t-${idx}-${tIdx}`;
            const card = document.createElement('div');
            card.className = 'task-card';
            card.id = `card-${uid}`;
            card.innerHTML = `
              <div class="q-text">${task.q}</div>
              <div class="input-row">
                <input type="text" class="ans-input" id="in-${uid}" placeholder="..." onkeydown="if(event.key==='Enter') checkAns('${uid}', '${task.a}')">
                <button class="btn-check" onclick="checkAns('${uid}', '${task.a}')">OK</button>
              </div>
              <div class="help-row">
                <button class="help-btn" onclick="toggleDisplay('h-${uid}')">–ü—ñ–¥–∫–∞–∑–∫–∞</button>
                <button class="help-btn" onclick="toggleDisplay('s-${uid}')">–†–æ–∑–≤'—è–∑–∞–Ω–Ω—è</button>
              </div>
              <div id="h-${uid}" class="hint-div">üí° ${task.hint}</div>
              <div id="s-${uid}" class="sol-div">üìù ${task.sol}</div>
            `;
            tasksGrid.appendChild(card);
          });
          moduleDiv.appendChild(tasksGrid);
          root.appendChild(moduleDiv);
        });

        renderMathInElement(document.body, {
          delimiters: [{left: "$$", right: "$$", display: true}, {left: "$", right: "$", display: false}],
          throwOnError: false
        });
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–æ—à–∫–∏
        resizeCanvas();
      });

      function toggleTable() {
        const modal = document.getElementById('table-modal');
        const isHidden = modal.style.display === '' || modal.style.display === 'none';
        modal.style.display = isHidden ? 'flex' : 'none';
        if (isHidden) {
          renderMathInElement(modal, {
            delimiters: [{left: "$$", right: "$$", display: true}, {left: "$", right: "$", display: false}],
            throwOnError: false
          });
        }
      }

      function toggleDisplay(id) {
        const el = document.getElementById(id);
        const isHidden = el.style.display === 'none' || el.style.display === '';
        el.style.display = isHidden ? 'block' : 'none';
        if(isHidden) renderMathInElement(el);
      }

      function checkAns(id, answers) {
        const inp = document.getElementById(`in-${id}`);
        const card = document.getElementById(`card-${id}`);
        if (inp.disabled) return;
        let val = inp.value.trim().replace(',', '.').toLowerCase();
        if (!val) return;
        inp.disabled = true;
        const correctArr = Array.isArray(answers) ? answers : [answers];
        const isCorrect = correctArr.some(ans => {
           return val === ans.toLowerCase() || Math.abs(parseFloat(val) - parseFloat(ans)) < 0.1;
        });
        if (isCorrect) {
          card.classList.add('correct'); solvedTasks++;
        } else {
          card.classList.add('wrong');
          const sDiv = document.getElementById(`s-${id}`);
          sDiv.style.display = 'block'; renderMathInElement(sDiv);
        }
      }

      function finishLesson() {
        const modal = document.getElementById('res-modal');
        const scoreDiv = document.getElementById('res-score');
        const title = document.getElementById('res-title');
        const msg = document.getElementById('res-msg');
        let score = Math.round((solvedTasks / totalTasks) * 12);
        scoreDiv.innerText = `${score} / 12`;
        if(score >= 10) { title.innerText = "–¢–∏ –≥–µ–Ω—ñ–π! üöÄ"; msg.innerText = "–ó —Ç–∞–∫–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –º–æ–∂–Ω–∞ –π—Ç–∏ —Ö–æ—á –Ω–∞ –æ–ª—ñ–º–ø—ñ–∞–¥—É!"; }
        else if(score >= 7) { title.innerText = "–ö–ª–∞—Å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! üëç"; msg.innerText = "–¢–∏ –∑—Ä–æ–∑—É–º—ñ–≤ –æ—Å–Ω–æ–≤–∏, —ñ —Ü–µ –≥–æ–ª–æ–≤–Ω–µ."; }
        else { title.innerText = "–ì–∞—Ä–Ω–∏–π –ø–æ—á–∞—Ç–æ–∫ üå±"; msg.innerText = "–ö–æ—Ä–∏—Å—Ç—É–π—Å—è —à–ø–∞—Ä–≥–∞–ª–∫–æ—é —ñ —Å–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑."; }
        modal.style.display = 'flex';
      }

      /* --- –ù–û–í–ê –õ–û–ì–Ü–ö–ê –î–û–®–ö–ò --- */
      const canvas = document.getElementById('board');
      const ctx = canvas.getContext('2d');
      const boardPanel = document.getElementById('board-panel');
      let painting = false;
      let tool = 'pen';
      let lastX = 0; let lastY = 0;
      let trianglePoints = []; // –î–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–æ—á–æ–∫ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞

      function resizeCanvas() {
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π –º–∞–ª—é–Ω–æ–∫
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = canvas.width; tempCanvas.height = canvas.height;
        const tempCtx = tempCanvas.getContext('2d');
        if(canvas.width > 0) tempCtx.drawImage(canvas, 0, 0);

        canvas.width = boardPanel.offsetWidth;
        canvas.height = boardPanel.offsetHeight;
        
        // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –º–∞–ª—é–Ω–æ–∫
        ctx.drawImage(tempCanvas, 0, 0);

        ctx.lineJoin = 'round'; ctx.lineCap = 'round';
      }
      window.addEventListener('resize', resizeCanvas);

      function getPos(e) {
        const r = canvas.getBoundingClientRect();
        const cx = e.touches ? e.touches[0].clientX : e.clientX;
        const cy = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: cx - r.left, y: cy - r.top };
      }

      function startDraw(e) {
        const {x, y} = getPos(e);
        if (tool === 'triangle') {
          trianglePoints.push({x, y});
          drawTemporaryPoints();
          if (trianglePoints.length === 3) {
            finalizeTriangle();
          }
        } else {
          painting = true;
          [lastX, lastY] = [x, y];
        }
      }

      function draw(e) {
        if(!painting || tool === 'triangle') return;
        const {x, y} = getPos(e);
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        if(tool === 'pen') {
          ctx.lineWidth = 3; ctx.strokeStyle = '#6366f1'; ctx.globalCompositeOperation = 'source-over';
           // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω—ñ –∫—Ä–∏–≤—ñ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç—ñ
           const midX = (lastX + x) / 2;
           const midY = (lastY + y) / 2;
           ctx.quadraticCurveTo(lastX, lastY, midX, midY);
           [lastX, lastY] = [x, y]; // –û–Ω–æ–≤–ª—é—î–º–æ –æ—Å—Ç–∞–Ω–Ω—é —Ç–æ—á–∫—É, –∞–ª–µ –Ω–µ –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –∫—Ä–∏–≤–æ—ó
        } else {
          ctx.lineWidth = 30; ctx.strokeStyle = '#fff'; ctx.globalCompositeOperation = 'destination-out';
          ctx.lineTo(x, y);
          [lastX, lastY] = [x, y];
        }
        ctx.stroke();
      }

      function stopDraw() { painting = false; }

      // –ú–∞–ª—é–≤–∞–Ω–Ω—è —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö —Ç–æ—á–æ–∫ –¥–ª—è —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞
      function drawTemporaryPoints() {
         // –ú–∞–ª—é—î–º–æ –º–∞–ª–µ–Ω—å–∫—ñ –∫—Ä—É–∂–µ—á–∫–∏
         const savedComposite = ctx.globalCompositeOperation;
         ctx.globalCompositeOperation = 'source-over';
         ctx.fillStyle = '#6366f1';
         trianglePoints.forEach(p => {
             ctx.beginPath(); ctx.arc(p.x, p.y, 4, 0, Math.PI*2); ctx.fill();
         });
         ctx.globalCompositeOperation = savedComposite;
      }

      // –ú–∞–ª—é–≤–∞–Ω–Ω—è —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞
      function finalizeTriangle() {
          ctx.globalCompositeOperation = 'source-over';
          ctx.strokeStyle = '#6366f1'; ctx.lineWidth = 3;
          ctx.beginPath();
          ctx.moveTo(trianglePoints[0].x, trianglePoints[0].y);
          ctx.lineTo(trianglePoints[1].x, trianglePoints[1].y);
          ctx.lineTo(trianglePoints[2].x, trianglePoints[2].y);
          ctx.closePath();
          ctx.stroke();
          // –°–∫–∏–¥–∞—î–º–æ
          trianglePoints = [];
          setTool('pen'); // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—å –¥–æ —Ä—É—á–∫–∏
      }

      canvas.addEventListener('mousedown', startDraw);
      canvas.addEventListener('touchstart', startDraw, {passive: false});
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('touchmove', draw, {passive: false});
      canvas.addEventListener('mouseup', stopDraw);
      canvas.addEventListener('touchend', stopDraw);
      canvas.addEventListener('mouseout', stopDraw);


      function setTool(t) {
        tool = t;
        boardPanel.setAttribute('data-tool', t);
        trianglePoints = []; // –°–∫–∏–¥–∞—î–º–æ —Ç–æ—á–∫–∏ —è–∫—â–æ –ø–µ—Ä–µ–º–∫–Ω—É–ª–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
        document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
        if(t==='pen') document.getElementById('t-pen').classList.add('active');
        if(t==='eraser') document.getElementById('t-eraser').classList.add('active');
        if(t==='triangle') document.getElementById('t-triangle').classList.add('active');
      }
      
      function clearBoard() {
          if(confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –¥–æ—à–∫—É?')) {
              ctx.clearRect(0,0,canvas.width, canvas.height);
              trianglePoints = [];
          }
      }

      function drawAxes() {
        const w = canvas.width, h = canvas.height;
        const cx = w/2, cy = h/2;
        ctx.globalCompositeOperation='source-over';
        
        ctx.strokeStyle='#0f172a'; ctx.lineWidth=2;
        ctx.beginPath();
        // –í—ñ—Å—å Y
        ctx.moveTo(cx, 20); ctx.lineTo(cx, h-20);
        ctx.lineTo(cx-5, 25); ctx.moveTo(cx, 20); ctx.lineTo(cx+5, 25); // –°—Ç—Ä—ñ–ª–∫–∞ Y
        // –í—ñ—Å—å X
        ctx.moveTo(20, cy); ctx.lineTo(w-20, cy);
        ctx.lineTo(w-25, cy-5); ctx.moveTo(w-20, cy); ctx.lineTo(w-25, cy+5); // –°—Ç—Ä—ñ–ª–∫–∞ X
        ctx.stroke();

        ctx.font = "bold 16px sans-serif"; ctx.fillStyle = "#0f172a";
        ctx.fillText("y", cx + 10, 30);
        ctx.fillText("x", w - 30, cy - 10);
        
        setTool('pen');
      }
    </script>
  </body>
</html>
