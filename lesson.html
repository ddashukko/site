<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–®–∞–±–ª–æ–Ω –£—Ä–æ–∫—É | Dasha Tutor</title>
    <style>
      :root {
        --primary: #4a90e2;
        --success: #28a745;
        --error: #dc3545;
        --bg: #f4f7f6;
        --card: #ffffff;
        --text: #333;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--bg);
        color: var(--text);
        margin: 0;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
      }

      /* --- –•–ï–î–ï–† --- */
      header {
        background: var(--card);
        padding: 0 20px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 50px;
        flex-shrink: 0;
        z-index: 10;
      }

      .header-title {
        font-weight: bold;
        color: var(--primary);
      }

      .stats {
        display: flex;
        gap: 10px;
        font-weight: bold;
        font-size: 0.9rem;
      }
      .stat-box {
        padding: 4px 10px;
        border-radius: 15px;
      }
      .stat-correct {
        background: #d4edda;
        color: #155724;
      }
      .stat-wrong {
        background: #f8d7da;
        color: #721c24;
      }
      .slide-counter {
        color: #666;
        font-size: 0.9rem;
      }

      /* --- –ì–û–õ–û–í–ù–ò–ô –ö–û–ù–¢–ï–ô–ù–ï–† --- */
      .slide-container {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        height: calc(100vh - 110px);
        overflow: hidden;
      }

      /* –ï–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ */
      .results-view {
        padding: 30px;
        overflow-y: auto;
        text-align: center;
        background: white;
        height: 100%;
      }
      .results-summary {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 30px;
      }
      .res-card {
        background: #f8f9fa;
        padding: 15px 25px;
        border-radius: 10px;
        border: 1px solid #eee;
      }
      .res-num {
        font-size: 2rem;
        font-weight: bold;
        display: block;
      }

      .results-table {
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
        border-collapse: collapse;
        text-align: left;
      }
      .results-table th,
      .results-table td {
        padding: 12px;
        border-bottom: 1px solid #eee;
      }
      .results-table th {
        background-color: #f1f1f1;
      }
      .row-perfect {
        color: var(--success);
        font-weight: bold;
      }
      .row-bad {
        color: var(--error);
      }

      .btn-restart {
        margin-top: 30px;
        background: var(--primary);
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 1.2rem;
        border-radius: 8px;
        cursor: pointer;
      }

      /* --- –°–õ–ê–ô–î –ó–ê–í–î–ê–ù–ù–Ø --- */
      .image-area {
        flex: 0 0 40%;
        background: #eef2f5;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #ddd;
      }

      .task-img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        border-radius: 4px;
      }

      .tasks-area {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        background: var(--card);
      }

      h2 {
        margin-top: 0;
        font-size: 1.2rem;
        color: var(--primary);
        border-bottom: 2px solid #eee;
        padding-bottom: 5px;
      }
      .instruction {
        font-size: 1rem;
        margin-bottom: 15px;
        color: #555;
        font-style: italic;
      }

      .subtasks-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .subtask-row {
        display: flex;
        align-items: center;
        background: #f9f9f9;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #eee;
        flex-wrap: wrap;
        gap: 10px;
      }

      .subtask-row.solved {
        background: #e8f8f5;
        border-color: var(--success);
      }
      .label {
        font-weight: bold;
        color: var(--primary);
        min-width: 25px;
      }
      .question-text {
        flex-grow: 1;
        font-weight: 500;
        min-width: 120px;
      }

      input[type="text"] {
        padding: 6px;
        border: 2px solid #ccc;
        border-radius: 6px;
        width: 80px;
        text-align: center;
        font-size: 1rem;
      }
      input:focus {
        outline: none;
        border-color: var(--primary);
      }
      input.correct {
        border-color: var(--success);
        background: white;
        color: var(--success);
        font-weight: bold;
      }
      input.wrong {
        border-color: var(--error);
        background: #fff5f5;
      }

      button.check-btn {
        background: var(--primary);
        color: white;
        border: none;
        padding: 7px 12px;
        border-radius: 6px;
        cursor: pointer;
      }

      .choice-btn {
        background: white;
        border: 1px solid #ccc;
        padding: 6px 10px;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 5px;
        margin-bottom: 5px;
      }
      .choice-btn.selected-correct {
        background: var(--success);
        color: white;
        border-color: var(--success);
      }
      .choice-btn.selected-wrong {
        background: var(--error);
        color: white;
        border-color: var(--error);
      }

      /* --- –§–£–¢–ï–† --- */
      footer {
        height: 60px;
        background: var(--card);
        border-top: 1px solid #ddd;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 20px;
        flex-shrink: 0;
      }

      .nav-btn {
        background: var(--primary);
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 1rem;
        border-radius: 8px;
        cursor: pointer;
      }
      .nav-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      @media (max-height: 600px) {
        .image-area {
          flex: 0 0 30%;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-title">Dasha Tutor</div>
      <div class="stats">
        <div class="stat-box stat-correct">
          ‚úÖ <span id="val-correct">0</span>
        </div>
        <div class="stat-box stat-wrong">‚ùå <span id="val-wrong">0</span></div>
      </div>
      <div class="slide-counter" id="slide-counter">Start</div>
    </header>

    <div class="slide-container" id="slide-root"></div>

    <footer id="footer-nav">
      <button class="nav-btn" id="btn-prev" onclick="changeSlide(-1)">
        ‚Üê –ù–∞–∑–∞–¥
      </button>
      <button class="nav-btn" id="btn-next" onclick="changeSlide(1)">
        –î–∞–ª—ñ ‚Üí
      </button>
    </footer>

    <script>
      // =========================================================
      // –°–Æ–î–ò –¢–ò –ë–£–î–ï–® –í–°–¢–ê–í–õ–Ø–¢–ò –î–ê–ù–Ü –í–Ü–î GEMINI
      // =========================================================
      const lessonData = [
        // –ó–∞–ª–∏—à —Ü–µ –º—ñ—Å—Ü–µ –ø—É—Å—Ç–∏–º, —è –±—É–¥—É –Ω–∞–¥—Å–∏–ª–∞—Ç–∏ —Ç–æ–±—ñ –∫–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ —Å—é–¥–∏
      ];
      // =========================================================

      let currentIndex = 0;
      let correctTotal = 0;
      let wrongTotal = 0;

      const root = document.getElementById("slide-root");
      const counter = document.getElementById("slide-counter");
      const statCorrect = document.getElementById("val-correct");
      const statWrong = document.getElementById("val-wrong");
      const btnPrev = document.getElementById("btn-prev");
      const btnNext = document.getElementById("btn-next");
      const footer = document.getElementById("footer-nav");

      function init() {
        if (lessonData.length > 0) {
          renderSlide(0);
        } else {
          root.innerHTML =
            "<h2 style='text-align:center; margin-top:50px; color:#555;'>–î–∞–Ω—ñ —É—Ä–æ–∫—É —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ.<br>–í—Å—Ç–∞–≤ –∫–æ–¥ –≤—ñ–¥ Gemini —É –∑–º—ñ–Ω–Ω—É lessonData.</h2>";
        }
      }

      function renderSlide(index) {
        currentIndex = index;
        const data = lessonData[index];

        counter.innerText = `${index + 1} / ${lessonData.length}`;
        btnPrev.disabled = index === 0;
        btnNext.innerText =
          index === lessonData.length - 1 ? "–ó–∞–≤–µ—Ä—à–∏—Ç–∏" : "–î–∞–ª—ñ ‚Üí";
        btnNext.disabled = false;

        let subTasksHTML = "";

        data.tasks.forEach((task) => {
          let inputHTML = "";

          if (data.type === "choice" || task.opts) {
            task.opts.forEach((opt) => {
              inputHTML += `<button class="choice-btn" onclick="checkChoice(this, '${opt}', '${task.a}', this.parentElement.parentElement)">${opt}</button>`;
            });
          } else {
            inputHTML = `
                        <input type="text" placeholder="?" onkeypress="handleEnter(event, this)">
                        <button class="check-btn" onclick="checkInput(this.previousElementSibling, '${task.a}', this.parentElement)">OK</button>
                    `;
          }

          subTasksHTML += `
                    <div class="subtask-row">
                        <div class="label">${task.label}</div>
                        <div class="question-text">${task.q}</div>
                        <div class="interaction-area">${inputHTML}</div>
                    </div>
                `;
        });

        root.innerHTML = `
                <div class="image-area">
                    <img src="${data.img}" class="task-img" alt="–ó–∞–≤–¥–∞–Ω–Ω—è" onerror="this.src='https://placehold.co/400x300?text=–ù–µ–º–∞—î+–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è';">
                </div>
                <div class="tasks-area">
                    <h2>–ó–∞–≤–¥–∞–Ω–Ω—è ‚Ññ ${data.id}</h2>
                    <p class="instruction">${data.instruction}</p>
                    <div class="subtasks-list">
                        ${subTasksHTML}
                    </div>
                </div>
            `;
      }

      function changeSlide(dir) {
        const next = currentIndex + dir;
        if (next >= lessonData.length) {
          showResults();
          return;
        }
        if (next >= 0 && next < lessonData.length) {
          renderSlide(next);
        }
      }

      function showResults() {
        footer.style.display = "none";
        counter.innerText = "–†–µ–∑—É–ª—å—Ç–∞—Ç–∏";
        let detailsHTML = "";
        lessonData.forEach((task) => {
          const mistakes = task.errorCount || 0;
          const rowClass = mistakes === 0 ? "row-perfect" : "row-bad";
          const rowText =
            mistakes === 0 ? "0 –ø–æ–º–∏–ª–æ–∫ (–ß—É–¥–æ–≤–æ!)" : `${mistakes} –ø–æ–º–∏–ª–æ–∫`;
          detailsHTML += `<tr><td>–ó–∞–≤–¥–∞–Ω–Ω—è ‚Ññ ${task.id}</td><td class="${rowClass}">${rowText}</td></tr>`;
        });

        root.innerHTML = `
                <div class="results-view">
                    <h1>–í—ñ—Ç–∞—é —ñ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è–º! üéâ</h1>
                    <div class="results-summary">
                        <div class="res-card"><span class="res-num" style="color:var(--success)">${correctTotal}</span>–ü—Ä–∞–≤–∏–ª—å–Ω–æ</div>
                        <div class="res-card"><span class="res-num" style="color:var(--error)">${wrongTotal}</span>–ü–æ–º–∏–ª–æ–∫</div>
                    </div>
                    <h3>–î–µ—Ç–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç:</h3>
                    <table class="results-table">
                        <thead><tr><th>–ó–∞–≤–¥–∞–Ω–Ω—è</th><th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th></tr></thead>
                        <tbody>${detailsHTML}</tbody>
                    </table>
                    <button class="btn-restart" onclick="location.reload()">üîÑ –ü–æ—á–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
                </div>
            `;
      }

      function checkInput(inputEl, correctVal, rowEl) {
        if (rowEl.classList.contains("solved")) return;
        const val = inputEl.value.trim().replace(",", ".");
        let isCorrect = false;
        if (Array.isArray(correctVal)) {
          isCorrect = correctVal.includes(val);
        } else {
          isCorrect = val == correctVal;
        }

        if (isCorrect) {
          inputEl.classList.add("correct");
          inputEl.classList.remove("wrong");
          rowEl.classList.add("solved");
          correctTotal++;
        } else {
          inputEl.classList.add("wrong");
          wrongTotal++;
          lessonData[currentIndex].errorCount =
            (lessonData[currentIndex].errorCount || 0) + 1;
        }
        updateStats();
      }

      function checkChoice(btnEl, val, correctVal, rowEl) {
        if (rowEl.classList.contains("solved")) return;
        if (val == correctVal) {
          btnEl.classList.add("selected-correct");
          rowEl.classList.add("solved");
          correctTotal++;
        } else {
          btnEl.classList.add("selected-wrong");
          wrongTotal++;
          lessonData[currentIndex].errorCount =
            (lessonData[currentIndex].errorCount || 0) + 1;
        }
        updateStats();
      }

      function handleEnter(e, inputEl) {
        if (e.key === "Enter") inputEl.nextElementSibling.click();
      }
      function updateStats() {
        statCorrect.innerText = correctTotal;
        statWrong.innerText = wrongTotal;
      }

      init();
    </script>
  </body>
</html>
