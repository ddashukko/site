<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–î–ó: –†—ñ–≤–Ω—è–Ω–Ω—è (–ö–æ–Ω—Ç—Ä–æ–ª—å)</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    ></script>

    <style>
      :root {
        --primary: #ea580c; /* –ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π */
        --primary-hover: #c2410c;
        --success: #16a34a;
        --error: #dc2626;
        --bg: #f8fafc;
        --card: #ffffff;
        --text: #1e293b;
        --border: #e2e8f0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: var(--bg);
        color: var(--text);
        margin: 0;
        padding: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      header {
        background: var(--card);
        padding: 15px 20px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .header-title {
        font-weight: 800;
        font-size: 1.2rem;
        color: var(--primary);
      }

      .mode-badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
      }
      .mode-student {
        background: #eff6ff;
        color: #2563eb;
      }
      .mode-teacher {
        background: #fef2f2;
        color: #dc2626;
        border: 1px solid #dc2626;
      }

      .container {
        max-width: 800px;
        margin: 20px auto;
        padding: 0 20px;
        flex: 1;
        width: 100%;
        box-sizing: border-box;
      }

      .task-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .task-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        color: #64748b;
        font-size: 0.9rem;
        font-weight: bold;
        text-transform: uppercase;
      }

      .task-q {
        font-size: 1.15rem;
        margin-bottom: 15px;
      }

      .input-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .hw-input {
        padding: 12px;
        border: 2px solid var(--border);
        border-radius: 8px;
        font-size: 1rem;
        width: 100%;
        box-sizing: border-box;
        transition: 0.2s;
      }
      .hw-input:focus {
        border-color: var(--primary);
        outline: none;
      }

      /* –°—Ç–∏–ª—ñ –¥–ª—è —Ä–µ–∂–∏–º—É –í—á–∏—Ç–µ–ª—è */
      .teacher-feedback {
        margin-top: 10px;
        padding: 10px;
        border-radius: 8px;
        font-size: 0.95rem;
        display: none; /* –•–æ–≤–∞—î–º–æ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º */
      }
      .hw-input.t-correct {
        border-color: var(--success);
        background: #f0fdf4;
        color: var(--success);
      }
      .hw-input.t-wrong {
        border-color: var(--error);
        background: #fef2f2;
        color: var(--error);
      }
      .teacher-feedback.show-correct {
        display: block;
        color: var(--success);
        background: #dcfce7;
      }
      .teacher-feedback.show-wrong {
        display: block;
        color: var(--error);
        background: #fee2e2;
      }

      .btn-submit {
        display: block;
        width: 100%;
        padding: 15px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1.2rem;
        font-weight: bold;
        cursor: pointer;
        margin-bottom: 50px;
        transition: 0.2s;
      }
      .btn-submit:hover {
        background: var(--primary-hover);
      }

      /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(5px);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }
      .modal-card {
        background: white;
        padding: 30px;
        border-radius: 20px;
        text-align: center;
        max-width: 450px;
        width: 90%;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      }
      .result-link-box {
        background: #f1f5f9;
        padding: 10px;
        border-radius: 8px;
        word-break: break-all;
        font-family: monospace;
        font-size: 0.8rem;
        margin: 15px 0;
        border: 1px solid #cbd5e1;
        max-height: 100px;
        overflow-y: auto;
      }
      .btn-copy {
        background: #0f172a;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
        font-weight: bold;
      }
      .btn-copy:active {
        transform: scale(0.98);
      }

      /* –ë–ª–æ–∫ –æ—Ü—ñ–Ω–∫–∏ –¥–ª—è –≤—á–∏—Ç–µ–ª—è */
      .teacher-score-panel {
        display: none;
        background: #fff7ed;
        border: 2px solid var(--primary);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        text-align: center;
      }
      .score-big {
        font-size: 2.5rem;
        font-weight: 900;
        color: var(--primary);
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-title">üìù –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ —Ä–æ–±–æ—Ç–∞</div>
      <div id="mode-badge" class="mode-badge mode-student">–£—á–µ–Ω—å</div>
    </header>

    <div class="container">
      <div id="teacher-panel" class="teacher-score-panel">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç —É—á–Ω—è:</h2>
        <div class="score-big"><span id="final-score">0</span> / 12</div>
        <p>–ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∏–∂—á–µ üëá</p>
      </div>

      <div id="tasks-container"></div>

      <button id="finish-btn" class="btn-submit" onclick="finishTest()">
        –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —ñ –∑–¥–∞—Ç–∏ —Ä–æ–±–æ—Ç—É
      </button>
    </div>

    <div id="share-modal" class="modal-overlay">
      <div class="modal-card">
        <div style="font-size: 3rem; margin-bottom: 10px">‚úÖ</div>
        <h2>–†–æ–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
        <p>
          –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ. –°–∫–æ–ø—ñ—é–π –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∏–∂—á–µ —Ç–∞ –Ω–∞–¥—ñ—à–ª–∏ –π–æ–≥–æ –≤—á–∏—Ç–µ–ª—é:
        </p>

        <div class="result-link-box" id="result-link">...</div>

        <button class="btn-copy" onclick="copyLink()">
          üìã –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
        </button>
        <p style="font-size: 0.8rem; color: #64748b; margin-top: 15px">
          –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É –º–æ–∂–Ω–∞ –∑–∞–∫—Ä–∏—Ç–∏.
        </p>
      </div>
    </div>

    <script>
      /* --- –ë–ê–ó–ê –ó–ê–í–î–ê–ù–¨ (12 —à—Ç) --- */
      const tasks = [
        {
          id: 1,
          q: "–ß–∏ —î —á–∏—Å–ª–æ 4 –∫–æ—Ä–µ–Ω–µ–º —Ä—ñ–≤–Ω—è–Ω–Ω—è $3x - 2 = 10$?",
          a: ["—Ç–∞–∫", "–¢–∞–∫"],
        },
        {
          id: 2,
          q: "–ß–∏ —î —á–∏—Å–ª–æ 2 –∫–æ—Ä–µ–Ω–µ–º —Ä—ñ–≤–Ω—è–Ω–Ω—è $x + 20 = 25$?",
          a: ["–Ω—ñ", "–ù—ñ"],
        },
        { id: 3, q: "–†–æ–∑–≤'—è–∂—ñ—Ç—å —Ä—ñ–≤–Ω—è–Ω–Ω—è: $y + 240 = 560$", a: ["320"] },
        { id: 4, q: "–ó–Ω–∞–π–¥—ñ—Ç—å –∫–æ—Ä—ñ–Ω—å: $800 - x = 350$", a: ["450"] },
        { id: 5, q: "–†–æ–∑–≤'—è–∂—ñ—Ç—å: $(x + 40) - 30 = 90$", a: ["80"] },
        { id: 6, q: "–ó–Ω–∞–π–¥—ñ—Ç—å –∫–æ—Ä—ñ–Ω—å: $400 - (x - 50) = 200$", a: ["250"] },
        {
          id: 7,
          q: "–Ø–∫–µ —á–∏—Å–ª–æ $a$ —Ç—Ä–µ–±–∞ –ø—ñ–¥—Å—Ç–∞–≤–∏—Ç–∏, —â–æ–± –∫–æ—Ä–µ–Ω–µ–º —Ä—ñ–≤–Ω—è–Ω–Ω—è $(x + a) - 10 = 50$ –±—É–ª–æ —á–∏—Å–ª–æ 20?",
          a: ["40"],
        },
        {
          id: 8,
          q: "–ó–Ω–∞–π–¥—ñ—Ç—å $a$, —è–∫—â–æ –∫–æ—Ä–µ–Ω–µ–º —Ä—ñ–≤–Ω—è–Ω–Ω—è $(a - x) + 5 = 25$ —î —á–∏—Å–ª–æ 5.",
          a: ["25"],
        },
        { id: 9, q: "–†–æ–∑–≤'—è–∂—ñ—Ç—å —Ä—ñ–≤–Ω—è–Ω–Ω—è: $5x = 2x + 15$", a: ["5"] },
        { id: 10, q: "–ó–Ω–∞–π–¥—ñ—Ç—å –∫–æ—Ä—ñ–Ω—å: $10x - 4 = 8x$", a: ["2"] },
        { id: 11, q: "–†–æ–∑–≤'—è–∂—ñ—Ç—å: $-2 + 5x = 3x + 8$", a: ["5"] },
        { id: 12, q: "–ó–Ω–∞–π–¥—ñ—Ç—å –∫–æ—Ä—ñ–Ω—å: $20 - 4x = x + 5$", a: ["3"] },
      ];

      const container = document.getElementById("tasks-container");

      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
      document.addEventListener("DOMContentLoaded", () => {
        // –†–µ–Ω–¥–µ—Ä–∏–º–æ –∑–∞–≤–¥–∞–Ω–Ω—è
        tasks.forEach((task, index) => {
          const card = document.createElement("div");
          card.className = "task-card";
          card.innerHTML = `
            <div class="task-header">–ó–∞–≤–¥–∞–Ω–Ω—è ‚Ññ${index + 1}</div>
            <div class="task-q">${task.q}</div>
            <div class="input-group">
              <input type="text" class="hw-input" id="inp-${index}" placeholder="–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å...">
              <div class="teacher-feedback" id="feed-${index}"></div>
            </div>
          `;
          container.appendChild(card);
        });

        // –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ KaTeX
        renderMathInElement(document.body, {
          delimiters: [{ left: "$", right: "$", display: false }],
        });

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –º–∏ –≤ —Ä–µ–∂–∏–º—ñ –≤—á–∏—Ç–µ–ª—è (—á–∏ —î –¥–∞–Ω—ñ –≤ URL)
        checkMode();
      });

      // --- –õ–û–ì–Ü–ö–ê –°–¢–£–î–ï–ù–¢–ê ---

      function finishTest() {
        const answers = [];
        let filledCount = 0;

        tasks.forEach((_, index) => {
          const val = document.getElementById(`inp-${index}`).value.trim();
          answers.push(val);
          if (val) filledCount++;
        });

        if (filledCount < tasks.length) {
          if (!confirm("–¢–∏ –≤—ñ–¥–ø–æ–≤—ñ–≤ –Ω–µ –Ω–∞ –≤—Å—ñ –ø–∏—Ç–∞–Ω–Ω—è. –í—Å–µ –æ–¥–Ω–æ –∑–¥–∞—Ç–∏ —Ä–æ–±–æ—Ç—É?"))
            return;
        }

        // –ì–µ–Ω–µ—Ä—É—î–º–æ "—Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–æ–¥" –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
        const data = {
          t: Date.now(), // —á–∞—Å –∑–¥–∞—á—ñ
          ans: answers,
        };

        // –®–∏—Ñ—Ä—É—î–º–æ –≤ Base64 (—â–æ–± –Ω–µ –±—É–ª–æ –≤–∏–¥–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫ –≤ URL)
        // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ encodeURIComponent –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∫–∏—Ä–∏–ª–∏—Ü—ñ
        const encoded = btoa(
          unescape(encodeURIComponent(JSON.stringify(data)))
        );

        // –°—Ç–≤–æ—Ä—é—î–º–æ –ø–æ–≤–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
        const fullLink =
          window.location.href.split("?")[0] + "?result=" + encoded;

        document.getElementById("result-link").innerText = fullLink;
        document.getElementById("share-modal").style.display = "flex";
      }

      function copyLink() {
        const text = document.getElementById("result-link").innerText;
        navigator.clipboard.writeText(text).then(() => {
          alert("–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ! –ù–∞–¥—ñ—à–ª–∏ –π–æ–≥–æ –≤—á–∏—Ç–µ–ª—é.");
        });
      }

      // --- –õ–û–ì–Ü–ö–ê –í–ß–ò–¢–ï–õ–Ø ---

      function checkMode() {
        const urlParams = new URLSearchParams(window.location.search);
        const resultParam = urlParams.get("result");

        if (resultParam) {
          enableTeacherMode(resultParam);
        }
      }

      function enableTeacherMode(encodedData) {
        try {
          // –î–µ–∫–æ–¥—É—î–º–æ –¥–∞–Ω—ñ
          const jsonString = decodeURIComponent(escape(atob(encodedData)));
          const data = JSON.parse(jsonString);
          const studentAnswers = data.ans;

          // –ó–º—ñ–Ω—é—î–º–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
          document.getElementById("mode-badge").className =
            "mode-badge mode-teacher";
          document.getElementById("mode-badge").innerText = "–†–µ–∂–∏–º –í—á–∏—Ç–µ–ª—è";
          document.getElementById("finish-btn").style.display = "none";
          document.getElementById("teacher-panel").style.display = "block";

          let score = 0;

          // –ü—Ä–æ—Ö–æ–¥–∏–º–æ –ø–æ –≤—Å—ñ—Ö –∑–∞–≤–¥–∞–Ω–Ω—è—Ö —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ
          tasks.forEach((task, index) => {
            const inp = document.getElementById(`inp-${index}`);
            const feed = document.getElementById(`feed-${index}`);

            const studentVal = studentAnswers[index] || "";
            // –ó–∞–º—ñ–Ω–∞ –∫–æ–º–∏ –Ω–∞ –∫—Ä–∞–ø–∫—É –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
            const normalizedVal = studentVal.replace(",", ".");

            inp.value = studentVal; // –ü–æ–∫–∞–∑—É—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å —É—á–Ω—è
            inp.disabled = true; // –ë–ª–æ–∫—É—î–º–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è

            if (task.a.includes(normalizedVal)) {
              // –ü—Ä–∞–≤–∏–ª—å–Ω–æ
              inp.classList.add("t-correct");
              feed.className = "teacher-feedback show-correct";
              feed.innerHTML = "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!";
              score++;
            } else {
              // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
              inp.classList.add("t-wrong");
              feed.className = "teacher-feedback show-wrong";
              feed.innerHTML = `‚ùå –ü–æ–º–∏–ª–∫–∞. –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: <strong>${task.a[0]}</strong>`;
            }
          });

          // –í–∏–≤–æ–¥–∏–º–æ –∑–∞–≥–∞–ª—å–Ω–∏–π –±–∞–ª
          document.getElementById("final-score").innerText = score;
        } catch (e) {
          alert("–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤. –ú–æ–∂–ª–∏–≤–æ, –ø–æ—Å–∏–ª–∞–Ω–Ω—è –ø–æ—à–∫–æ–¥–∂–µ–Ω–µ.");
          console.error(e);
        }
      }
    </script>
  </body>
</html>
