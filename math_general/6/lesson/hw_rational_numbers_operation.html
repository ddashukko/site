<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–î–ó: –†–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ —á–∏—Å–ª–∞ (–í–ø—Ä–∞–≤–∏ 1-8)</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    ></script>

    <style>
      :root {
        --primary: #4f46e5;
        --primary-light: #eef2ff;
        --success: #16a34a;
        --error: #dc2626;
        --bg: #f8fafc;
        --card: #ffffff;
        --text: #1e293b;
        --border: #e2e8f0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: var(--bg);
        color: var(--text);
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        overflow: hidden;
      }

      /* Layout */
      #tasks-section {
        flex: 1;
        overflow-y: auto;
        padding-bottom: 100px;
      }

      #board-section {
        flex: 1;
        position: relative;
        background-color: #fff;
        border-left: 4px solid #cbd5e1;
        background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
        background-size: 20px 20px;
        cursor: crosshair;
      }

      @media (max-width: 768px) {
        body {
          flex-direction: column;
        }
        #board-section {
          height: 35vh;
          order: 2;
          border-left: none;
          border-top: 4px solid #cbd5e1;
        }
        #tasks-section {
          height: 65vh;
          order: 1;
        }
      }

      /* Components */
      header {
        background: var(--card);
        padding: 15px 20px;
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .header-title {
        font-weight: 800;
        font-size: 1.2rem;
        color: var(--primary);
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }

      .student-name-block {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        border: 2px solid var(--primary);
        margin-bottom: 30px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      .student-name-input {
        width: 100%;
        padding: 10px;
        font-size: 1.1rem;
        border: 1px solid #cbd5e1;
        border-radius: 6px;
        margin-top: 10px;
        box-sizing: border-box;
      }

      .exercise-block {
        background: var(--card);
        border-radius: 12px;
        border: 1px solid var(--border);
        margin-bottom: 25px;
        overflow: hidden;
      }
      .exercise-header {
        background: var(--primary-light);
        padding: 12px 20px;
        border-bottom: 1px solid var(--border);
        font-weight: 700;
        color: var(--primary);
      }
      .task-row {
        padding: 15px 20px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
      }
      .task-row:last-child {
        border-bottom: none;
      }
      .task-q {
        font-size: 1.1rem;
        font-weight: 500;
      }
      .input-answer {
        padding: 8px 12px;
        border: 1px solid #94a3b8;
        border-radius: 6px;
        width: 120px;
        font-size: 1rem;
        text-align: center;
        transition: 0.2s;
      }
      .input-answer:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
      }

      /* Teacher / Grading Styles */
      .input-answer.correct {
        background-color: #dcfce7;
        border-color: var(--success);
        color: var(--success);
        font-weight: bold;
      }
      .input-answer.wrong {
        background-color: #fee2e2;
        border-color: var(--error);
        color: var(--error);
        text-decoration: line-through;
      }
      .correct-ans-hint {
        display: none;
        color: var(--success);
        font-weight: bold;
        font-size: 0.9rem;
        margin-left: 10px;
      }
      .show-hint .correct-ans-hint {
        display: inline-block;
      }

      /* Footer Buttons */
      .action-area {
        margin-top: 40px;
        text-align: center;
        padding: 20px;
        background: #f1f5f9;
        border-radius: 15px;
      }
      .btn-main {
        background: var(--primary);
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 1.1rem;
        font-weight: bold;
        border-radius: 8px;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(79, 70, 229, 0.3);
        transition: transform 0.1s;
      }
      .btn-main:hover {
        transform: scale(1.02);
        background: #4338ca;
      }
      .btn-teacher {
        background: #334155;
        margin-top: 10px;
        font-size: 0.9rem;
        padding: 10px 20px;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        align-items: center;
        justify-content: center;
      }
      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 500px;
        width: 90%;
        text-align: center;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }
      .link-box {
        width: 100%;
        padding: 10px;
        margin: 15px 0;
        border: 1px solid #cbd5e1;
        border-radius: 5px;
        background: #f8fafc;
        font-family: monospace;
        word-break: break-all;
        min-height: 60px;
      }

      /* Canvas Tools */
      .tools {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(255, 255, 255, 0.9);
        padding: 5px;
        border-radius: 8px;
        border: 1px solid #cbd5e1;
        display: flex;
        gap: 5px;
      }
      .tool-btn {
        background: white;
        border: 1px solid #cbd5e1;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 4px;
        font-size: 1.2rem;
      }
      .tool-btn.active {
        background: var(--primary);
        color: white;
      }

      /* Score Card */
      #score-card {
        display: none;
        background: #fff;
        padding: 15px;
        margin-bottom: 20px;
        border-left: 5px solid var(--primary);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body>
    <div id="tasks-section">
      <header>
        <div class="header-title">–î–æ–º–∞—à–Ω—è —Ä–æ–±–æ—Ç–∞: –†–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ —á–∏—Å–ª–∞</div>
      </header>

      <div class="container">
        <div class="student-name-block">
          <label style="font-weight: 600; color: #475569"
            >–ü—Ä—ñ–∑–≤–∏—â–µ —Ç–∞ –Ü–º'—è —É—á–Ω—è:</label
          >
          <input
            type="text"
            id="student-name"
            class="student-name-input"
            placeholder="–í–≤–µ–¥–∏ —Å–≤–æ—î —ñ–º'—è —Ç—É—Ç..."
          />
        </div>

        <div id="score-card">
          <h2 style="margin: 0; color: var(--text)">
            –†–µ–∑—É–ª—å—Ç–∞—Ç: <span id="score-val" style="color: var(--primary)"></span>
          </h2>
        </div>

        <div id="exercises-container"></div>

        <div class="action-area" id="student-actions">
          <p style="color: #64748b; margin-bottom: 20px">
            –ü–µ—Ä–µ–≤—ñ—Ä –≤—Å—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø–µ—Ä–µ–¥ –≤—ñ–¥–ø—Ä–∞–≤–∫–æ—é. –ù–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ, —â–æ–±
            —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –≤—á–∏—Ç–µ–ª—è.
          </p>
          <button class="btn-main" onclick="generateTeacherLink()">
            üì§ –°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –≤—á–∏—Ç–µ–ª—è
          </button>
        </div>

        <div
          class="action-area"
          id="teacher-actions"
          style="display: none; background: #e0e7ff"
        >
          <h3 style="margin-top: 0">–†–µ–∂–∏–º –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏</h3>
          <p>–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –¥–æ—Å—Ç—É–ø—É –≤—á–∏—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ü—ñ—î—ó —Ä–æ–±–æ—Ç–∏.</p>
          <button class="btn-main btn-teacher" onclick="teacherLogin()">
            üîê –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–±–æ—Ç—É
          </button>
        </div>
      </div>
    </div>

    <div id="board-section">
      <div class="tools">
        <button class="tool-btn active" onclick="setTool('pen')" id="t-pen">
          üñäÔ∏è
        </button>
        <button class="tool-btn" onclick="setTool('eraser')" id="t-eraser">
          üßπ
        </button>
        <button
          class="tool-btn"
          onclick="clearBoard()"
          style="color: red"
          title="–û—á–∏—Å—Ç–∏—Ç–∏"
        >
          ‚ùå
        </button>
      </div>
      <canvas id="board"></canvas>
    </div>

    <div id="link-modal" class="modal">
      <div class="modal-content">
        <h3 style="margin-top: 0">–ì–æ—Ç–æ–≤–æ!</h3>
        <p>
          –°–∫–æ–ø—ñ—é–π —Ü–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —Ç–∞ –Ω–∞–¥—ñ—à–ª–∏ –π–æ–≥–æ –≤—á–∏—Ç–µ–ª—é (Viber, Telegram,
          Instagram):
        </p>
        <textarea id="result-link" class="link-box" readonly></textarea>
        <button
          class="btn-main"
          style="background: #16a34a"
          onclick="copyLink()"
        >
          –ö–æ–ø—ñ—é–≤–∞—Ç–∏
        </button>
        <button
          class="btn-main"
          style="background: #94a3b8; margin-top: 10px"
          onclick="document.getElementById('link-modal').style.display='none'"
        >
          –ó–∞–∫—Ä–∏—Ç–∏
        </button>
      </div>
    </div>

    <script>
      /* --- –î–ê–ù–Ü –í–ü–†–ê–í (–ù–æ–≤—ñ —á–∏—Å–ª–∞) --- */
      const exercises = [
        {
          title: "–í–ø—Ä–∞–≤–∞ 1. –û–¥–Ω–∞–∫–æ–≤—ñ –∑–Ω–∞–∫–∏",
          tasks: [
            { id: "1.1", q: "$-8 + (-12)$", a: "-20" },
            { id: "1.2", q: "$-25 - 15$", a: "-40" },
            { id: "1.3", q: "$-4 + (-16)$", a: "-20" },
            { id: "1.4", q: "$-120 - 30$", a: "-150" },
            { id: "1.5", q: "$-7 + (-13)$", a: "-20" },
          ],
        },
        {
          title: "–í–ø—Ä–∞–≤–∞ 2. –†—ñ–∑–Ω—ñ –∑–Ω–∞–∫–∏",
          tasks: [
            { id: "2.1", q: "$-20 + 35$", a: "15" },
            { id: "2.2", q: "$14 - 20$", a: "-6" },
            { id: "2.3", q: "$-50 + 20$", a: "-30" },
            { id: "2.4", q: "$8 - 18$", a: "-10" },
            { id: "2.5", q: "$-9 + 9$", a: "0" },
          ],
        },
        {
          title: "–í–ø—Ä–∞–≤–∞ 3. –î–µ—Å—è—Ç–∫–æ–≤—ñ –¥—Ä–æ–±–∏",
          tasks: [
            { id: "3.1", q: "$-3,5 - 2,5$", a: "-6|-6.0" },
            { id: "3.2", q: "$-1,2 + 3,2$", a: "2|2.0" },
            { id: "3.3", q: "$5,4 - 8,4$", a: "-3|-3.0" },
            { id: "3.4", q: "$-0,5 + (-0,5)$", a: "-1|-1.0" },
            { id: "3.5", q: "$-10,5 + 0,5$", a: "-10" },
          ],
        },
        {
          title: "–í–ø—Ä–∞–≤–∞ 4. –†–æ–∑–∫—Ä–∏—Ç—Ç—è –¥—É–∂–æ–∫",
          tasks: [
            { id: "4.1", q: "$12 - (-8)$", a: "20" },
            { id: "4.2", q: "$-6 - (-6)$", a: "0" },
            { id: "4.3", q: "$0 - (-15)$", a: "15" },
            { id: "4.4", q: "$-24 - (-4)$", a: "-20" },
            { id: "4.5", q: "$3,5 - (-1,5)$", a: "5" },
          ],
        },
        {
          title: "–í–ø—Ä–∞–≤–∞ 5. –î—Ä–æ–±–∏ (–æ–¥–Ω–∞–∫–æ–≤—ñ –∑–Ω–∞–º–µ–Ω–Ω–∏–∫–∏)",
          tasks: [
            { id: "5.1", q: "$-\\frac{2}{9} + (-\\frac{4}{9})$", a: "-6/9|-2/3" },
            { id: "5.2", q: "$\\frac{3}{11} - \\frac{8}{11}$", a: "-5/11" },
            { id: "5.3", q: "$-\\frac{1}{7} + \\frac{5}{7}$", a: "4/7" },
            { id: "5.4", q: "$-\\frac{7}{10} - (-\\frac{3}{10})$", a: "-4/10|-2/5|-0.4" },
            { id: "5.5", q: "$-\\frac{13}{25} - \\frac{12}{25}$", a: "-1" },
          ],
        },
        {
          title: "–í–ø—Ä–∞–≤–∞ 6. –î—Ä–æ–±–∏ (—Ä—ñ–∑–Ω—ñ –∑–Ω–∞–º–µ–Ω–Ω–∏–∫–∏)",
          tasks: [
            { id: "6.1", q: "$-\\frac{1}{2} + \\frac{1}{4}$", a: "-1/4|-0.25" },
            { id: "6.2", q: "$-\\frac{1}{3} - \\frac{1}{6}$", a: "-3/6|-1/2|-0.5" },
            { id: "6.3", q: "$\\frac{1}{5} - \\frac{1}{2}$", a: "-3/10|-0.3" },
            { id: "6.4", q: "$-\\frac{5}{6} + (-\\frac{1}{12})$", a: "-11/12" },
            { id: "6.5", q: "$-\\frac{3}{8} - (-\\frac{1}{4})$", a: "-1/8|-0.125" },
          ],
        },
        {
          title: "–í–ø—Ä–∞–≤–∞ 7. –ú—ñ—à–∞–Ω—ñ —á–∏—Å–ª–∞",
          tasks: [
            { id: "7.1", q: "$-1\\frac{1}{5} - 2\\frac{2}{5}$", a: "-3 3/5|-18/5|-3.6" },
            { id: "7.2", q: "$-2\\frac{1}{2} + 4\\frac{1}{2}$", a: "2" },
            { id: "7.3", q: "$3\\frac{1}{4} - 5\\frac{3}{4}$", a: "-2 2/4|-2.5|-2 1/2" },
            { id: "7.4", q: "$-5\\frac{1}{9} + 3\\frac{4}{9}$", a: "-1 6/9|-1 2/3" },
            { id: "7.5", q: "$-2\\frac{5}{6} - (-1\\frac{1}{6})$", a: "-1 4/6|-1 2/3" },
          ],
        },
        {
          title: "–í–ø—Ä–∞–≤–∞ 8. –ú—ñ–∫—Å",
          tasks: [
            { id: "8.1", q: "$-0,25 + \\frac{3}{4}$", a: "0.5|1/2" },
            { id: "8.2", q: "$-\\frac{1}{2} - 0,5$", a: "-1" },
            { id: "8.3", q: "$1,5 - \\frac{1}{2}$", a: "1" },
            { id: "8.4", q: "$-3\\frac{1}{2} + 0,5$", a: "-3" },
            { id: "8.5", q: "$-0,4 + (-\\frac{2}{5})$", a: "-0.8|-4/5" },
          ],
        },
      ];

      // --- –ì–ï–ù–ï–†–ê–¶–Ü–Ø HTML ---
      const container = document.getElementById("exercises-container");
      exercises.forEach((ex) => {
        const block = document.createElement("div");
        block.className = "exercise-block";
        block.innerHTML = `<div class="exercise-header">${ex.title}</div>`;

        ex.tasks.forEach((t) => {
          const row = document.createElement("div");
          row.className = "task-row";
          // data-id —ñ data-answers –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤—á–∏—Ç–µ–ª–µ–º
          row.innerHTML = `
            <div class="task-q"><span style="color:#94a3b8; margin-right:8px;">${t.id})</span> ${t.q}</div>
            <div style="display:flex; align-items:center;">
                <input type="text" class="input-answer" data-qid="${t.id}" placeholder="?">
                <span class="correct-ans-hint" id="hint-${t.id.replace('.','-')}">‚úÖ ${t.a.split('|')[0]}</span>
            </div>
          `;
          block.appendChild(row);
        });
        container.appendChild(block);
      });

      // –†–µ–Ω–¥–µ—Ä —Ñ–æ—Ä–º—É–ª
      document.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
          delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "$", right: "$", display: false },
          ],
        });
        checkUrlForData();
      });

      // --- –õ–û–ì–Ü–ö–ê: –£–ß–ï–ù–¨ ---
      function generateTeacherLink() {
        const name = document.getElementById("student-name").value.trim();
        if (!name) {
          alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–ø–∏—à–∏ —Å–≤–æ—î –Ü–º'—è —Ç–∞ –ü—Ä—ñ–∑–≤–∏—â–µ –≤–≥–æ—Ä—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏!");
          document.getElementById("student-name").focus();
          return;
        }

        const answers = {};
        const inputs = document.querySelectorAll(".input-answer");
        inputs.forEach((inp) => {
          answers[inp.dataset.qid] = inp.value.trim();
        });

        const payload = {
          n: name, // Name
          a: answers, // Answers object
        };

        // –ö–æ–¥—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –≤ Base64 –¥–ª—è URL
        const jsonStr = JSON.stringify(payload);
        const encoded = btoa(encodeURIComponent(jsonStr));

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è URL
        const url = window.location.href.split("?")[0] + "?d=" + encoded;

        document.getElementById("result-link").value = url;
        document.getElementById("link-modal").style.display = "flex";
      }

      function copyLink() {
        const copyText = document.getElementById("result-link");
        copyText.select();
        document.execCommand("copy");
        alert("–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ! –ù–∞–¥—ñ—à–ª–∏ –π–æ–≥–æ –≤—á–∏—Ç–µ–ª—é.");
      }

      // --- –õ–û–ì–Ü–ö–ê: –í–ß–ò–¢–ï–õ–¨ ---
      let studentData = null;

      function checkUrlForData() {
        const params = new URLSearchParams(window.location.search);
        const data = params.get("d");

        if (data) {
          try {
            const jsonStr = decodeURIComponent(atob(data));
            studentData = JSON.parse(jsonStr);

            // –†–µ–∂–∏–º –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ
            document.getElementById("student-actions").style.display = "none";
            document.getElementById("teacher-actions").style.display = "block";
            
            // –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ –¥–∞–Ω–∏–º–∏ —É—á–Ω—è
            document.getElementById("student-name").value = studentData.n;
            document.getElementById("student-name").disabled = true;

            const inputs = document.querySelectorAll(".input-answer");
            inputs.forEach(inp => {
                const val = studentData.a[inp.dataset.qid];
                if(val) inp.value = val;
                inp.disabled = true; // –ë–ª–æ–∫—É—î–º–æ –∑–º—ñ–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
            });

          } catch (e) {
            console.error("Error parsing data", e);
          }
        }
      }

      function teacherLogin() {
        const pass = prompt("–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –≤—á–∏—Ç–µ–ª—è:");
        if (pass && pass.trim().toLowerCase() === "—è–Ω—á—É–∫") {
            gradeWork();
        } else {
            alert("–ù–µ–≤—ñ—Ä–Ω–∏–π –∫–æ–¥!");
        }
      }

      function gradeWork() {
        let correctCount = 0;
        let totalCount = 0;

        // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –ø–∞–Ω–µ–ª—å –≤—Ö–æ–¥—É, –ø–æ–∫–∞–∑—É—î–º–æ –∫–∞—Ä—Ç–∫—É –æ—Ü—ñ–Ω–∫–∏
        document.getElementById("teacher-actions").style.display = "none";
        document.getElementById("score-card").style.display = "block";

        // –ü—Ä–æ—Ö–æ–¥–∏–º–æ –ø–æ –≤—Å—ñ—Ö –≤–ø—Ä–∞–≤–∞—Ö –∑ "–±–∞–∑–∏ –¥–∞–Ω–∏—Ö"
        exercises.forEach(ex => {
            ex.tasks.forEach(task => {
                totalCount++;
                const input = document.querySelector(`input[data-qid="${task.id}"]`);
                const studentAns = input.value.replace(",", ".").replace(/\s+/g, "").replace(/\/\//g, "/"); // normalize
                
                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞
                const possibleAnswers = task.a.split("|");
                let isCorrect = false;
                
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —î –≤—ñ–¥–ø–æ–≤—ñ–¥—å —É—á–Ω—è —Å–µ—Ä–µ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤
                // –¢–∞–∫–æ–∂ —Å–ø—Ä–æ—â–µ–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–ª—è –¥—Ä–æ–±—ñ–≤ (—è–∫—â–æ —É—á–µ–Ω—å –Ω–µ —Å–∫–æ—Ä–æ—Ç–∏–≤, –∞–ª–µ —Ü–µ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∞–≤—Ç–æ–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç—É—Ç, 
                // –ø—Ä–æ—Ç–µ —É –Ω–∞—Å –∂–æ—Ä—Å—Ç–∫–µ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Å—Ç—Ä—ñ—á–æ–∫. –í–≤–∞–∂–∞—î–º–æ, —â–æ —Ñ–æ—Ä–º–∞—Ç –º–∞—î —Å–ø—ñ–≤–ø–∞–¥–∞—Ç–∏)
                if (possibleAnswers.includes(studentAns)) {
                    isCorrect = true;
                    correctCount++;
                    input.classList.add("correct");
                } else {
                    input.classList.add("wrong");
                    // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å
                    const hintId = `hint-${task.id.replace('.','-')}`;
                    const row = input.closest(".task-row");
                    row.classList.add("show-hint");
                }
            });
        });

        // –í–∏—Å–Ω–æ–≤–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        const scoreElem = document.getElementById("score-val");
        const percentage = Math.round((correctCount / totalCount) * 100);
        let grade = Math.round((correctCount / totalCount) * 12); // 12-–±–∞–ª—å–Ω–∞ —à–∫–∞–ª–∞
        if (grade === 0 && correctCount > 0) grade = 1;

        scoreElem.innerText = `${grade} –±–∞–ª—ñ–≤ (${correctCount} –∑ ${totalCount} –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö)`;
      }

      // --- CANVAS ---
      const canvas = document.getElementById("board");
      const ctx = canvas.getContext("2d");
      const boardSection = document.getElementById("board-section");
      let painting = false;
      let tool = "pen";

      function resizeCanvas() {
        const temp = document.createElement("canvas");
        const tCtx = temp.getContext("2d");
        temp.width = canvas.width;
        temp.height = canvas.height;
        if (canvas.width > 0) tCtx.drawImage(canvas, 0, 0);

        canvas.width = boardSection.offsetWidth;
        canvas.height = boardSection.offsetHeight;
        ctx.drawImage(temp, 0, 0);
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
      }
      window.addEventListener("resize", resizeCanvas);
      window.addEventListener("load", resizeCanvas);

      function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: clientX - rect.left, y: clientY - rect.top };
      }
      function startDraw(e) {
        painting = true;
        draw(e);
      }
      function endDraw() {
        painting = false;
        ctx.beginPath();
      }
      function draw(e) {
        if (!painting) return;
        // e.preventDefault(); // –ó–∞–≤–∞–∂–∞—î —Å–∫—Ä–æ–ª—É –Ω–∞ –º–æ–±—ñ–ª—å–Ω–æ–º—É, —è–∫—â–æ –º–∞–ª—é–≤–∞—Ç–∏. 
        // –ê–ª–µ –æ—Å–∫—ñ–ª—å–∫–∏ –∫–∞–Ω–≤–∞—Å –∑–±–æ–∫—É/–≤–Ω–∏–∑—É, –º–æ–∂–Ω–∞ –∑–∞–ª–∏—à–∏—Ç–∏ —Å–∫—Ä–æ–ª –Ω–∞ —Ä–µ—à—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏.
        
        const pos = getPos(e);
        if (tool === "pen") {
          ctx.lineWidth = 2;
          ctx.strokeStyle = "#4f46e5";
          ctx.globalCompositeOperation = "source-over";
        } else {
          ctx.lineWidth = 20;
          ctx.strokeStyle = "#ffffff";
          ctx.globalCompositeOperation = "destination-out";
        }

        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
      }

      canvas.addEventListener("mousedown", startDraw);
      canvas.addEventListener("mouseup", endDraw);
      canvas.addEventListener("mousemove", draw);
      
      // Touch events (passive false for preventDefault if needed later)
      canvas.addEventListener("touchstart", (e) => { 
          if(e.target === canvas) e.preventDefault(); 
          startDraw(e); 
      }, {passive: false});
      canvas.addEventListener("touchend", endDraw);
      canvas.addEventListener("touchmove", (e) => {
          if(e.target === canvas) e.preventDefault();
          draw(e);
      }, {passive: false});

      function setTool(t) {
        tool = t;
        document.querySelectorAll(".tool-btn").forEach(b => b.classList.remove("active"));
        if(t==='pen') document.getElementById("t-pen").classList.add("active");
        if(t==='eraser') document.getElementById("t-eraser").classList.add("active");
      }
      function clearBoard() {
        if(confirm("–û—á–∏—Å—Ç–∏—Ç–∏ –¥–æ—à–∫—É?")) ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    </script>
  </body>
</html>