<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–£—Ä–æ–∫: –¶–∏–ª—ñ–Ω–¥—Ä —Ç–∞ –ö–æ–Ω—É—Å</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: 'global' }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');
        
        body { 
            font-family: 'Nunito', sans-serif; 
            overflow: hidden; /* –ó–∞–±–æ—Ä–æ–Ω—è—î–º–æ —Å–∫—Ä–æ–ª –≤—Å—ñ—î—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ */
            background-color: #f3f4f6;
        }
        
        /* –ö–∞—Å—Ç–æ–º–Ω–∏–π —Å–∫—Ä–æ–ª */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #c7c7c7; border-radius: 4px; }
        
        /* –ê–Ω—ñ–º–∞—Ü—ñ—ó */
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .correct-anim { animation: pulseGreen 0.5s; border-color: #10B981 !important; background-color: #D1FAE5 !important; }
        @keyframes pulseGreen { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        .wrong-anim { animation: shakeRed 0.4s; border-color: #EF4444 !important; background-color: #FEE2E2 !important; }
        @keyframes shakeRed { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }

        /* –ö–∞–Ω–≤–∞—Å */
        #whiteboard { touch-action: none; /* –í–∞–∂–ª–∏–≤–æ –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è –ø–∞–ª—å—Ü–µ–º */ }
        
        /* –ú–æ–±—ñ–ª—å–Ω–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è: —Ö–æ–≤–∞—î–º–æ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø—ñ */
        .mobile-nav { display: flex; }
        @media (min-width: 768px) {
            .mobile-nav { display: none; }
            .desktop-split { display: flex !important; }
            #task-panel, #board-panel { display: flex !important; width: 50%; height: 100%; }
        }
    </style>
</head>
<body class="h-screen flex flex-col md:flex-row relative text-gray-800">

    <div id="task-panel" class="w-full md:w-1/2 h-full flex flex-col bg-white md:border-r-2 md:border-gray-200 shadow-xl z-10 pb-16 md:pb-0 transition-all duration-300">
        
        <div class="p-4 bg-indigo-600 text-white flex justify-between items-center shadow-md flex-shrink-0">
            <div>
                <h1 class="text-lg md:text-xl font-bold leading-tight">–¶–∏–ª—ñ–Ω–¥—Ä —Ç–∞ –ö–æ–Ω—É—Å</h1>
                <p class="text-xs md:text-sm opacity-90">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ 6 –∫–ª–∞—Å</p>
            </div>
            <div class="text-right">
                <div class="text-xs uppercase opacity-75">–†–∞—Ö—É–Ω–æ–∫</div>
                <div class="font-bold text-lg"><span id="score">0</span> / 30</div>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto p-4 md:p-6 custom-scroll bg-gray-50" id="content-area">
            
            <div class="mb-6 bg-white p-4 rounded-xl shadow-sm border border-blue-100">
                <h2 class="text-lg font-bold text-blue-800 mb-2">üëã –ü—Ä–∏–≤—ñ—Ç!</h2>
                <p class="text-sm text-gray-600 mb-3">
                    –£—Ä–æ–∫ –ø—Ä–æ —Ñ—ñ–≥—É—Ä–∏ –æ–±–µ—Ä—Ç–∞–Ω–Ω—è. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π $\pi \approx 3.14$.
                </p>
                <details class="bg-blue-50 p-3 rounded-lg cursor-pointer">
                    <summary class="font-bold text-indigo-600 text-sm select-none">üîë –§–æ—Ä–º—É–ª–∏ (–ù–∞—Ç–∏—Å–Ω–∏)</summary>
                    <div class="mt-2 text-gray-700 text-sm space-y-1">
                        <p>$C = 2\pi r$ (–¥–æ–≤–∂–∏–Ω–∞ –∫–æ–ª–∞)</p>
                        <p>$S = \pi r^2$ (–ø–ª–æ—â–∞ –∫—Ä—É–≥–∞)</p>
                        <p>$S_{–±—ñ—á} = 2\pi r h$</p>
                        <p>$S_{–ø–æ–≤–Ω–∞} = 2\pi r h + 2\pi r^2$</p>
                    </div>
                </details>
            </div>

            <div id="tasks-container" class="space-y-6 pb-4">
                </div>

            <div id="final-section" class="mt-8 text-center hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">–£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! üéâ</h2>
                <div id="final-score-display" class="text-lg mb-4"></div>
                <p id="final-praise" class="text-indigo-600 font-semibold italic mb-6"></p>
                <button onclick="location.reload()" class="bg-indigo-600 text-white px-8 py-3 rounded-full shadow-lg hover:bg-indigo-700">–ü–æ—á–∞—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É</button>
            </div>
            
            <div class="h-12 md:h-20"></div> </div>

        <div class="p-3 bg-white border-t hidden md:flex justify-between items-center">
            <span class="text-xs text-gray-500">–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –¥–æ—à–∫—É –ø—Ä–∞–≤–æ—Ä—É—á üëâ</span>
            <button onclick="finishLesson()" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700 text-sm">
                –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —É—Ä–æ–∫
            </button>
        </div>
    </div>

    <div id="board-panel" class="hidden md:flex w-full md:w-1/2 h-full bg-white relative flex-col pb-16 md:pb-0">
        
        <div class="absolute top-2 left-2 right-2 bg-white/95 backdrop-blur rounded-xl shadow border border-gray-200 p-2 flex gap-2 justify-center items-center z-20 flex-wrap">
            <button onclick="setTool('pen')" class="p-2 rounded bg-gray-100 hover:bg-gray-200 active:bg-blue-100 transition" title="–û–ª—ñ–≤–µ—Ü—å">‚úèÔ∏è</button>
            <button onclick="setTool('eraser')" class="p-2 rounded hover:bg-gray-100 transition" title="–ì—É–º–∫–∞">üßπ</button>
            <div class="w-px h-6 bg-gray-300 mx-1"></div>
            <button onclick="drawGrid()" class="px-2 py-1 rounded hover:bg-gray-100 text-xs font-bold text-gray-600"># –°—ñ—Ç–∫–∞</button>
            <button onclick="insertShape('cylinder')" class="px-2 py-1 rounded hover:bg-gray-100 text-xs font-bold text-gray-600">üõ¢ –¶–∏–ª—ñ–Ω–¥—Ä</button>
            <button onclick="insertShape('cone')" class="px-2 py-1 rounded hover:bg-gray-100 text-xs font-bold text-gray-600">A –ö–æ–Ω—É—Å</button>
            <div class="w-px h-6 bg-gray-300 mx-1"></div>
            <button onclick="clearCanvas()" class="p-2 text-red-500 hover:text-red-700 font-bold text-xs">‚ùå</button>
            <input type="color" id="colorPicker" value="#2563eb" class="w-6 h-6 rounded cursor-pointer border-0 p-0 ml-1">
        </div>

        <canvas id="whiteboard" class="w-full h-full block bg-white cursor-crosshair"></canvas>
    </div>

    <div class="mobile-nav fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 shadow-lg z-50 h-16 justify-around items-center">
        <button onclick="switchTab('tasks')" id="btn-tasks" class="flex flex-col items-center justify-center w-1/2 h-full text-indigo-600 bg-indigo-50 border-t-2 border-indigo-600 transition-colors">
            <span class="text-xl">üìù</span>
            <span class="text-xs font-bold">–ó–∞–≤–¥–∞–Ω–Ω—è</span>
        </button>
        <button onclick="switchTab('board')" id="btn-board" class="flex flex-col items-center justify-center w-1/2 h-full text-gray-500 transition-colors">
            <span class="text-xl">üé®</span>
            <span class="text-xs font-bold">–î–æ—à–∫–∞</span>
        </button>
    </div>

    <button onclick="finishLesson()" class="md:hidden fixed bottom-20 right-4 bg-green-500 text-white rounded-full p-3 shadow-lg z-40 opacity-90 hover:opacity-100" title="–ó–∞–≤–µ—Ä—à–∏—Ç–∏">
        üèÅ
    </button>

    <script>
        // --- MOBILE TABS LOGIC ---
        let currentTab = 'tasks';

        function switchTab(tab) {
            const taskPanel = document.getElementById('task-panel');
            const boardPanel = document.getElementById('board-panel');
            const btnTasks = document.getElementById('btn-tasks');
            const btnBoard = document.getElementById('btn-board');

            // –Ø–∫—â–æ —à–∏—Ä–∏–Ω–∞ –µ–∫—Ä–∞–Ω—É –≤–µ–ª–∏–∫–∞ (desktop), —Ñ—É–Ω–∫—Ü—ñ—è –Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏—Ç—å –∞–±–æ –ø—Ä–æ—Å—Ç–æ —ñ–≥–Ω–æ—Ä—É—î—Ç—å—Å—è css
            if (window.innerWidth >= 768) return;

            if (tab === 'tasks') {
                taskPanel.classList.remove('hidden');
                taskPanel.classList.add('flex');
                boardPanel.classList.add('hidden');
                boardPanel.classList.remove('flex');
                
                // Styles for active button
                btnTasks.classList.add('text-indigo-600', 'bg-indigo-50', 'border-t-2', 'border-indigo-600');
                btnTasks.classList.remove('text-gray-500');
                btnBoard.classList.remove('text-indigo-600', 'bg-indigo-50', 'border-t-2', 'border-indigo-600');
                btnBoard.classList.add('text-gray-500');
            } else {
                taskPanel.classList.add('hidden');
                taskPanel.classList.remove('flex');
                boardPanel.classList.remove('hidden');
                boardPanel.classList.add('flex');
                
                // Resize canvas because it was hidden
                resizeCanvas();

                // Styles for active button
                btnBoard.classList.add('text-indigo-600', 'bg-indigo-50', 'border-t-2', 'border-indigo-600');
                btnBoard.classList.remove('text-gray-500');
                btnTasks.classList.remove('text-indigo-600', 'bg-indigo-50', 'border-t-2', 'border-indigo-600');
                btnTasks.classList.add('text-gray-500');
            }
            currentTab = tab;
        }

        // --- DATA: TASKS ---
        const tasks = [
            { id: 838, text: "–ó–Ω–∞–π–¥—ñ—Ç—å $S_{–±—ñ—á}$ —Ü–∏–ª—ñ–Ω–¥—Ä–∞: $r=3$ —Å–º, $h=4$ —Å–º. ($\pi \approx 3.14$)", hint: "$S = 2\pi r h$", solution: "$6.28 \\cdot 12 = 75.36$", answer: 75.36 },
            { id: 839, text: "–ü–ª–æ—â–∞ —Å–º—É–∂–∫–∏ –Ω–∞–≤–∫–æ–ª–æ –±–∞–Ω–∫–∏ ($r=5, h=3.5$).", hint: "–¶–µ –±—ñ—á–Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω—è.", solution: "$109.9$", answer: 109.9 },
            { id: 840, text: "–ü–ª–æ—â–∞ –ø–æ–≤–Ω–æ—ó –ø–æ–≤–µ—Ä—Ö–Ω—ñ —Ü–∏–ª—ñ–Ω–¥—Ä–∞ ($r=1, h=2$).", hint: "$S_{–±—ñ—á} + 2S_{–æ—Å–Ω}$", solution: "$12.56 + 6.28 = 18.84$", answer: 18.84 },
            { id: 841, text: "–ü–ª–æ—â–∞ –ø–æ–≤–Ω–æ—ó –ø–æ–≤–µ—Ä—Ö–Ω—ñ ($r=2, h=3$).", hint: "$2\\pi r(h+r)$", solution: "62.8", answer: 62.8 },
            { id: 842, text: "–ï–∫–≤–∞—Ç–æ—Ä –ó–µ–º–ª—ñ ($R=6400$ –∫–º). –û–∫—Ä—É–≥–ª—ñ—Ç—å –¥–æ —Ç–∏—Å—è—á.", hint: "$C = 2\\pi R$", solution: "40000", answer: 40000 },
            { id: 843, text: "–†–æ–∑–≥–æ—Ä—Ç–∫–∞ –∫–æ–Ω—É—Å–∞ - –ø—ñ–≤–∫—Ä—É–≥ ($R=10$). –ó–Ω–∞–π–¥—ñ—Ç—å $r$ –∫–æ–Ω—É—Å–∞.", hint: "–î–æ–≤–∂–∏–Ω–∞ –¥—É–≥–∏ = –¥–æ–≤–∂–∏–Ω—ñ –∫–æ–ª–∞ –æ—Å–Ω–æ–≤–∏", solution: "5", answer: 5 },
            { id: 844, text: "–ß–∏ –≤–ª—ñ–∑–µ —Ä–æ–∑–≥–æ—Ä—Ç–∫–∞ —Ü–∏–ª—ñ–Ω–¥—Ä–∞ ($r=5, h=9$) –Ω–∞ –∞—Ä–∫—É—à 31x32? (1-–¢–∞–∫, 0-–ù—ñ)", hint: "–î–æ–≤–∂–∏–Ω–∞ $2\\pi r \\approx 31.4$", solution: "–ù—ñ (0)", answer: 0 },
            { id: 845, text: "–ß–∏ –≤–∏—Å—Ç–∞—á–∏—Ç—å 1–∫–≥ —Ñ–∞—Ä–±–∏? ($d=40$—Å–º, $h=5$–º, –≤–∏—Ç—Ä–∞—Ç–∞ 150–≥/–º¬≤). (1-–¢–∞–∫, 0-–ù—ñ)", hint: "–ü–æ—Ä–∞—Ö—É–π –ø–ª–æ—â—É –≤ –º–µ—Ç—Ä–∞—Ö", solution: "–¢–∞–∫ (1)", answer: 1 },
            { id: 846, text: "–ü—Ä–æ—Å—Ç—ñ —á–∏—Å–ª–∞: $3x - y = 12$. –ó–Ω–∞–π–¥—ñ—Ç—å $x$.", hint: "–°–ø—Ä–æ–±—É–π $x=5$", solution: "5", answer: 5 },
            { id: 847, text: "–û–±—á–∏—Å–ª—ñ—Ç—å: $(2.7 - 0.9) \\cdot 2\\frac{1}{3}$.", hint: "$1.8 \\cdot 7/3$", solution: "4.2", answer: 4.2 },
            // –ë–ª—ñ—Ü
            { id: 901, text: "–ë–ª—ñ—Ü: $r=10$. –ó–Ω–∞–π–¥—ñ—Ç—å –¥–æ–≤–∂–∏–Ω—É –∫–æ–ª–∞ ($\\pi=3.14$).", hint: "$2\\pi r$", solution: "62.8", answer: 62.8 },
            { id: 902, text: "–ë–ª—ñ—Ü: $r=4$. –ü–ª–æ—â–∞ –∫—Ä—É–≥–∞ ($\\pi=3$).", hint: "$3 \\cdot 16$", solution: "48", answer: 48 },
            { id: 903, text: "–ë–ª—ñ—Ü: $r=1, h=5$. $S_{–±—ñ—á}$ ($\\pi=3.14$).", hint: "$10 \\cdot 3.14$", solution: "31.4", answer: 31.4 },
            { id: 904, text: "–ë–ª—ñ—Ü: –î—ñ–∞–º–µ—Ç—Ä 10. –†–∞–¥—ñ—É—Å?", hint: "–ü–æ–ª–æ–≤–∏–Ω–∞", solution: "5", answer: 5 },
            { id: 905, text: "–ë–ª—ñ—Ü: $2/3$ –≤—ñ–¥ 60.", hint: "40", solution: "40", answer: 40 },
            { id: 906, text: "–ë–ª—ñ—Ü: $0.5 \\cdot 0.5$", hint: "0.25", solution: "0.25", answer: 0.25 },
            { id: 907, text: "–ë–ª—ñ—Ü: –§—ñ–≥—É—Ä–∞ –æ–±–µ—Ä—Ç–∞–Ω–Ω—è –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞?", hint: "—Ç–µ–∫—Å—Ç–æ–º", solution: "—Ü–∏–ª—ñ–Ω–¥—Ä", answer: "—Ü–∏–ª—ñ–Ω–¥—Ä" },
            { id: 908, text: "–ë–ª—ñ—Ü: $r=2, h=2$. $S_{–±—ñ—á}$ ($\\pi=3$).", hint: "24", solution: "24", answer: 24 },
            { id: 909, text: "–ë–ª—ñ—Ü: 25% –≤—ñ–¥ 200.", hint: "50", solution: "50", answer: 50 },
            { id: 910, text: "–ë–ª—ñ—Ü: $3^3 - 7$.", hint: "27-7", solution: "20", answer: 20 },
            { id: 911, text: "–ë–ª—ñ—Ü: –†–∞–¥—ñ—É—Å 5. –î—ñ–∞–º–µ—Ç—Ä?", hint: "10", solution: "10", answer: 10 },
            { id: 912, text: "–ë–ª—ñ—Ü: $150 : 1.5$.", hint: "100", solution: "100", answer: 100 },
            { id: 913, text: "–ë–ª—ñ—Ü: $S_{–±—ñ—á}=20\\pi, h=2$. –†–∞–¥—ñ—É—Å?", hint: "5", solution: "5", answer: 5 },
            { id: 914, text: "–ë–ª—ñ—Ü: –ö—ñ–ª—å–∫—ñ—Å—Ç—å –æ—Å–Ω–æ–≤ —Ü–∏–ª—ñ–Ω–¥—Ä–∞.", hint: "2", solution: "2", answer: 2 },
            { id: 915, text: "–ë–ª—ñ—Ü: –†–æ–∑–≥–æ—Ä—Ç–∫–∞ –±—ñ—á–Ω–æ—ó –ø–æ–≤–µ—Ä—Ö–Ω—ñ - —Ü–µ...", hint: "–ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫", solution: "–ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫", answer: "–ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫" },
            { id: 916, text: "–ë–ª—ñ—Ü: $5^2 + 12^2$.", hint: "169", solution: "169", answer: 169 },
            { id: 917, text: "–ë–ª—ñ—Ü: $V=\\pi r^2 h$. $r=3, h=10, \\pi=3$.", hint: "270", solution: "270", answer: 270 },
            { id: 918, text: "–ë–ª—ñ—Ü: $1/2 + 0.5$.", hint: "1", solution: "1", answer: 1 },
            { id: 919, text: "–ë–ª—ñ—Ü: $100 - 35.5$.", hint: "64.5", solution: "64.5", answer: 64.5 },
            { id: 920, text: "–ë–ª—ñ—Ü: –§—ñ–≥—É—Ä–∞ –∑ –∫–æ–Ω—É—Å–∞ –º–æ—Ä–æ–∑–∏–≤–∞.", hint: "–∫–æ–Ω—É—Å", solution: "–∫–æ–Ω—É—Å", answer: "–∫–æ–Ω—É—Å" }
        ];

        let correctAnswers = 0;

        window.onload = function() {
            renderTasks();
            setupCanvas();
            // Handle resize events to switch layout modes if needed
            window.addEventListener('resize', () => {
                if(window.innerWidth >= 768) {
                    document.getElementById('task-panel').style.display = 'flex';
                    document.getElementById('board-panel').style.display = 'flex';
                } else {
                    switchTab(currentTab);
                }
                resizeCanvas();
            });
        };

        function renderTasks() {
            const container = document.getElementById('tasks-container');
            tasks.forEach((task, index) => {
                const el = document.createElement('div');
                el.className = "bg-white p-4 rounded-xl shadow-sm border border-gray-100";
                el.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="bg-indigo-100 text-indigo-800 text-xs font-bold px-2 py-1 rounded">‚Ññ${index + 1}</span>
                    </div>
                    <div class="text-gray-800 mb-3 font-medium text-sm md:text-base">${task.text}</div>
                    
                    <div class="flex flex-col gap-2">
                        <div class="flex gap-2 w-full">
                            <input type="text" id="input-${task.id}" placeholder="–í—ñ–¥–ø–æ–≤—ñ–¥—å" class="border border-gray-300 p-2 rounded w-full focus:outline-none focus:border-indigo-500 transition text-sm">
                            <button onclick="checkTask(${task.id}, '${task.answer}')" class="bg-indigo-600 active:bg-indigo-800 text-white font-bold py-2 px-4 rounded transition text-sm">–û–ö</button>
                        </div>
                        <div class="flex gap-4 text-xs mt-1">
                            <button onclick="toggleVisibility('hint-${task.id}')" class="text-amber-600 font-semibold">üí° –ü—ñ–¥–∫–∞–∑–∫–∞</button>
                            <button onclick="toggleVisibility('sol-${task.id}')" class="text-green-600 font-semibold">üìù –†–æ–∑–≤'—è–∑–∞–Ω–Ω—è</button>
                        </div>
                    </div>
                    
                    <div id="hint-${task.id}" class="hidden mt-2 p-2 bg-yellow-50 text-yellow-800 rounded text-xs italic">${task.hint}</div>
                    <div id="sol-${task.id}" class="hidden mt-2 p-2 bg-green-50 text-green-800 rounded text-xs"><strong>–í—ñ–¥–ø–æ–≤—ñ–¥—å:</strong> ${task.solution}</div>
                `;
                container.appendChild(el);
            });
            MathJax.typeset();
        }

        function toggleVisibility(id) {
            const el = document.getElementById(id);
            el.classList.toggle('hidden');
        }

        function checkTask(id, correctVal) {
            const input = document.getElementById(`input-${id}`);
            let userVal = input.value.trim().toLowerCase().replace(',', '.');
            let isCorrect = false;

            if (!isNaN(parseFloat(correctVal))) {
                if (Math.abs(parseFloat(userVal) - parseFloat(correctVal)) < 0.1) isCorrect = true;
            } else {
                if (userVal === correctVal.toString().toLowerCase()) isCorrect = true;
            }

            input.classList.remove('correct-anim', 'wrong-anim');
            void input.offsetWidth; 

            if (isCorrect) {
                input.classList.add('correct-anim');
                if (!input.disabled) {
                    correctAnswers++;
                    updateScore();
                    input.disabled = true;
                }
            } else {
                input.classList.add('wrong-anim');
            }
        }

        function updateScore() {
            document.getElementById('score').innerText = correctAnswers;
        }

        function finishLesson() {
            // Switch to tasks view on mobile to see result
            if(window.innerWidth < 768) switchTab('tasks');
            
            const finalDiv = document.getElementById('final-section');
            const container = document.getElementById('tasks-container');
            container.style.display = 'none';
            finalDiv.classList.remove('hidden');
            finalDiv.classList.add('fade-in');
            
            const percent = (correctAnswers / tasks.length) * 100;
            let praise = percent >= 50 ? "–ú–æ–ª–æ–¥–µ—Ü—å! –ß—É–¥–æ–≤–∞ —Ä–æ–±–æ—Ç–∞! üöÄ" : "–¢–∏ —Å—Ç–∞—Ä–∞–≤—Å—è! –ù–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–∞–∑—É –±—É–¥–µ —â–µ –∫—Ä–∞—â–µ! üå±";
            document.getElementById('final-score-display').innerHTML = `–†–µ–∑—É–ª—å—Ç–∞—Ç: <strong>${correctAnswers}</strong> –∑ ${tasks.length}`;
            document.getElementById('final-praise').innerText = praise;
            document.getElementById('content-area').scrollTop = 0;
        }

        // --- CANVAS ---
        const canvas = document.getElementById('whiteboard');
        const ctx = canvas.getContext('2d');
        let painting = false;
        let tool = 'pen';
        let color = '#2563eb';

        function setupCanvas() {
            resizeCanvas();
            
            // Mouse
            canvas.addEventListener('mousedown', startPosition);
            canvas.addEventListener('mouseup', finishedPosition);
            canvas.addEventListener('mousemove', draw);
            
            // Touch
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startPosition(e.touches[0]);
            });
            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                finishedPosition();
            });
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                draw(e.touches[0]);
            });

            document.getElementById('colorPicker').addEventListener('change', (e) => {
                color = e.target.value;
                if(tool === 'eraser') tool = 'pen';
            });
        }

        function resizeCanvas() {
            const parent = canvas.parentElement;
            if(parent.clientWidth > 0 && parent.clientHeight > 0) {
                // Save current drawing
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                tempCtx.drawImage(canvas, 0, 0);

                // Resize
                canvas.width = parent.clientWidth;
                canvas.height = parent.clientHeight;

                // Restore drawing
                ctx.drawImage(tempCanvas, 0, 0);
            }
        }

        function startPosition(e) {
            painting = true;
            draw(e);
        }

        function finishedPosition() {
            painting = false;
            ctx.beginPath();
        }

        function draw(e) {
            if (!painting) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.pageX) - rect.left;
            const y = (e.clientY || e.pageY) - rect.top;

            ctx.lineWidth = tool === 'eraser' ? 25 : 3;
            ctx.lineCap = 'round';
            ctx.strokeStyle = tool === 'eraser' ? '#ffffff' : color;

            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function setTool(t) { tool = t; }
        function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }
        
        function drawGrid() {
            ctx.beginPath();
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            for (let x = 0; x <= canvas.width; x += 40) { ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); }
            for (let y = 0; y <= canvas.height; y += 40) { ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); }
            ctx.stroke();
            ctx.beginPath();
        }

        function insertShape(shape) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            if (shape === 'cylinder') {
                ctx.beginPath();
                ctx.ellipse(cx, cy - 60, 40, 15, 0, 0, 2*Math.PI);
                ctx.stroke();
                ctx.beginPath();
                ctx.ellipse(cx, cy + 60, 40, 15, 0, 0, 2*Math.PI);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(cx - 40, cy - 60); ctx.lineTo(cx - 40, cy + 60);
                ctx.moveTo(cx + 40, cy - 60); ctx.lineTo(cx + 40, cy + 60);
                ctx.stroke();
            } else if (shape === 'cone') {
                ctx.beginPath();
                ctx.ellipse(cx, cy + 60, 40, 15, 0, 0, 2*Math.PI);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(cx - 40, cy + 60); ctx.lineTo(cx, cy - 60); ctx.lineTo(cx + 40, cy + 60);
                ctx.stroke();
            }
        }
    </script>
</body>
</html>
