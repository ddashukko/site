<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERMINAL: MATH_QUEST_6</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f2ff;
            --neon-pink: #ff00ff;
            --terminal-bg: #050505;
            --glass: rgba(0, 242, 255, 0.1);
        }

        body, html {
            margin: 0; padding: 0; height: 100%;
            background: var(--terminal-bg);
            color: #fff;
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
        }

        .main-container {
            display: grid;
            grid-template-columns: 1.3fr 0.7fr;
            height: 100vh;
        }

        /* --- TERMINAL (LEFT) --- */
        .terminal {
            padding: 40px;
            overflow-y: auto;
            border-right: 2px solid var(--neon-blue);
            background: radial-gradient(circle at top left, #0a0a1a, #050505);
            scrollbar-width: thin;
        }

        .glitch-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue);
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .status-line { color: var(--neon-pink); margin-bottom: 30px; font-size: 0.9rem; }

        .module-label {
            background: var(--neon-blue);
            color: #000;
            display: inline-block;
            padding: 2px 10px;
            font-weight: bold;
            margin-top: 30px;
            text-transform: uppercase;
        }

        .task-card {
            background: var(--glass);
            border-left: 4px solid var(--neon-blue);
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
            transition: 0.3s;
        }

        .math-symbol {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-pink);
            text-shadow: 0 0 5px var(--neon-pink);
            font-weight: bold;
        }

        input {
            background: transparent;
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            padding: 10px;
            font-family: inherit;
            outline: none;
            width: 100px;
            box-shadow: inset 0 0 5px var(--neon-blue);
        }

        .btn {
            background: var(--neon-blue);
            color: #000;
            border: none;
            padding: 11px 20px;
            cursor: pointer;
            font-weight: 700;
            text-transform: uppercase;
        }

        .btn-utility {
            background: transparent;
            border: 1px solid #444;
            color: #888;
            margin-left: 5px;
            padding: 5px 10px;
            font-size: 0.7rem;
        }

        /* --- BOARD (RIGHT) --- */
        .board-container {
            display: flex;
            flex-direction: column;
            background: #000;
            position: relative;
            overflow: hidden;
        }

        .board-tools {
            padding: 15px;
            background: #111;
            display: flex;
            gap: 10px;
            border-bottom: 1px solid #222;
            z-index: 10;
        }

        #board-wrapper {
            flex-grow: 1;
            position: relative;
            cursor: none; /* Ховаємо стандартний курсор */
        }

        canvas { width: 100%; height: 100%; display: block; }

        /* Кастомний лазерний курсор */
        #laser-cursor {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--neon-blue);
            border-radius: 50%;
            pointer-events: none;
            box-shadow: 0 0 15px var(--neon-blue), 0 0 30px var(--neon-blue);
            transform: translate(-50%, -50%);
            z-index: 100;
            display: none;
        }

        .progress-indicator {
            position: fixed;
            top: 0; left: 0;
            height: 3px;
            background: var(--neon-pink);
            z-index: 100;
            box-shadow: 0 0 10px var(--neon-pink);
        }

        #final-msg {
            display: none;
            position: fixed;
            top: 50%; left: 30%;
            transform: translate(-50%, -50%);
            background: #000;
            border: 2px solid var(--neon-pink);
            padding: 40px;
            text-align: center;
            z-index: 200;
        }
    </style>
</head>
<body>

<div class="progress-indicator" id="progBar" style="width: 0%"></div>

<div class="main-container">
    <div class="terminal">
        <h1 class="glitch-title">Beacon_v6.0</h1>
        <div class="status-line">> INIT_SEQUENCE: SUCCESS | SYMBOLS_OVERRIDE: ACTIVE</div>
        <div id="quest-flow"></div>
        <button class="btn" style="width: 100%; margin-top: 50px; padding: 20px;" onclick="finish()">UPLOAD_DATA_TO_ORBIT</button>
    </div>

    <div class="board-container">
        <div class="board-tools">
            <button class="btn" onclick="setMode('brush')">DRAW</button>
            <button class="btn" onclick="setMode('eraser')">ERASE</button>
            <button class="btn" style="background: var(--neon-pink);" onclick="clearAll()">RESET</button>
            <input type="color" id="cPick" value="#00f2ff" onchange="updateColor(this.value)">
        </div>
        <div id="board-wrapper">
            <div id="laser-cursor"></div>
            <canvas id="board"></canvas>
        </div>
    </div>
</div>

<div id="final-msg">
    <h1 style="color: var(--neon-pink);">SYSTEM RESTORED</h1>
    <p id="stats"></p>
    <button class="btn" onclick="location.reload()">REBOOT</button>
</div>

<script>
    const data = [
        {m:"ORBITAL_GEOMETRY", q:"Діаметр люка <span class='math-symbol'>d</span> = 40. Знайди радіус <span class='math-symbol'>r</span>.", a:"20", h:"r = d / 2", s:"40 / 2 = 20"},
        {m:"ORBITAL_GEOMETRY", q:"Довжина кабелю по колу <span class='math-symbol'>C</span>, якщо <span class='math-symbol'>d</span> = 10, <span class='math-symbol'>π</span> ≈ 3.14.", a:"31.4", h:"C = πd", s:"3.14 * 10 = 31.4"},
        {m:"ORBITAL_GEOMETRY", q:"Радіус антени <span class='math-symbol'>r</span> = 5. Знайди <span class='math-symbol'>C</span>.", a:"31.4", h:"C = 2πr", s:"2 * 3.14 * 5 = 31.4"},
        {m:"ORBITAL_GEOMETRY", q:"Площа круга <span class='math-symbol'>S</span>, якщо <span class='math-symbol'>r</span> = 10.", a:"314", h:"S = πr²", s:"3.14 * 10 * 10 = 314"},
        {m:"ORBITAL_GEOMETRY", q:"<span class='math-symbol'>C</span> = 6.28. Знайди радіус <span class='math-symbol'>r</span>.", a:"1", h:"r = C / (2π)", s:"6.28 / 6.28 = 1"},
        {m:"ENERGY_CELLS", q:"Заряд 500 МВт. Використано 20%. Скільки це МВт?", a:"100", h:"500 * 0.2", s:"500 / 5 = 100"},
        {m:"ENERGY_CELLS", q:"25% від резерву — це 40 л. Який весь резерв?", a:"160", h:"40 * 4", s:"40 / 0.25 = 160"},
        {m:"ENERGY_CELLS", q:"Було 80, стало 100. На скільки % зріс тиск?", a:"25", h:"Різниця 20 від 80", s:"20/80 = 1/4 = 25%"},
        {m:"LOGIC_LINKS", q:"Пропорція: <span class='math-symbol'>x</span> / 5 = 12 / 3. Знайди <span class='math-symbol'>x</span>.", a:"20", h:"3x = 60", s:"60 / 3 = 20"},
        {m:"LOGIC_LINKS", q:"Знайди <span class='math-symbol'>y</span>: 4 : 2 = <span class='math-symbol'>y</span> : 5.", a:"10", h:"2y = 20", s:"20 / 2 = 10"},
        {m:"LOGIC_LINKS", q:"Чи рівні 1/3 та 3/9? (так/ні)", a:"так", h:"Скороти 3/9", s:"3/9 = 1/3. Так."},
        {m:"MAP_SCALING", q:"Масштаб 1:200. 10 см на карті — це ... м?", a:"20", h:"2000 см = ? м", s:"10 * 200 = 2000 см = 20 м"},
        {m:"MAP_SCALING", q:"В 1 см — 5 км. Який числовий масштаб? 1:...", a:"500000", h:"5 км в сантиметрах", s:"5 * 1000 * 100 = 500,000"},
        {m:"CARGO_FRACTIONS", q:"Завантажено 1/3 та ще 1/6 відсіку. Скільки всього? (дріб x/y)", a:"1/2", h:"Зведи до знаменника 6", s:"2/6 + 1/6 = 3/6 = 1/2"},
        {m:"CARGO_FRACTIONS", q:"<span class='math-symbol'>1</span> - 3/4 = ?", a:"1/4", h:"4/4 - 3/4", s:"1/4"},
        {m:"CARGO_FRACTIONS", q:"0.5 + 1/2 = ? (ціле число)", a:"1", h:"0.5 це і є 1/2", s:"0.5 + 0.5 = 1"},
        {m:"CARGO_FRACTIONS", q:"(1/2) * (2/3) = ?", a:"1/3", h:"Скороти двійки", s:"2/6 = 1/3"},
        {m:"CORE_DIVISIBILITY", q:"Знайди НСД(15, 20).", a:"5", h:"Найбільший дільник", s:"Обидва діляться на 5"},
        {m:"CORE_DIVISIBILITY", q:"Знайди НСК(3, 4).", a:"12", h:"Найменше спільне кратне", s:"3 * 4 = 12"},
        {m:"CORE_DIVISIBILITY", q:"Чи ділиться 123 на 3? (так/ні)", a:"так", h:"Сума цифр 1+2+3", s:"6 ділиться на 3. Так."}
    ];

    const flow = document.getElementById('quest-flow');
    let solved = 0;
    let currentM = "";

    data.forEach((t, i) => {
        if(t.m !== currentM) {
            currentM = t.m;
            const lbl = document.createElement('div');
            lbl.className = 'module-label';
            lbl.innerText = t.m;
            flow.appendChild(lbl);
        }
        const card = document.createElement('div');
        card.className = 'task-card';
        card.id = `card-${i}`;
        card.innerHTML = `<div>> QUERY_${i+1}: ${t.q}</div><div style="margin-top:15px;"><input type="text" id="ans-${i}"><button class="btn" onclick="check(${i})">RUN</button><button class="btn-utility" onclick="toggle('h-${i}')">HINT</button><button class="btn-utility" onclick="toggle('s-${i}')">LOG</button></div><div id="h-${i}" style="display:none;color:var(--neon-blue);font-size:0.7rem;margin-top:5px;">[HINT]: ${t.h}</div><div id="s-${i}" style="display:none;color:var(--neon-pink);font-size:0.7rem;margin-top:5px;">[SOL]: ${t.s}</div><div id="f-${i}" style="margin-top:10px;font-weight:bold;font-size:0.8rem;"></div>`;
        flow.appendChild(card);
    });

    function check(i) {
        const val = document.getElementById(`ans-${i}`).value.trim().toLowerCase();
        const f = document.getElementById(`f-${i}`);
        if(val === data[i].a) {
            f.innerText = "> ACCESS_GRANTED"; f.style.color = "var(--neon-blue)";
            if(!document.getElementById(`card-${i}`).classList.contains('ok')) {
                solved++; document.getElementById(`card-${i}`).classList.add('ok');
                document.getElementById(`card-${i}`).style.borderColor = "var(--neon-blue)"; updateProg();
            }
        } else { f.innerText = "> ERROR_ACCESS_DENIED"; f.style.color = "var(--neon-pink)"; }
    }

    function toggle(id) { const el = document.getElementById(id); el.style.display = el.style.display === 'block' ? 'none' : 'block'; }
    function updateProg() { document.getElementById('progBar').style.width = (solved / data.length) * 100 + "%"; }
    function finish() { document.getElementById('final-msg').style.display = 'block'; document.getElementById('stats').innerText = `Протоколів відновлено: ${solved} / ${data.length}`; }

    // --- ПЕРЕРОБЛЕНА ДОШКА ---
    const canvas = document.getElementById('board');
    const ctx = canvas.getContext('2d');
    const laser = document.getElementById('laser-cursor');
    const wrapper = document.getElementById('board-wrapper');
    let drawing = false;

    function initBoard() {
        canvas.width = wrapper.clientWidth;
        canvas.height = wrapper.clientHeight;
        ctx.strokeStyle = document.getElementById('cPick').value;
        ctx.lineWidth = 3;
        ctx.lineCap = 'round';
    }
    window.onresize = initBoard; initBoard();

    wrapper.onmouseenter = () => laser.style.display = 'block';
    wrapper.onmouseleave = () => laser.style.display = 'none';

    wrapper.onmousemove = (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        laser.style.left = x + 'px';
        laser.style.top = y + 'px';

        if(!drawing) return;
        ctx.lineTo(x, y);
        ctx.stroke();
    };

    wrapper.onmousedown = () => { drawing = true; ctx.beginPath(); };
    wrapper.onmouseup = () => { drawing = false; ctx.beginPath(); };

    function setMode(m) {
        ctx.globalCompositeOperation = m === 'eraser' ? 'destination-out' : 'source-over';
        ctx.lineWidth = m === 'eraser' ? 40 : 3;
        laser.style.background = m === 'eraser' ? 'var(--neon-pink)' : document.getElementById('cPick').value;
        laser.style.boxShadow = `0 0 15px ${laser.style.background}`;
    }

    function updateColor(c) { ctx.strokeStyle = c; laser.style.background = c; laser.style.boxShadow = `0 0 15px ${c}`; setMode('brush'); }
    function clearAll() { ctx.clearRect(0,0,canvas.width,canvas.height); }
</script>
</body>
</html>
