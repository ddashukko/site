<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Mathematik-Test 5. Klasse (Deutschland) ‚Äì Schriftliches Rechnen
    </title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    ></script>

    <style>
      :root {
        --primary: #059669; /* –°–º–∞—Ä–∞–≥–¥–æ–≤–æ-–∑–µ–ª–µ–Ω–∏–π –¥–ª—è –ù—ñ–º–µ—á—á–∏–Ω–∏/–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∏ */
        --primary-light: #d1fae5;
        --success: #16a34a;
        --error: #dc2626;
        --bg: #f8fafc;
        --card: #ffffff;
        --text: #1e293b;
        --border: #e2e8f0;
        --accent: #059669;
        --toolbar-bg: #f1f5f9; /* –°–≤—ñ—Ç–ª–æ-—Å—ñ—Ä–∏–π –¥–ª—è –ø–∞–Ω–µ–ª—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ */
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: var(--bg);
        color: var(--text);
        margin: 0;
        padding: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      header {
        background: var(--card);
        width: 100%;
        padding: 15px 20px;
        border-bottom: 3px solid var(--accent);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .header-title {
        font-weight: 700;
        font-size: 1.5rem;
        color: var(--accent);
        text-align: center;
      }

      /* --- –û–°–ù–û–í–ù–ê –°–¢–†–£–ö–¢–£–†–ê –î–õ–Ø –í–ï–õ–ò–ö–ò–• –ï–ö–†–ê–ù–Ü–í (–ü–ö/–ù–æ—É—Ç–±—É–∫–∏) --- */
      .main-layout {
        display: flex;
        width: 100%;
        max-width: 1600px;
        min-height: calc(100vh - 60px);
      }

      .content-container {
        width: 50%;
        padding: 20px;
        box-sizing: border-box;
        overflow-y: auto;
      }

      .scrap-pad-container {
        width: 50%;
        background-color: var(--toolbar-bg);
        border-left: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        padding: 10px;
      }
      /* ----------------------------------------------------------- */

      .quiz-block {
        background: var(--card);
        border-radius: 12px;
        border: 1px solid var(--border);
        margin-bottom: 20px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }

      .question-header {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 15px;
        display: flex;
        align-items: flex-start;
      }
      .question-number {
        color: var(--accent);
        font-size: 1.2rem;
        margin-right: 10px;
        min-width: 30px;
      }

      .options-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 10px;
      }

      .option-btn {
        background: white;
        border: 1px solid #cbd5e1;
        border-radius: 8px;
        padding: 10px 15px;
        font-size: 1rem;
        cursor: pointer;
        white-space: nowrap;
        text-align: center;
        transition: 0.2s;
      }

      /* --- –°—Ç–∏–ª—ñ –¥–ª—è –¥–æ—à–∫–∏ (Scrap Pad) --- */
      .drawing-canvas {
        flex-grow: 1;
        background-color: white;
        border: 1px solid var(--border);
        cursor: crosshair;
        touch-action: none;
      }
      .canvas-toolbar {
        display: flex;
        gap: 10px;
        padding: 10px 0;
        justify-content: center;
        flex-wrap: wrap;
      }
      .toolbar-btn {
        padding: 10px 18px; /* –ó–±—ñ–ª—å—à–µ–Ω–æ padding –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ –Ω–∞ —Ç–∞—á—Å–∫—Ä—ñ–Ω—ñ */
        border: 1px solid var(--border);
        border-radius: 8px; /* –ë—ñ–ª—å—à –æ–∫—Ä—É–≥–ª—ñ –∫—É—Ç–∏ */
        background: var(--card);
        cursor: pointer;
        transition: background 0.2s, border-color 0.2s;
        font-size: 1.1rem; /* –ó–±—ñ–ª—å—à–µ–Ω–æ —à—Ä–∏—Ñ—Ç */
        font-weight: 600;
      }
      /* –†–µ—à—Ç–∞ —Å—Ç–∏–ª—ñ–≤ –∫–Ω–æ–ø–æ–∫ —Ç–∞ –º–æ–¥–∞–ª–∫–∏ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è */
      .option-btn:hover:not(:disabled) {
        border-color: var(--primary);
        background: var(--primary-light);
      }
      .option-btn.selected-correct {
        background: var(--success);
        color: white;
        border-color: var(--success);
      }
      .option-btn.selected-correct .katex {
        color: white !important;
      }
      .option-btn.selected-wrong {
        background: var(--error);
        color: white;
        border-color: var(--error);
      }
      .option-btn.selected-wrong .katex {
        color: white !important;
      }

      .finish-section {
        margin-top: 40px;
        text-align: center;
      }
      .btn-finish {
        padding: 15px 40px;
        font-size: 1.2rem;
        font-weight: bold;
        color: white;
        background: var(--primary);
        border: none;
        border-radius: 50px;
        box-shadow: 0 4px 15px rgba(5, 150, 105, 0.4);
        transition: transform 0.2s;
        cursor: pointer;
      }
      .btn-finish:hover {
        transform: scale(1.05);
        background-color: #047857;
      }

      .scrap-pad-header {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--text);
        margin-bottom: 10px;
        text-align: center;
      }

      .toolbar-btn:hover {
        background: var(--primary-light);
        border-color: var(--primary);
      }
      .toolbar-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }
      .toolbar-btn.active:hover {
        background: var(--primary);
      }
      .toolbar-btn.clear-btn {
        background: var(--error);
        color: white;
        border-color: var(--error);
      }
      .toolbar-btn.clear-btn:hover {
        background: #b91c1c;
      }

      /* --- –ê–î–ê–ü–¢–ò–í–ù–Ü–°–¢–¨ –î–õ–Ø –ü–õ–ê–ù–®–ï–¢–Ü–í –¢–ê –ú–û–ë–Ü–õ–¨–ù–ò–• (–î–û 900PX) --- */
      @media (max-width: 900px) {
        .main-layout {
          flex-direction: column;
        }
        .content-container {
          width: 100%;
          padding: 15px; /* –¢—Ä–æ—Ö–∏ –º–µ–Ω—à—ñ –≤—ñ–¥—Å—Ç—É–ø–∏ */
          order: 2; /* –ö–æ–Ω—Ç–µ–Ω—Ç –π–¥–µ –ø—ñ—Å–ª—è –¥–æ—à–∫–∏ */
        }
        .scrap-pad-container {
          width: 100%;
          border-left: none;
          border-top: 1px solid var(--border);
          padding: 15px;
          order: 1; /* –î–æ—à–∫–∞ –ø–µ—Ä–µ–º—ñ—â—É—î—Ç—å—Å—è –≤–≥–æ—Ä—É */

          /* –§–Ü–ö–°–û–í–ê–ù–ê –í–ò–°–û–¢–ê –î–õ–Ø –ü–õ–ê–ù–®–ï–¢–Ü–í/–ú–û–ë–Ü–õ–¨–ù–ò–• */
          height: 50vh;
          min-height: 350px; /* –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –≤–∏—Å–æ—Ç–∞ –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ */
        }

        .drawing-canvas {
          /* –ó–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è, —â–æ canvas –∑–∞–π–º–∞—î –≤–µ—Å—å –¥–æ—Å—Ç—É–ø–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
          height: calc(100% - 70px);
        }

        .options-container {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-title">
        üá©üá™ Schriftliches Rechnen (Addition, Subtraktion, Multiplikation,
        Division) | 5. Klasse
      </div>
    </header>

    <div class="main-layout">
      <div class="scrap-pad-container">
        <div class="scrap-pad-header">üìù –î–æ—à–∫–∞ –¥–ª—è –∑–∞–ø–∏—Å—ñ–≤ / –ß–µ—Ä–Ω–µ—Ç–∫–∞</div>
        <div class="canvas-toolbar">
          <button class="toolbar-btn active" id="pen-btn">‚úçÔ∏è –ü–∏—Å–∞—Ç–∏</button>
          <button class="toolbar-btn" id="eraser-btn">üßº –°—Ç–µ—Ä—Ç–∏</button>
          <button class="toolbar-btn clear-btn" onclick="clearCanvas()">
            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏
          </button>
        </div>
        <canvas id="drawing-canvas" class="drawing-canvas"></canvas>
      </div>

      <div class="content-container" id="quiz-root"></div>
    </div>

    <div id="result-modal" class="modal-overlay">
      <div class="modal-card">
        <div id="modal-content-body"></div>
      </div>
    </div>

    <script>
      // ===============================================
      // JAVASCRIPT –î–õ–Ø –¢–ï–°–¢–£ (–±–µ–∑ –∑–º—ñ–Ω)
      // ===============================================

      // –ú–∞—Å–∏–≤ —Ç–µ—Å—Ç–æ–≤–∏—Ö –ø–∏—Ç–∞–Ω—å, —Å—Ñ–æ–∫—É—Å–æ–≤–∞–Ω–∏—Ö –Ω–∞ –ø–∏—Å—å–º–æ–≤–∏—Ö –æ–±—á–∏—Å–ª–µ–Ω–Ω—è—Ö
      const testQuestions = [
        // ------------------ Addition (8) ------------------
        {
          id: 1,
          q: "Berechnen Sie die Summe (schriftliche Addition):\n$45.879 + 12.345$",
          a: "58.224",
          opts: ["57.114", "58.224", "59.124", "57.214"],
        },
        {
          id: 2,
          q: "Berechnen Sie die Summe:\n$1.209.560 + 89.471$",
          a: "1.299.031",
          opts: ["1.299.031", "1.299.131", "1.309.031", "1.289.031"],
        },
        {
          id: 3,
          q: "Berechnen Sie die Summe:\n$67.892 + 9.999$",
          a: "77.891",
          opts: ["77.881", "78.891", "77.891", "77.991"],
        },
        {
          id: 4,
          q: "Berechnen Sie die Summe:\n$345.008 + 98.765$",
          a: "443.773",
          opts: ["443.773", "433.773", "442.763", "444.773"],
        },
        {
          id: 5,
          q: "Berechnen Sie die Summe:\n$803.456 + 196.544$",
          a: "1.000.000",
          opts: ["999.999", "1.000.000", "1.000.010", "999.000"],
        },
        {
          id: 6,
          q: "Berechnen Sie die Summe:\n$123.456 + 76.543$",
          a: "199.999",
          opts: ["200.000", "199.990", "199.999", "200.999"],
        },
        {
          id: 7,
          q: "Berechnen Sie die Summe:\n$4.567 + 1.234 + 5.000$",
          a: "10.801",
          opts: ["10.791", "10.801", "11.801", "10.701"],
        },
        {
          id: 8,
          q: "Berechnen Sie die Summe:\n$98.765 + 1.235$",
          a: "100.000",
          opts: ["99.000", "100.000", "99.990", "101.000"],
        },
        // ------------------ Subtraktion (8) ------------------
        {
          id: 9,
          q: "Berechnen Sie die Differenz (schriftliche Subtraktion):\n$50.000 - 12.345$",
          a: "37.655",
          opts: ["37.655", "38.655", "37.755", "37.555"],
        },
        {
          id: 10,
          q: "Berechnen Sie die Differenz:\n$10.000 - 999$",
          a: "9.001",
          opts: ["9.001", "9.010", "9.901", "8.901"],
        },
        {
          id: 11,
          q: "Berechnen Sie die Differenz:\n$345.678 - 12.345$",
          a: "333.333",
          opts: ["333.333", "333.343", "333.223", "343.333"],
        },
        {
          id: 12,
          q: "Berechnen Sie die Differenz:\n$8.003 - 4.567$",
          a: "3.436",
          opts: ["3.546", "3.436", "4.436", "3.536"],
        },
        {
          id: 13,
          q: "Berechnen Sie die Differenz:\n$1.000.000 - 456.789$",
          a: "543.211",
          opts: ["543.211", "543.111", "554.211", "543.221"],
        },
        {
          id: 14,
          q: "Berechnen Sie die Differenz:\n$98.765 - 8.976$",
          a: "89.789",
          opts: ["89.789", "89.889", "90.789", "99.741"],
        },
        {
          id: 15,
          q: "Berechnen Sie die Differenz:\n$7.000 - 345$",
          a: "6.655",
          opts: ["6.655", "6.755", "6.645", "6.345"],
        },
        {
          id: 16,
          q: "Berechnen Sie die Differenz:\n$20.020 - 1.001$",
          a: "19.019",
          opts: ["19.119", "19.019", "19.009", "21.021"],
        },
        // ------------------ Multiplikation (8) ------------------
        {
          id: 17,
          q: "Berechnen Sie das Produkt (schriftliche Multiplikation):\n$123 \\cdot 5$",
          a: "615",
          opts: ["615", "605", "515", "625"],
        },
        {
          id: 18,
          q: "Berechnen Sie das Produkt:\n$45 \\cdot 20$",
          a: "900",
          opts: ["900", "800", "950", "450"],
        },
        {
          id: 19,
          q: "Berechnen Sie das Produkt:\n$205 \\cdot 30$",
          a: "6.150",
          opts: ["6.050", "6.150", "6.250", "6.000"],
        },
        {
          id: 20,
          q: "Berechnen Sie das Produkt:\n$34 \\cdot 18$",
          a: "612",
          opts: ["612", "582", "542", "602"],
        },
        {
          id: 21,
          q: "Berechnen Sie das Produkt:\n$111 \\cdot 111$",
          a: "12.321",
          opts: ["12.331", "12.121", "12.321", "11.111"],
        },
        {
          id: 22,
          q: "Berechnen Sie das Produkt:\n$250 \\cdot 40$",
          a: "10.000",
          opts: ["1.000", "10.000", "100.000", "10.250"],
        },
        {
          id: 23,
          q: "Berechnen Sie das Produkt:\n$305 \\cdot 24$",
          a: "7.320",
          opts: ["7.220", "7.320", "7.420", "7.300"],
        },
        {
          id: 24,
          q: "Berechnen Sie das Produkt:\n$98 \\cdot 12$",
          a: "1.176",
          opts: ["1.166", "1.186", "1.176", "1.106"],
        },
        // ------------------ Division (6) ------------------
        {
          id: 25,
          q: "Berechnen Sie den Quotienten (schriftliche Division):\n$250 \\div 5$",
          a: "50",
          opts: ["5", "50", "25", "500"],
        },
        {
          id: 26,
          q: "Berechnen Sie den Quotienten:\n$400 \\div 8$",
          a: "50",
          opts: ["40", "50", "80", "60"],
        },
        {
          id: 27,
          q: "Berechnen Sie den Quotienten:\n$144 \\div 12$",
          a: "12",
          opts: ["10", "12", "14", "16"],
        },
        {
          id: 28,
          q: "Berechnen Sie den Quotienten:\n$808 \\div 4$",
          a: "202",
          opts: ["22", "202", "20", "200"],
        },
        {
          id: 29,
          q: "Berechnen Sie die Division:\n$305 \\div 10$. Wie lautet der Quotient und der Rest?",
          a: "Quotient: 30, Rest: 5",
          opts: [
            "Quotient: 30, Rest: 5",
            "Quotient: 3, Rest: 5",
            "Quotient: 35, Rest: 0",
            "Quotient: 305, Rest: 0",
          ],
        },
        {
          id: 30,
          q: "Berechnen Sie die Division:\n$500 \\div 7$. Wie lautet der Quotient und der Rest?",
          a: "Quotient: 71, Rest: 3",
          opts: [
            "Quotient: 70, Rest: 0",
            "Quotient: 70, Rest: 10",
            "Quotient: 71, Rest: 3",
            "Quotient: 71, Rest: 1",
          ],
        },
      ];

      let totalCorrect = 0;
      let totalAttempted = 0;
      let isFinished = false;

      // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é checkAnswer
      window.checkAnswer = function (btn, questionId, correctAns) {
        if (isFinished) return;

        const questionBlock = btn.closest(".quiz-block");
        if (questionBlock.classList.contains("answered")) return;

        questionBlock.classList.add("answered");
        totalAttempted++;

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è —Ä—è–¥–∫—ñ–≤ –≤—ñ–¥ KaTeX-—Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
        const cleanString = (str) => {
          let cleaned = str
            .replace(/\\/g, "")
            .replace(/\s/g, "")
            .replace(/\$/g, "")
            .replace(/\\cdot/g, "cdot")
            .replace(/\\div/g, "div")
            .replace(/\\frac/g, "/")
            .replace(/\{/g, "")
            .replace(/\}/g, "")
            .replace(/\(\)/g, "");

          // –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–Ω–∞–∫—ñ–≤ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
          cleaned = cleaned.replace(/</g, "&lt;").replace(/>/g, "&gt;");

          // –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–µ—Å—è—Ç–∫–æ–≤–∏—Ö —á–∏—Å–µ–ª (–∑–∞–º—ñ–Ω–∞ –Ω—ñ–º–µ—Ü—å–∫–æ—ó –∫–æ–º–∏ –Ω–∞ –∫—Ä–∞–ø–∫—É)
          cleaned = cleaned.replace(/,/g, ".");

          // –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è —á–∏—Å–µ–ª –∑ —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫–∞–º–∏ —Ç–∏—Å—è—á (–∫—Ä–∞–ø–∫–∞ –≤ –Ω—ñ–º–µ—Ü—å–∫–æ–º—É —Å—Ç–∏–ª—ñ)
          // –í–∏–¥–∞–ª—è—î–º–æ –∫—Ä–∞–ø–∫–∏, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —è–∫ —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫–∏ —Ç–∏—Å—è—á –≤ –Ω—ñ–º–µ—Ü—å–∫—ñ–π –º–æ–≤—ñ
          cleaned = cleaned
            .replace(/(\d)\.(\d{3})/g, "$1$2")
            .replace(/\./g, "");

          // –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –¥–ª—è –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ –∑ "Quotient/Rest"
          cleaned = cleaned.replace(/Quotient:/g, "Q:").replace(/Rest:/g, "R:");

          return cleaned.trim();
        };

        const selectedValue = cleanString(btn.innerText);
        const answerValue = cleanString(correctAns);

        // –û–±—Ä–æ–±–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –∑ –æ–¥–∏–Ω–∏—Ü—è–º–∏ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è/—Ç–µ–∫—Å—Ç–æ–º (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "Q: 30, R: 5")
        const isCorrect = selectedValue === answerValue;

        // –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó
        questionBlock.querySelectorAll(".option-btn").forEach((b) => {
          b.disabled = true;
          const bValue = cleanString(b.innerText);
          if (bValue === answerValue) {
            b.classList.add("selected-correct");
          }
        });

        if (isCorrect) {
          totalCorrect++;
        } else {
          btn.classList.add("selected-wrong");
        }

        updateFinishButton();
      };

      function updateFinishButton() {
        const finishBtn = document.getElementById("finish-test-btn");
        if (totalAttempted === testQuestions.length) {
          finishBtn.innerText = "–ü–æ–∫–∞–∑–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç";
          finishBtn.disabled = false;
        } else {
          finishBtn.innerText = `–ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ç–µ—Å—Ç (${totalAttempted}/${testQuestions.length})`;
          finishBtn.disabled = false;
        }
      }

      window.finishTest = function () {
        isFinished = true;
        showModal();
      };

      function renderQuiz() {
        const root = document.getElementById("quiz-root");
        root.innerHTML = "";

        testQuestions.forEach((q) => {
          const block = document.createElement("div");
          block.className = "quiz-block";

          let questionHtml = `
            <div class="question-header">
              <span class="question-number">${q.id}.</span>
              <span class="question-text">${q.q.replace(/\n/g, "<br>")}</span>
            </div>
            <div class="options-container">
          `;

          // –û–±—Ä–æ–±–∫–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ –≤ onclick
          const safeAns = q.a.replace(/'/g, "\\'").replace(/"/g, "&quot;");

          q.opts.forEach((opt) => {
            const safeOpt = opt.replace(/'/g, "\\'").replace(/"/g, "&quot;");
            questionHtml += `<button class="option-btn" onclick="checkAnswer(this, ${q.id}, '${safeAns}')">${opt}</button>`;
          });

          questionHtml += `</div>`;
          block.innerHTML = questionHtml;
          root.appendChild(block);
        });

        const finishSection = document.createElement("div");
        finishSection.className = "finish-section";
        finishSection.innerHTML = `
            <button class="btn-finish" id="finish-test-btn" onclick="finishTest()">
              –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ç–µ—Å—Ç (0/${testQuestions.length})
            </button>
          `;
        root.appendChild(finishSection);
      }

      function showModal() {
        const modal = document.getElementById("result-modal");
        const body = document.getElementById("modal-content-body");

        const totalQuestions = testQuestions.length;
        const score = totalCorrect;
        const percentage = Math.round((score / totalQuestions) * 100);

        let msg = "";
        let color = "";

        if (percentage === 100) {
          msg = "Perfekt! üá©üá™üî•";
          color = "#16a34a";
        } else if (percentage >= 80) {
          msg = "Ausgezeichnetes Ergebnis! üëè";
          color = "#2563eb";
        } else if (percentage >= 60) {
          msg = "Gut gemacht, aber Sie k√∂nnen sich verbessern. üëç";
          color = "#f59e0b";
        } else {
          msg = "Es ist Zeit, mehr zu √ºben. ‚úçÔ∏è";
          color = "#dc2626";
        }

        body.innerHTML = `
            <div style="font-size: 1.5rem; font-weight: 700; color: ${color};">${msg}</div>
            <div style="font-size: 1rem; color: #64748b; margin-top: 10px;">Ihr Ergebnis:</div>
            <div class="modal-score-big" style="color: ${color};">${score} / ${totalQuestions}</div>
            <div style="font-size: 1.1rem; color: #64748b;">Genauigkeit: ${percentage}%</div>
            <button class="modal-footer-btn" onclick="location.reload()">Nochmal versuchen</button>
          `;

        modal.style.display = "flex";
      }

      // ===============================================
      // JAVASCRIPT –î–õ–Ø CANVAS (–î–û–®–ö–ò)
      // ===============================================

      const canvas = document.getElementById("drawing-canvas");
      const ctx = canvas.getContext("2d");
      let isDrawing = false;
      let lastX = 0;
      let lastY = 0;
      let mode = "pen";
      const PEN_COLOR = "black";
      const PEN_SIZE = 4;
      const ERASER_SIZE = 20; // –¢—Ä–æ—Ö–∏ –∑–±—ñ–ª—å—à–µ–Ω–æ –¥–ª—è —Å–µ–Ω—Å–æ—Ä–Ω–æ–≥–æ –µ–∫—Ä–∞–Ω–∞

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü—ñ—ó —Ä–æ–∑–º—ñ—Ä—É canvas
      function resizeCanvas() {
        const container = canvas.parentElement;

        // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Ä–æ–∑–º—ñ—Ä–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
        // –í—Ä–∞—Ö—É–≤–∞–Ω–Ω—è margin/padding/toolbar: container.clientHeight - –≤–∏—Å–æ—Ç–∞ –ø–∞–Ω–µ–ª—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤
        const toolbarHeight =
          document.querySelector(".canvas-toolbar").offsetHeight || 50;
        const headerHeight =
          document.querySelector(".scrap-pad-header").offsetHeight || 25;
        const padding = 20; // –ü—Ä–∏–±–ª–∏–∑–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è padding –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

        // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Ä–æ–∑–º—ñ—Ä–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
        canvas.width = container.clientWidth;
        // –ù–∞ –≤–µ–ª–∏–∫–∏—Ö –µ–∫—Ä–∞–Ω–∞—Ö: flex-grow –∑–∞–π–º–∞—î –ø—Ä–æ—Å—Ç—ñ—Ä
        // –ù–∞ –º–∞–ª–∏—Ö –µ–∫—Ä–∞–Ω–∞—Ö: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ñ—ñ–∫—Å–æ–≤–∞–Ω—É –≤–∏—Å–æ—Ç—É –∑ CSS, canvas –ø–æ–≤–∏–Ω–µ–Ω –∑–∞–π–Ω—è—Ç–∏ —Ä–µ—à—Ç—É
        if (window.innerWidth <= 900) {
          canvas.height =
            container.clientHeight - (toolbarHeight + headerHeight);
        } else {
          // –ù–∞ —à–∏—Ä–æ–∫–∏—Ö –µ–∫—Ä–∞–Ω–∞—Ö –º–∏ –ø–æ–∫–ª–∞–¥–∞—î–º–æ—Å—è –Ω–∞ flex-grow, –∞–ª–µ –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø–æ—Ç—Ä—ñ–±–Ω–∞ –≤–∏—Å–æ—Ç–∞
          canvas.height =
            container.clientHeight - toolbarHeight - headerHeight - padding;
        }

        // –ó–∞–±–µ–∑–ø–µ—á—É—î–º–æ –±—ñ–ª–∏–π —Ñ–æ–Ω –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ä–æ–∑–º—ñ—Ä—É, —è–∫—â–æ –≤—ñ–Ω –±—É–≤ –ø—Ä–æ–∑–æ—Ä–∏–º
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }

      // –í–∏–∫–ª–∏–∫–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Ç–∞ –∑–º—ñ–Ω—ñ —Ä–æ–∑–º—ñ—Ä—É –≤—ñ–∫–Ω–∞
      window.addEventListener("resize", resizeCanvas);

      function startDrawing(e) {
        e.preventDefault();
        isDrawing = true;
        [lastX, lastY] = getCoordinates(e);

        ctx.beginPath();
        ctx.moveTo(lastX, lastY);

        draw(e);
      }

      function draw(e) {
        if (!isDrawing) return;
        e.preventDefault();

        let [currentX, currentY] = getCoordinates(e);

        ctx.strokeStyle = mode === "pen" ? PEN_COLOR : "white";
        ctx.lineWidth = mode === "pen" ? PEN_SIZE : ERASER_SIZE;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";

        if (mode === "eraser") {
          ctx.globalCompositeOperation = "destination-out";
        } else {
          ctx.globalCompositeOperation = "source-over";
        }

        ctx.lineTo(currentX, currentY);
        ctx.stroke();

        [lastX, lastY] = [currentX, currentY];
      }

      function stopDrawing() {
        if (!isDrawing) return;
        isDrawing = false;
        ctx.closePath();
      }

      // –î–æ–ø–æ–º—ñ–∂–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ø–æ–¥—ñ—ó (–º–∏—à–∞ —á–∏ –¥–æ—Ç–∏–∫)
      function getCoordinates(e) {
        const rect = canvas.getBoundingClientRect();
        let clientX, clientY;

        if (e.touches && e.touches.length > 0) {
          clientX = e.touches[0].clientX;
          clientY = e.touches[0].clientY;
        } else {
          clientX = e.clientX;
          clientY = e.clientY;
        }

        return [clientX - rect.left, clientY - rect.top];
      }

      // –§—É–Ω–∫—Ü—ñ—è –ø–æ–≤–Ω–æ–≥–æ –æ—á–∏—â–µ–Ω–Ω—è –¥–æ—à–∫–∏
      window.clearCanvas = function () {
        ctx.clearRect(0, 0, canvas.width, canvas.height); // –ß–∏—Å—Ç–∏–º–æ –≤–º—ñ—Å—Ç

        // –ü–µ—Ä–µ–º–∞–ª—å–æ–≤—É—î–º–æ –±—ñ–ª–∏–π —Ñ–æ–Ω, —â–æ–± "destination-out" –ø—Ä–∞—Ü—é–≤–∞–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
        ctx.globalCompositeOperation = "source-over";
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ä–µ–∂–∏–º –º–∞–ª—é–≤–∞–Ω–Ω—è
        setMode(mode);
      };

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–º—ñ–Ω–∏ —Ä–µ–∂–∏–º—É (–æ–ª—ñ–≤–µ—Ü—å/–≥—É–º–∫–∞)
      function setMode(newMode) {
        mode = newMode;

        document.getElementById("pen-btn").classList.remove("active");
        document.getElementById("eraser-btn").classList.remove("active");

        if (newMode === "pen") {
          document.getElementById("pen-btn").classList.add("active");
        } else if (newMode === "eraser") {
          document.getElementById("eraser-btn").classList.add("active");
        }

        // –î–ª—è –≥—É–º–∫–∏ –º–∏ –º–æ–∂–µ–º–æ —Å–∫–∏–Ω—É—Ç–∏ globalCompositeOperation
        if (mode === "eraser") {
          ctx.globalCompositeOperation = "destination-out";
        } else {
          ctx.globalCompositeOperation = "source-over";
        }
      }

      // –ü—Ä–∏–≤'—è–∑–∫–∞ –ø–æ–¥—ñ–π –¥–ª—è –º–∏—à—ñ
      canvas.addEventListener("mousedown", startDrawing);
      canvas.addEventListener("mousemove", draw);
      canvas.addEventListener("mouseup", stopDrawing);
      canvas.addEventListener("mouseout", stopDrawing);

      // –ü—Ä–∏–≤'—è–∑–∫–∞ –ø–æ–¥—ñ–π –¥–ª—è —Å–µ–Ω—Å–æ—Ä–Ω–∏—Ö –µ–∫—Ä–∞–Ω—ñ–≤
      canvas.addEventListener("touchstart", startDrawing);
      canvas.addEventListener("touchmove", draw);
      canvas.addEventListener("touchend", stopDrawing);
      canvas.addEventListener("touchcancel", stopDrawing);

      // –ü—Ä–∏–≤'—è–∑–∫–∞ –∫–Ω–æ–ø–æ–∫ –¥–æ –∑–º—ñ–Ω–∏ —Ä–µ–∂–∏–º—É
      document
        .getElementById("pen-btn")
        .addEventListener("click", () => setMode("pen"));
      document
        .getElementById("eraser-btn")
        .addEventListener("click", () => setMode("eraser"));

      // ===============================================
      // –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø
      // ===============================================

      document.addEventListener("DOMContentLoaded", () => {
        renderQuiz();
        updateFinishButton();
        resizeCanvas(); // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä–æ–∑–º—ñ—Ä –¥–æ—à–∫–∏
        setMode("pen"); // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä–µ–∂–∏–º

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –¥–ª—è –≤—Å—å–æ–≥–æ body
        renderMathInElement(document.body, {
          delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "\\[", right: "\\]", display: true },
            { left: "$", right: "$", display: false },
            { left: "\\(", right: "\\)", display: false },
          ],
          throwOnError: false,
        });
      });
    </script>
  </body>
</html>
