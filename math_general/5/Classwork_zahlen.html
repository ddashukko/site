<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ö–ª–∞—Å–Ω–∞ –†–æ–±–æ—Ç–∞: –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</title>
    <style>
      :root {
        --primary: #4a90e2;
        --success: #2ecc71;
        --error: #e74c3c;
        --bg: #f0f4f8;
        --card-bg: #ffffff;
        --text: #2c3e50;
        --toolbar-bg: #dfe6e9;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--bg);
        color: var(--text);
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden;
      }

      /* LAYOUT MANAGER */
      .app-container {
        display: flex;
        height: 100vh;
        width: 100vw;
      }

      /* LEFT PANEL - TASKS */
      .tasks-panel {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        border-right: 2px solid #ccc;
        background: #f7f9fc;
      }

      /* RIGHT PANEL - BOARD */
      .board-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        background-color: #fff;
        position: relative;
      }

      /* STYLES FOR TASKS */
      .container-box {
        max-width: 800px;
        margin: 0 auto;
        background: var(--card-bg);
        border-radius: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        padding: 20px;
      }

      h1 {
        text-align: center;
        color: var(--primary);
        margin-bottom: 10px;
        font-size: 2rem;
      }

      .stats-bar {
        display: flex;
        justify-content: space-between;
        background: #e1e8ed;
        padding: 10px 15px;
        border-radius: 15px;
        margin-bottom: 20px;
        font-weight: bold;
      }

      .tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 5px;
      }

      .tab-btn {
        background: #dfe6e9;
        border: none;
        padding: 8px 15px;
        border-radius: 15px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s ease;
      }

      .tab-btn.active {
        background: var(--primary);
        color: white;
      }

      .tab-content {
        display: none;
        animation: fadeIn 0.5s;
      }
      .tab-content.active {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .problem-card {
        background: #fafafa;
        border: 2px solid #eee;
        border-radius: 12px;
        padding: 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 10px;
      }

      .input-group {
        display: flex;
        gap: 5px;
        align-items: center;
      }

      input[type="text"] {
        padding: 8px;
        border: 2px solid #bdc3c7;
        border-radius: 8px;
        font-size: 1rem;
        width: 100px;
        text-align: center;
        outline: none;
      }
      input[type="text"]:focus {
        border-color: var(--primary);
      }

      button.check-btn {
        background: var(--primary);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 8px;
        cursor: pointer;
      }

      .correct input {
        border-color: var(--success);
        background-color: #e8f8f5;
        color: #27ae60;
      }
      .incorrect input {
        border-color: var(--error);
        background-color: #fdeaea;
      }
      .message {
        font-size: 0.8rem;
        font-weight: bold;
        margin-left: 5px;
      }
      .msg-correct {
        color: var(--success);
      }
      .msg-incorrect {
        color: var(--error);
      }

      .progress-container {
        width: 100%;
        background: #e0e0e0;
        height: 8px;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 5px;
      }
      .progress-fill {
        height: 100%;
        background: var(--success);
        width: 0%;
        transition: width 0.5s;
      }

      .level-badge,
      .boss-badge {
        padding: 2px 6px;
        border-radius: 8px;
        color: white;
        font-size: 0.75rem;
        margin-right: 5px;
      }
      .boss-badge {
        background: #6c5ce7;
      }

      /* STYLES FOR BOARD */
      .toolbar {
        height: 50px;
        background: var(--toolbar-bg);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        border-bottom: 1px solid #bdc3c7;
        padding: 0 10px;
      }

      .tool-btn {
        background: white;
        border: 1px solid #bdc3c7;
        padding: 5px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: 0.2s;
      }

      .tool-btn:hover {
        background: #ecf0f1;
      }
      .tool-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }
      .tool-btn.danger {
        color: #c0392b;
        border-color: #c0392b;
      }
      .tool-btn.danger:hover {
        background: #c0392b;
        color: white;
      }

      .canvas-container {
        flex: 1;
        position: relative;
        background-color: #ffffff;
        /* Grid Pattern */
        background-image: linear-gradient(#e1e1e1 1px, transparent 1px),
          linear-gradient(90deg, #e1e1e1 1px, transparent 1px);
        background-size: 20px 20px;
        background-position: -1px -1px;
        cursor: crosshair;
        overflow: hidden;
      }

      canvas {
        display: block;
        touch-action: none;
      }

      @media (max-width: 768px) {
        .app-container {
          flex-direction: column;
          overflow: auto;
        }
        .tasks-panel {
          height: 60vh;
          overflow-y: auto;
          border-right: none;
          border-bottom: 2px solid #ccc;
        }
        .board-panel {
          height: 40vh;
          min-height: 300px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <div class="tasks-panel">
        <div class="container-box">
          <h1>üè´ –ö–ª–∞—Å–Ω–∞ –†–æ–±–æ—Ç–∞</h1>

          <div class="stats-bar">
            <div>–ü—Ä–æ–≥—Ä–µ—Å: <span id="progress-text">0/30</span></div>
            <div style="color: var(--primary)">
              –ë–∞–ª–∏: <span id="score">0</span>
            </div>
          </div>
          <div class="progress-container">
            <div class="progress-fill" id="progress-fill"></div>
          </div>

          <br />

          <div class="tabs">
            <button class="tab-btn active" onclick="openTab('add')">
              ‚ûï –î–æ–¥–∞–≤–∞–Ω–Ω—è
            </button>
            <button class="tab-btn" onclick="openTab('sub')">
              ‚ûñ –í—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è
            </button>
            <button class="tab-btn" onclick="openTab('mul')">
              ‚úñÔ∏è –ú–Ω–æ–∂–µ–Ω–Ω—è
            </button>
            <button class="tab-btn" onclick="openTab('div')">‚ûó –î—ñ–ª–µ–Ω–Ω—è</button>
          </div>

          <div id="add" class="tab-content active"></div>
          <div id="sub" class="tab-content"></div>
          <div id="mul" class="tab-content"></div>
          <div id="div" class="tab-content"></div>
        </div>
      </div>

      <div class="board-panel">
        <div class="toolbar">
          <button class="tool-btn active" id="btn-pen" onclick="setTool('pen')">
            üñäÔ∏è –†—É—á–∫–∞
          </button>
          <button class="tool-btn" id="btn-eraser" onclick="setTool('eraser')">
            üßº –°—Ç–∏—Ä–∞—á–∫–∞
          </button>
          <div
            style="width: 1px; height: 20px; background: #999; margin: 0 10px"
          ></div>
          <button class="tool-btn danger" onclick="clearBoard()">
            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ
          </button>
        </div>
        <div class="canvas-container" id="canvas-wrap">
          <canvas id="mathBoard"></canvas>
        </div>
      </div>
    </div>

    <script>
      // --- PART 1: MATH LOGIC (NEW CLASSWORK DATA) ---
      const data = {
        add: [
          { q: "245 130 + 532 640", a: 777770, level: "–ù–æ—Ä–º" },
          { q: "3 409 050 + 2 590 950", a: 6000000, level: "–•–∞—Ä–¥" },
          { q: "6 924 500 + 5 186 600", a: 12111100, level: "–•–∞—Ä–¥" },
          { q: "888 888 888 + 222 222 222", a: 1111111110, level: "–ë–û–°" },
          { q: "5 050 505 + 9 090 909", a: 14141414, level: "–ë–û–°" },
        ],
        sub: [
          { q: "768 954 - 243 512", a: 525442, level: "–ù–æ—Ä–º" },
          { q: "2 000 000 - 345 678", a: 1654322, level: "–•–∞—Ä–¥" },
          { q: "9 102 304 - 8 999 999", a: 102305, level: "–•–∞—Ä–¥" },
          { q: "11 111 111 - 9 876 543", a: 1234568, level: "–ë–û–°" },
          { q: "6 004 000 - 3 999 001", a: 2004999, level: "–ë–û–°" },
        ],
        mul: [
          { q: "345 √ó 24", a: 8280, level: "3x2" },
          { q: "672 √ó 45", a: 30240, level: "3x2" },
          { q: "908 √ó 76", a: 69008, level: "3x2" },
          { q: "123 √ó 321", a: 39483, level: "3x3" },
          { q: "456 √ó 654", a: 298224, level: "3x3" },
          { q: "789 √ó 111", a: 87579, level: "3x3" },
          { q: "500 √ó 408", a: 204000, level: "3x3" },
          { q: "234 √ó 567", a: 132678, level: "3x3" },
          { q: "888 √ó 125", a: 111000, level: "3x3" },
          { q: "999 √ó 999", a: 998001, level: "3x3" },
        ],
        div: [
          { q: "3 192 √∑ 7", a: 456, level: "–Ω–∞ 1" },
          { q: "5 040 √∑ 8", a: 630, level: "–Ω–∞ 1" },
          { q: "2 916 √∑ 4", a: 729, level: "–Ω–∞ 1" },
          { q: "2 808 √∑ 26", a: 108, level: "–Ω–∞ 2" },
          { q: "5 832 √∑ 18", a: 324, level: "–Ω–∞ 2" },
          { q: "8 064 √∑ 64", a: 126, level: "–Ω–∞ 2" },
          { q: "9 009 √∑ 99", a: 91, level: "–Ω–∞ 2" },
          { q: "4 410 √∑ 42", a: 105, level: "–Ω–∞ 2" },
          { q: "7 680 √∑ 32", a: 240, level: "–Ω–∞ 2" },
          { q: "3 025 √∑ 55", a: 55, level: "–Ω–∞ 2" },
        ],
      };

      let totalScore = 0;
      let totalSolved = 0;
      const totalProblems = 30;

      function renderSection(id, problems) {
        const container = document.getElementById(id);
        let html = "";
        problems.forEach((p, index) => {
          let badgeClass = p.level === "–ë–û–°" ? "boss-badge" : "level-badge";
          html += `
            <div class="problem-card" id="${id}-card-${index}">
                <div>
                    <span class="${badgeClass}" style="background-color: ${getLevelColor(
            p.level
          )}">${p.level}</span>
                    <span style="font-weight:600">${p.q} = </span>
                </div>
                <div class="input-group">
                    <input type="text" id="${id}-in-${index}" placeholder="?" autocomplete="off" onkeypress="handleEnter(event, '${id}', ${index}, ${
            p.a
          })">
                    <button class="check-btn" onclick="checkAnswer('${id}', ${index}, ${
            p.a
          })">–û–ö</button>
                    <span class="message" id="${id}-msg-${index}"></span>
                </div>
            </div>`;
        });
        container.innerHTML = html;
      }

      function getLevelColor(level) {
        if (level === "–ë–û–°" || level === "–•–∞—Ä–¥") return "#ff7675";
        if (level.includes("3x3")) return "#fdcb6e";
        return "#74b9ff";
      }

      renderSection("add", data.add);
      renderSection("sub", data.sub);
      renderSection("mul", data.mul);
      renderSection("div", data.div);

      function openTab(tabId) {
        document
          .querySelectorAll(".tab-content")
          .forEach((el) => el.classList.remove("active"));
        document
          .querySelectorAll(".tab-btn")
          .forEach((el) => el.classList.remove("active"));
        document.getElementById(tabId).classList.add("active");
        const btns = document.querySelectorAll(".tab-btn");
        if (tabId === "add") btns[0].classList.add("active");
        if (tabId === "sub") btns[1].classList.add("active");
        if (tabId === "mul") btns[2].classList.add("active");
        if (tabId === "div") btns[3].classList.add("active");
      }

      function checkAnswer(section, index, correctVal) {
        const inputEl = document.getElementById(`${section}-in-${index}`);
        const cardEl = document.getElementById(`${section}-card-${index}`);
        const msgEl = document.getElementById(`${section}-msg-${index}`);
        const btn = cardEl.querySelector("button");
        let userValStr = inputEl.value.replace(/\s/g, "");
        let userVal = parseInt(userValStr);

        if (cardEl.classList.contains("correct")) return;

        if (userVal === correctVal) {
          cardEl.classList.remove("incorrect");
          cardEl.classList.add("correct");
          msgEl.textContent = "üëç –°—É–ø–µ—Ä!";
          msgEl.className = "message msg-correct";
          btn.textContent = "‚úî";
          btn.disabled = true;
          btn.style.background = "#2ecc71";
          totalScore += 10;
          document.getElementById("score").textContent = totalScore;
          totalSolved++;
          document.getElementById(
            "progress-text"
          ).textContent = `${totalSolved}/${totalProblems}`;
          document.getElementById("progress-fill").style.width = `${
            (totalSolved / totalProblems) * 100
          }%`;

          if (totalSolved === totalProblems)
            setTimeout(() => alert("–ö–õ–ê–°–ù–ê –†–û–ë–û–¢–ê –í–ò–ö–û–ù–ê–ù–ê! üèÜ"), 500);
        } else {
          cardEl.classList.add("incorrect");
          msgEl.textContent = "–î—É–º–∞–π!";
          msgEl.className = "message msg-incorrect";
          setTimeout(() => cardEl.classList.remove("incorrect"), 500);
        }
      }

      function handleEnter(e, section, index, correctVal) {
        if (e.key === "Enter") checkAnswer(section, index, correctVal);
      }

      // --- PART 2: BOARD LOGIC ---
      const canvas = document.getElementById("mathBoard");
      const ctx = canvas.getContext("2d");
      const canvasContainer = document.getElementById("canvas-wrap");

      let isDrawing = false;
      let currentTool = "pen";
      let lastX = 0;
      let lastY = 0;

      function resizeCanvas() {
        canvas.width = canvasContainer.offsetWidth;
        canvas.height = canvasContainer.offsetHeight;
        setupContext();
      }

      function setupContext() {
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        updateToolSettings();
      }

      function updateToolSettings() {
        if (currentTool === "pen") {
          ctx.globalCompositeOperation = "source-over";
          ctx.strokeStyle = "#0056b3";
          ctx.lineWidth = 2;
        } else if (currentTool === "eraser") {
          ctx.globalCompositeOperation = "destination-out";
          ctx.lineWidth = 20;
        }
      }

      window.addEventListener("resize", resizeCanvas);
      setTimeout(resizeCanvas, 100);

      function startDrawing(e) {
        isDrawing = true;
        [lastX, lastY] = getCoordinates(e);
      }

      function draw(e) {
        if (!isDrawing) return;
        e.preventDefault();

        const [x, y] = getCoordinates(e);

        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(x, y);
        ctx.stroke();

        [lastX, lastY] = [x, y];
      }

      function stopDrawing() {
        isDrawing = false;
        ctx.beginPath();
      }

      function getCoordinates(e) {
        const rect = canvas.getBoundingClientRect();
        let clientX, clientY;

        if (e.type.includes("touch")) {
          clientX = e.touches[0].clientX;
          clientY = e.touches[0].clientY;
        } else {
          clientX = e.clientX;
          clientY = e.clientY;
        }

        return [clientX - rect.left, clientY - rect.top];
      }

      canvas.addEventListener("mousedown", startDrawing);
      canvas.addEventListener("mousemove", draw);
      canvas.addEventListener("mouseup", stopDrawing);
      canvas.addEventListener("mouseout", stopDrawing);

      canvas.addEventListener("touchstart", startDrawing, { passive: false });
      canvas.addEventListener("touchmove", draw, { passive: false });
      canvas.addEventListener("touchend", stopDrawing);

      function setTool(tool) {
        currentTool = tool;
        updateToolSettings();

        document.getElementById("btn-pen").classList.remove("active");
        document.getElementById("btn-eraser").classList.remove("active");

        if (tool === "pen")
          document.getElementById("btn-pen").classList.add("active");
        if (tool === "eraser")
          document.getElementById("btn-eraser").classList.add("active");
      }

      function clearBoard() {
        if (confirm("–û—á–∏—Å—Ç–∏—Ç–∏ –¥–æ—à–∫—É –ø–æ–≤–Ω—ñ—Å—Ç—é?")) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
      }
    </script>
  </body>
</html>
