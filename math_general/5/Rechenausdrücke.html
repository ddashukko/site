<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mathematik Klasse 5-6: Rechenausdr√ºcke und Terme</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    ></script>

    <style>
      :root {
        --primary: #2563eb;
        --primary-light: #eff6ff;
        --success: #16a34a;
        --error: #dc2626;
        --bg: #f8fafc;
        --card: #ffffff;
        --text: #1e293b;
        --border: #e2e8f0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: var(--bg);
        color: var(--text);
        margin: 0;
        padding: 0;
      }

      header {
        background: var(--card);
        padding: 15px 20px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
      }

      .header-title {
        font-weight: 700;
        font-size: 1.2rem;
        color: var(--primary);
      }

      .stats-container {
        display: flex;
        gap: 15px;
        font-weight: 600;
      }
      .stat-correct {
        color: var(--success);
      }
      .stat-wrong {
        color: var(--error);
      }

      .main-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        padding-bottom: 100px;
      }

      .exercise-block {
        background: var(--card);
        border-radius: 12px;
        border: 1px solid var(--border);
        margin-bottom: 30px;
        overflow: hidden;
      }

      .exercise-header {
        background: var(--primary-light);
        padding: 15px 20px;
        border-bottom: 1px solid var(--border);
      }

      .exercise-title {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--primary);
      }

      .exercise-desc {
        margin: 5px 0 0 0;
        font-size: 0.9rem;
        color: #64748b;
      }

      .visual-container {
        display: flex;
        justify-content: center;
        padding: 20px;
        background: #fff;
        border-bottom: 1px solid var(--border);
      }

      .task-list {
        display: flex;
        flex-direction: column;
      }

      .task-row {
        padding: 15px 20px;
        border-bottom: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .task-row:last-child {
        border-bottom: none;
      }

      .task-row.solved-correct {
        background-color: #f0fdf4;
      }
      .task-row.solved-wrong {
        background-color: #fef2f2;
      }

      .task-content {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .task-number {
        font-weight: 600;
        color: #94a3b8;
        min-width: 25px;
      }
      .task-question {
        font-size: 1.1rem;
        font-weight: 500;
      }

      .options-container {
        display: flex;
        flex-wrap: nowrap;
        gap: 10px;
        overflow-x: auto;
        padding-bottom: 5px;
        -webkit-overflow-scrolling: touch;
      }

      .option-btn {
        flex: 0 0 auto;
        background: white;
        border: 1px solid #cbd5e1;
        border-radius: 8px;
        padding: 10px 20px;
        font-size: 1rem;
        cursor: pointer;
        min-width: 60px;
        white-space: nowrap;
        text-align: center;
        transition: all 0.2s;
      }

      .option-btn:hover:not(:disabled) {
        border-color: var(--primary);
        color: var(--primary);
        background: var(--primary-light);
      }

      .option-btn.selected-correct {
        background: var(--success);
        color: white;
        border-color: var(--success);
      }
      .option-btn.selected-correct .katex {
        color: white !important;
      }

      .option-btn.selected-wrong {
        background: var(--error);
        color: white;
        border-color: var(--error);
      }
      .option-btn.selected-wrong .katex {
        color: white !important;
      }

      .input-group {
        display: flex;
        gap: 10px;
      }
      .input-answer {
        padding: 10px;
        border: 1px solid #cbd5e1;
        border-radius: 8px;
        width: 120px;
        font-size: 1rem;
      }
      .btn-check {
        padding: 10px 20px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
      }
      .input-answer.correct {
        border-color: var(--success);
        background: #f0fdf4;
        color: var(--success);
      }
      .input-answer.wrong {
        border-color: var(--error);
        background: #fef2f2;
      }

      .footer-actions {
        display: flex;
        justify-content: center;
        margin-top: 40px;
      }

      .btn-finish {
        background-color: var(--text);
        color: white;
        font-size: 1.2rem;
        font-weight: 700;
        padding: 15px 40px;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .btn-finish:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      .result-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(5px);
      }

      .result-card {
        background: white;
        padding: 40px;
        border-radius: 20px;
        text-align: center;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      @keyframes popIn {
        from {
          transform: scale(0.8);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      .result-emoji {
        font-size: 4rem;
        margin-bottom: 20px;
        display: block;
      }

      .result-title {
        font-size: 1.8rem;
        font-weight: 800;
        margin: 0 0 10px 0;
        color: var(--text);
      }

      .result-score {
        font-size: 3rem;
        font-weight: 800;
        color: var(--primary);
        margin: 10px 0;
      }

      .result-total {
        color: #64748b;
        font-size: 1.2rem;
      }

      .btn-restart {
        margin-top: 25px;
        background-color: var(--primary);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-title">Dasha Tutor: Rechenausdr√ºcke</div>
      <div class="stats-container">
        <span class="stat-correct">‚úÖ <span id="val-correct">0</span></span>
        <span class="stat-wrong">‚ùå <span id="val-wrong">0</span></span>
      </div>
    </header>

    <div class="main-container" id="quiz-root"></div>

    <div class="footer-actions">
      <button class="btn-finish" onclick="finishLesson()">
        Ergebnis pr√ºfen
      </button>
    </div>

    <div class="result-modal" id="resultModal">
      <div class="result-card">
        <span class="result-emoji" id="resEmoji">üéâ</span>
        <h2 class="result-title" id="resTitle">Ausgezeichnet!</h2>
        <div class="result-score" id="resScore">0%</div>
        <div class="result-total">
          Du hast <span id="resCorrect">0</span> von
          <span id="resTotal">0</span> Aufgaben richtig gel√∂st.
        </div>
        <button class="btn-restart" onclick="location.reload()">
          Noch einmal versuchen
        </button>
      </div>
    </div>

    <script>
      const exercises = [
        {
          id: "ex1",
          title: "1. Berechne schrittweise",
          desc: "Welche Regel hast du angewendet? W√§hle das richtige Ergebnis.",
          tasks: [
            {
              id: "a)",
              q: "$6 \\cdot (13 + 17)$",
              a: "180",
              opts: ["160", "180", "190", "200"],
            },
            {
              id: "b)",
              q: "$(4 + 22) \\cdot 3$",
              a: "78",
              opts: ["68", "78", "88", "28"],
            },
            {
              id: "c)",
              q: "$12 \\cdot (89 - 14)$",
              a: "900",
              opts: ["850", "890", "900", "920"],
            },
            {
              id: "d)",
              q: "$(4 + 2) \\cdot (1 + 7)$",
              a: "48",
              opts: ["42", "48", "56", "14"],
            },
            {
              id: "e)",
              q: "$5 \\cdot 19 \\cdot 20$",
              a: "1900",
              opts: ["190", "1500", "1900", "380"],
            },
            {
              id: "f)",
              q: "$25 \\cdot 7 \\cdot 4$",
              a: "700",
              opts: ["600", "700", "175", "100"],
            },
          ],
        },
        {
          id: "ex4",
          title: "4. Ergebnisse zuordnen",
          desc: "Ordne die Ergebnisse den Termen zu. (Achte auf die Klammern!)",
          tasks: [
            {
              id: "a)",
              q: "$264 + 7 \\cdot 144$",
              a: "1272",
              opts: ["1272", "39024"],
            },
            {
              id: "b)",
              q: "$(264 + 7) \\cdot 144$",
              a: "39024",
              opts: ["1272", "39024"],
            },
            {
              id: "c)",
              q: "$(16 + 24) \\cdot 3$",
              a: "120",
              opts: ["88", "120"],
            },
            {
              id: "d)",
              q: "$16 + 24 \\cdot 3$",
              a: "88",
              opts: ["88", "120"],
            },
            {
              id: "e)",
              q: "$50 - 20 : 2$",
              a: "40",
              opts: ["15", "40"],
            },
            {
              id: "f)",
              q: "$(50 - 20) : 2$",
              a: "15",
              opts: ["15", "40"],
            },
          ],
        },
        {
          id: "ex2",
          title: "2. Schreibe als Term und berechne",
          desc: "Welche Regeln f√ºr das Berechnen von Termen hast du verwendet?",
          visual: `
            <svg width="340" height="180" viewBox="0 0 340 180" style="display:block; margin: 0 auto;">
              <rect x="20" y="10" width="30" height="30" fill="#fef9c3" stroke="#ca8a04" stroke-width="2"/>
              <text x="35" y="30" text-anchor="middle" font-weight="bold" fill="#854d0e">12</text>
              <rect x="80" y="10" width="30" height="30" fill="#fef9c3" stroke="#ca8a04" stroke-width="2"/>
              <text x="95" y="30" text-anchor="middle" font-weight="bold" fill="#854d0e">4</text>
              <line x1="35" y1="40" x2="65" y2="80" stroke="#94a3b8" stroke-width="2"/>
              <line x1="95" y1="40" x2="65" y2="80" stroke="#94a3b8" stroke-width="2"/>
              <circle cx="65" cy="80" r="12" fill="#fff" stroke="#64748b" stroke-width="2"/>
              <text x="65" y="85" text-anchor="middle" font-weight="bold" fill="#334155">+</text>
              <line x1="65" y1="92" x2="65" y2="120" stroke="#94a3b8" stroke-width="2"/>
              <rect x="50" y="120" width="30" height="30" fill="#e2e8f0" stroke="#64748b" stroke-width="2"/>
              <text x="65" y="140" text-anchor="middle" font-weight="bold" fill="#334155">?</text>

              <rect x="200" y="10" width="30" height="30" fill="#fef9c3" stroke="#ca8a04" stroke-width="2"/>
              <text x="215" y="30" text-anchor="middle" font-weight="bold" fill="#854d0e">5</text>
              <rect x="260" y="10" width="30" height="30" fill="#fef9c3" stroke="#ca8a04" stroke-width="2"/>
              <text x="275" y="30" text-anchor="middle" font-weight="bold" fill="#854d0e">3</text>
               <line x1="215" y1="40" x2="245" y2="70" stroke="#94a3b8" stroke-width="2"/>
              <line x1="275" y1="40" x2="245" y2="70" stroke="#94a3b8" stroke-width="2"/>
              <circle cx="245" cy="70" r="12" fill="#fff" stroke="#64748b" stroke-width="2"/>
              <text x="245" y="75" text-anchor="middle" font-weight="bold" fill="#334155">¬∑</text>
              <line x1="245" y1="82" x2="245" y2="110" stroke="#94a3b8" stroke-width="2"/>
              <rect x="230" y="110" width="30" height="30" fill="#e2e8f0" stroke="#64748b" stroke-width="2"/>
               <text x="245" y="130" text-anchor="middle" font-weight="bold" fill="#334155">?</text>
            </svg>
          `,
          tasks: [
            {
              id: "a)",
              q: "Linker Rechenbaum",
              a: "16",
              opts: ["16", "3.2", "4", "20"],
            },
            {
              id: "b)",
              q: "Rechter Rechenbaum",
              a: "15",
              opts: ["8", "15", "2", "35"],
            },
          ],
        },
        {
          id: "ex11",
          title: "11. Term aufstellen und berechnen",
          desc: "Lies den Text genau und w√§hle das richtige Ergebnis.",
          tasks: [
            {
              id: "a)",
              q: "Addiere zum Produkt von 5 und 9 die 5-fache Summe aus 43 und 7.",
              a: "295",
              opts: ["295", "107", "495", "250"],
            },
            {
              id: "b)",
              q: "Multipliziere das Produkt aus 15 und 3 mit der dreifachen Differenz von 5 und 2.",
              a: "405",
              opts: ["135", "405", "45", "90"],
            },
            {
              id: "c)",
              q: "Addiere 34 zum Produkt von 9 und 4.",
              a: "70",
              opts: ["387", "70", "43", "126"],
            },
            {
              id: "d)",
              q: "Subtrahiere 15 von der Summe aus 20 und 30.",
              a: "35",
              opts: ["35", "5", "65", "25"],
            },
            {
              id: "e)",
              q: "Dividiere das Produkt von 8 und 5 durch 4.",
              a: "10",
              opts: ["40", "10", "160", "20"],
            },
          ],
        },
        {
          id: "ex13",
          title: "13. Sachaufgabe: Motorradhelm",
          desc: "Ein Motorradhelm kostet bei Barzahlung 399‚Ç¨. Bei Ratenzahlung muss man 12 Monatsraten zu 35‚Ç¨ bezahlen.",
          tasks: [
            {
              id: "a)",
              q: "Wie viel kostet der Helm bei Ratenzahlung insgesamt?",
              a: "420‚Ç¨",
              opts: ["399‚Ç¨", "420‚Ç¨", "350‚Ç¨"],
            },
            {
              id: "b)",
              q: "Wie viel spart man bei Barzahlung? (Gib einen Term an)",
              a: "21‚Ç¨",
              opts: ["35‚Ç¨", "12‚Ç¨", "21‚Ç¨", "0‚Ç¨"],
            },
            {
              id: "c)",
              q: "Ein anderer Helm kostet 200‚Ç¨. In Raten: 5 mal 45‚Ç¨. Wie teuer ist er dann?",
              a: "225‚Ç¨",
              opts: ["200‚Ç¨", "225‚Ç¨", "250‚Ç¨"],
            },
          ],
        },
        {
          id: "ex21",
          title: "21. W√ºrfeltreppen",
          desc: "Sebastian baut Treppen aus W√ºrfeln. Wie viele W√ºrfel braucht er?",
          visual: `
          <svg width="300" height="100" viewBox="0 0 300 100" style="display:block; margin: 0 auto;">
             <rect x="50" y="70" width="20" height="20" fill="#bfdbfe" stroke="#3b82f6" />
             <text x="60" y="95" text-anchor="middle" font-size="12">1 Stufe</text>
             
             <rect x="150" y="70" width="20" height="20" fill="#bfdbfe" stroke="#3b82f6" />
             <rect x="130" y="70" width="20" height="20" fill="#bfdbfe" stroke="#3b82f6" />
             <rect x="150" y="50" width="20" height="20" fill="#93c5fd" stroke="#3b82f6" />
             <text x="140" y="95" text-anchor="middle" font-size="12">2 Stufen</text>

             <rect x="230" y="70" width="20" height="20" fill="#bfdbfe" stroke="#3b82f6" />
             <rect x="210" y="70" width="20" height="20" fill="#bfdbfe" stroke="#3b82f6" />
             <rect x="190" y="70" width="20" height="20" fill="#bfdbfe" stroke="#3b82f6" />
             <rect x="230" y="50" width="20" height="20" fill="#93c5fd" stroke="#3b82f6" />
             <rect x="210" y="50" width="20" height="20" fill="#93c5fd" stroke="#3b82f6" />
             <rect x="230" y="30" width="20" height="20" fill="#60a5fa" stroke="#3b82f6" />
             <text x="210" y="95" text-anchor="middle" font-size="12">3 Stufen</text>
          </svg>
          `,
          tasks: [
            {
              id: "a)",
              q: "Wie viele W√ºrfel hat eine Treppe mit 3 Stufen?",
              a: "6",
              type: "input",
            },
            {
              id: "b)",
              q: "Wie viele W√ºrfel hat eine Treppe mit 5 Stufen? (Tipp: 1+2+3+4+5)",
              a: "15",
              type: "input",
            },
            {
              id: "c)",
              q: "Wie viele W√ºrfel hat eine Treppe mit 8 Stufen?",
              a: "36",
              type: "input",
            },
            {
              id: "d)",
              q: "Wie viele W√ºrfel f√ºr 10 Stufen?",
              a: "55",
              type: "input",
            },
            {
              id: "e)",
              q: "Wie viele W√ºrfel f√ºr 12 Stufen?",
              a: "78",
              type: "input",
            },
          ],
        },
        {
          id: "ex22",
          title: "22. Platzhalteraufgaben",
          desc: "Setze anstelle von $\\Box$ die richtige Zahl ein.",
          tasks: [
            {
              id: "a)",
              q: "$27 + \\Box = 35$",
              a: "8",
              type: "input",
            },
            {
              id: "b)",
              q: "$\\Box - 12 = 38$",
              a: "50",
              type: "input",
            },
            {
              id: "c)",
              q: "$8 \\cdot \\Box = 136$",
              a: "17",
              type: "input",
            },
            {
              id: "d)",
              q: "$\\Box \\cdot 6 = 54$",
              a: "9",
              type: "input",
            },
            {
              id: "e)",
              q: "$100 : \\Box = 4$",
              a: "25",
              type: "input",
            },
            {
              id: "f)",
              q: "$15 + \\Box = 60$",
              a: "45",
              type: "input",
            },
          ],
        },
      ];

      let totalCorrect = 0;
      let totalWrong = 0;
      let totalTasks = 0;

      document.addEventListener("DOMContentLoaded", () => {
        const root = document.getElementById("quiz-root");

        exercises.forEach((ex) => {
          totalTasks += ex.tasks.length;
          const exBlock = document.createElement("div");
          exBlock.className = "exercise-block";

          let headerHTML = `
            <div class="exercise-header">
              <h3 class="exercise-title">${ex.title}</h3>
              <p class="exercise-desc">${ex.desc}</p>
            </div>
          `;
          exBlock.innerHTML = headerHTML;

          if (ex.visual) {
            const visualDiv = document.createElement("div");
            visualDiv.className = "visual-container";
            visualDiv.innerHTML = ex.visual;
            exBlock.appendChild(visualDiv);
          }

          const taskList = document.createElement("div");
          taskList.className = "task-list";

          ex.tasks.forEach((task) => {
            const row = document.createElement("div");
            row.className = "task-row";

            let contentHTML = `
              <div class="task-content">
                <div class="task-number">${task.id}</div>
                <div class="task-question">${task.q}</div>
              </div>
            `;

            let actionHTML = "";
            if (task.type === "input") {
              const answers = Array.isArray(task.a) ? task.a.join("|") : task.a;
              actionHTML = `
                <div class="input-group">
                  <input type="text" class="input-answer" placeholder="?" onkeypress="if(event.key==='Enter') this.nextElementSibling.click()">
                  <button class="btn-check" onclick="checkInput(this, '${answers}')">OK</button>
                </div>
              `;
            } else {
              actionHTML = `<div class="options-container">`;
              task.opts.forEach((opt) => {
                const safeOpt = opt.replace(/"/g, "&quot;");
                const safeAns = task.a.replace(/"/g, "&quot;");
                actionHTML += `<button class="option-btn" onclick="checkOpt(this, '${safeOpt}', '${safeAns}')">${opt}</button>`;
              });
              actionHTML += `</div>`;
            }

            row.innerHTML =
              contentHTML + `<div style="margin-top:10px;">${actionHTML}</div>`;
            taskList.appendChild(row);
          });

          exBlock.appendChild(taskList);
          root.appendChild(exBlock);
        });

        renderMathInElement(document.body, {
          delimiters: [{ left: "$", right: "$", display: false }],
        });
      });

      function checkOpt(btn, val, ans) {
        const row = btn.closest(".task-row");
        if (row.classList.contains("done")) return;
        row.classList.add("done");

        const v = val.replace(/\\/g, "").replace(/\s/g, "");
        const a = ans.replace(/\\/g, "").replace(/\s/g, "");

        row.querySelectorAll(".option-btn").forEach((b) => (b.disabled = true));

        if (v === a) {
          btn.classList.add("selected-correct");
          row.classList.add("solved-correct");
          totalCorrect++;
        } else {
          btn.classList.add("selected-wrong");
          row.classList.add("solved-wrong");
          totalWrong++;
        }
        updateStats();
      }

      function checkInput(btn, ansStr) {
        const row = btn.closest(".task-row");
        const input = row.querySelector("input");
        if (row.classList.contains("done")) return;

        const val = input.value.trim().replace(",", ".");
        const correctArr = ansStr.split("|");

        row.classList.add("done");
        input.disabled = true;
        btn.disabled = true;

        if (correctArr.includes(val)) {
          input.classList.add("correct");
          row.classList.add("solved-correct");
          totalCorrect++;
        } else {
          input.classList.add("wrong");
          row.classList.add("solved-wrong");
          totalWrong++;
        }
        updateStats();
      }

      function updateStats() {
        document.getElementById("val-correct").innerText = totalCorrect;
        document.getElementById("val-wrong").innerText = totalWrong;
      }

      function finishLesson() {
        const modal = document.getElementById("resultModal");
        const emoji = document.getElementById("resEmoji");
        const title = document.getElementById("resTitle");
        const scoreDiv = document.getElementById("resScore");

        const percent = Math.round((totalCorrect / totalTasks) * 100);

        document.getElementById("resCorrect").innerText = totalCorrect;
        document.getElementById("resTotal").innerText = totalTasks;
        scoreDiv.innerText = percent + "%";

        if (percent === 100) {
          emoji.innerText = "üèÜ";
          title.innerText = "Perfekt!";
          title.style.color = "#16a34a";
        } else if (percent >= 80) {
          emoji.innerText = "üéâ";
          title.innerText = "Sehr gut!";
          title.style.color = "#2563eb";
        } else if (percent >= 50) {
          emoji.innerText = "üëç";
          title.innerText = "Gut gemacht!";
          title.style.color = "#ca8a04";
        } else {
          emoji.innerText = "üí™";
          title.innerText = "√úbung macht den Meister!";
          title.style.color = "#475569";
        }

        modal.style.display = "flex";
      }
    </script>
  </body>
</html>
